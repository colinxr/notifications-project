(function(m,I){typeof exports=="object"&&typeof module<"u"?I(exports,require("@feathersjs/commons"),require("vue-demi"),require("pinia"),require("@feathersjs/adapter-commons"),require("@feathersjs/rest-client"),require("vue"),require("@feathersjs/errors")):typeof define=="function"&&define.amd?define(["exports","@feathersjs/commons","vue-demi","pinia","@feathersjs/adapter-commons","@feathersjs/rest-client","vue","@feathersjs/errors"],I):(m=typeof globalThis<"u"?globalThis:m||self,I(m.feathersPinia={},m.commons,m.VueDemi,m.pinia,m.adapterCommons,m.restClient,m.Vue,m.errors))})(this,function(m,I,l,xt,it,be,T,Pe){"use strict";var Or=Object.defineProperty;var Ir=(m,I,l)=>I in m?Or(m,I,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[I]=l;var p=(m,I,l)=>(Ir(m,typeof I!="symbol"?I+"":I,l),l);function $e(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ct=function(n,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(o){return function(i){return function(a,u){var c={key:a,value:i[a]},f={key:u,value:i[u]};return o(c,f)}}}(t.cmp),s=[];return function o(i){if(i&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i!==void 0){if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);var a,u;if(Array.isArray(i)){for(u="[",a=0;a<i.length;a++)a&&(u+=","),u+=o(i[a])||"null";return u+"]"}if(i===null)return"null";if(s.indexOf(i)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=s.push(i)-1,f=Object.keys(i).sort(r&&r(i));for(u="",a=0;a<f.length;a++){var d=f[a],h=o(i[d]);!h||(u&&(u+=","),u+=JSON.stringify(d)+":"+h)}return s.splice(c,1),"{"+u+"}"}}(n)},Rt={exports:{}},Tt={exports:{}};/*!
 * isomorphic-mongo-objectid - v@version@
 * Pure JavaScript implementation of mongodb ObjectId for the browser and server
 * https://github.com/john-doherty/isomorphic-mongo-objectid
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(n){(function(){var t=0,e=Math.floor(Math.random()*32767),r=Math.floor(Math.random()*16777216);if(typeof window<"u"){var s=window.localStorage,o=parseInt(s.mongoMachineId,10);o>=0&&o<=16777215&&(r=Math.floor(s.mongoMachineId)),s.mongoMachineId=r}function i(){var a=arguments;if(!(this instanceof i))return a.length>0?new i(a[0],a[1],a[2],a[3]):new i;typeof a[0]=="object"?(this.timestamp=a[0].timestamp,this.machine=a[0].machine,this.pid=a[0].pid,this.increment=a[0].increment):typeof a[0]=="string"&&a[0].length===24?(this.timestamp=Number("0x"+a[0].substr(0,8)),this.machine=Number("0x"+a[0].substr(8,6)),this.pid=Number("0x"+a[0].substr(14,4)),this.increment=Number("0x"+a[0].substr(18,6))):a.length===4&&a[0]!==null?(this.timestamp=a[0],this.machine=a[1],this.pid=a[2],this.increment=a[3]):(this.timestamp=Math.floor(new Date().valueOf()/1e3),this.machine=r,this.pid=e,this.increment=t++,t>16777215&&(t=0))}i.prototype.getDate=function(){return new Date(this.timestamp*1e3)},i.prototype.toArray=function(){var a=this.toString(),u=[],c;for(c=0;c<12;c++)u[c]=parseInt(a.slice(c*2,c*2+2),16);return u},i.prototype.toString=function(){var a=this.timestamp.toString(16),u=this.machine.toString(16),c=this.pid.toString(16),f=this.increment.toString(16);return["00000000".substr(0,8-a.length)+a,"000000".substr(0,6-u.length)+u,"0000".substr(0,4-c.length)+c,"000000".substr(0,6-f.length)+f].join("")},n.exports=i})()})(Tt),function(n){n.exports=Tt.exports}(Rt);const Ee=$e(Rt.exports);var _e=Function.prototype.toString,vt=Object.create,je=Object.defineProperty,ke=Object.getOwnPropertyDescriptor,Nt=Object.getOwnPropertyNames,yt=Object.getOwnPropertySymbols,Fe=Object.getPrototypeOf,Ut=Object.prototype,qe=Ut.hasOwnProperty,Le=Ut.propertyIsEnumerable,Wt=typeof yt=="function",Be=typeof WeakMap=="function",Ae=function(){if(Be)return function(){return new WeakMap};var n=function(){function t(){this._keys=[],this._values=[]}return t.prototype.has=function(e){return!!~this._keys.indexOf(e)},t.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},t.prototype.set=function(e,r){this._keys.push(e),this._values.push(r)},t}();return function(){return new n}}(),Gt=function(n,t){var e=n.__proto__||Fe(n);if(!e)return vt(null);var r=e.constructor;if(r===t.Object)return e===t.Object.prototype?{}:vt(e);if(~_e.call(r).indexOf("[native code]"))try{return new r}catch{}return vt(e)},Me=function(n,t,e,r){var s=Gt(n,t);r.set(n,s);for(var o in n)qe.call(n,o)&&(s[o]=e(n[o],r));if(Wt)for(var i=yt(n),a=0,u=i.length,c=void 0;a<u;++a)c=i[a],Le.call(n,c)&&(s[c]=e(n[c],r));return s},Qt=function(n,t,e,r){var s=Gt(n,t);r.set(n,s);for(var o=Wt?Nt(n).concat(yt(n)):Nt(n),i=0,a=o.length,u=void 0,c=void 0;i<a;++i)if(u=o[i],u!=="callee"&&u!=="caller")if(c=ke(n,u),c){!c.get&&!c.set&&(c.value=e(n[u],r));try{je(s,u,c)}catch{s[u]=c.value}}else s[u]=e(n[u],r);return s},xe=function(n){var t="";return n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),n.unicode&&(t+="u"),n.sticky&&(t+="y"),t},Ce=Array.isArray,Re=Object.getPrototypeOf,Te=function(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:(console&&console.error&&console.error('Unable to locate global object, returning "this".'),this)}();function G(n,t){var e=!!(t&&t.isStrict),r=t&&t.realm||Te,s=e?Qt:Me,o=function(i,a){if(!i||typeof i!="object")return i;if(a.has(i))return a.get(i);var u=i.__proto__||Re(i),c=u&&u.constructor;if(!c||c===r.Object)return s(i,r,o,a);var f;if(Ce(i)){if(e)return Qt(i,r,o,a);f=new c,a.set(i,f);for(var d=0,h=i.length;d<h;++d)f[d]=o(i[d],a);return f}if(i instanceof r.Date)return new c(i.getTime());if(i instanceof r.RegExp)return f=new c(i.source,i.flags||xe(i)),f.lastIndex=i.lastIndex,f;if(r.Map&&i instanceof r.Map)return f=new c,a.set(i,f),i.forEach(function(v,w){f.set(w,o(v,a))}),f;if(r.Set&&i instanceof r.Set)return f=new c,a.set(i,f),i.forEach(function(v){f.add(o(v,a))}),f;if(r.Blob&&i instanceof r.Blob)return i.slice(0,i.size,i.type);if(r.Buffer&&r.Buffer.isBuffer(i))return f=r.Buffer.allocUnsafe?r.Buffer.allocUnsafe(i.length):new c(i.length),a.set(i,f),i.copy(f),f;if(r.ArrayBuffer){if(r.ArrayBuffer.isView(i))return f=new c(i.buffer.slice(0)),a.set(i,f),f;if(i instanceof r.ArrayBuffer)return f=i.slice(0),a.set(i,f),f}return typeof i.then=="function"||i instanceof Error||r.WeakMap&&i instanceof r.WeakMap||r.WeakSet&&i instanceof r.WeakSet?i:s(i,r,o,a)};return o(n,Ae())}G.default=G,G.strict=function(t,e){return G(t,{isStrict:!0,realm:e?e.realm:void 0})};var gt=function n(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,s,o;if(Array.isArray(t)){if(r=t.length,r!=e.length)return!1;for(s=r;s--!==0;)if(!n(t[s],e[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(e,o[s]))return!1;for(s=r;s--!==0;){var i=o[s];if(!n(t[i],e[i]))return!1}return!0}return t!==t&&e!==e};function ot(n){return typeof n=="object"&&n!=null?n.toString():n}function $(n,t){if(!!n){if(t&&n[t]!=null)return ot(n[t]);if(n.id!=null)return ot(n.id);if(n._id!=null)return ot(n._id)}}function K(n,t){if((n==null?void 0:n[t])!=null)return ot(n[t])}function st(n,t,e){return $(n,e)!=null?$(n,e):K(n,t)}function V(n={},t={}){const{query:e={},qid:r="default"}=n,s=t.limit!=null?t.limit:e==null?void 0:e.$limit,o=t.skip!=null?t.skip:e==null?void 0:e.$skip,i=s!==void 0?{$limit:s,$skip:o}:void 0,a=i?Ct(i):void 0,u=I._.omit(e,"$limit","$skip"),c=Ct(u);return{qid:r,query:e,queryId:c,queryParams:u,pageParams:i,pageId:a,response:t,isOutdated:void 0}}function Ne(n,t,e){const{queryId:r,pageId:s}=t,o=n[r],i=o&&o[s],a=i&&i.ids;return a&&a.length?Object.values(I._.pick(e,...a)):[]}function Ue(n,t){const e=new Ee().toString();return n[t]=e,n}function mt(n,t){const{items:e,isArray:r}=X(n),s=e.map(o=>I._.omit(o,t));return r?s:s[0]}function We(n,t,e){const{items:r,isArray:s}=X(n),{items:o}=X(t);return o.forEach((i,a)=>{const u=r[a][e];u&&(i[e]=u)}),s?o:o[0]}function X(n){const t=Array.isArray(n);return{items:t?n:[n],isArray:t}}const N=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);function Y(n){return n?G(l.unref(n)):{}}function Jt(n){return Object.defineProperty(n,"__isClone",{value:!0,enumerable:!1}),n}function Kt(n,t,e){Object.keys(e).forEach(r=>{const s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s)})}function Ot(n,t){if(!t)return n;const r=(typeof t=="string"?[t]:Array.isArray(t)?t:Object.keys(t||n)).map(s=>s.toString().split(".")[0]);return I._.pick(n,...r)}function Ge(n,t,e){const r=Ot(n,e),s=Ot(t,e);return typeof e!="string"&&!Array.isArray(e)&&Object.assign(s,e),gt(r,s)?{}:Object.keys(s).reduce((a,u)=>(gt(n[u],s[u])||(a[u]=s[u]),a),{})}const Qe=(n,t,e)=>{(n.value||n)[t]=e},Z=(n,t)=>l.computed({set:e=>Qe(n,t,e),get:()=>l.unref(n)[t]}),It=(n,t)=>l.computed(()=>{const e=l.unref(t);if(e)if(e.paginate||e.onServer){const{defaultSkip:r,defaultLimit:s}=n.pagination,o=e.query.$skip||r,i=e.query.$limit||s,a=n.pagination[e.qid||"default"]||{},u=o!=null&&i!=null?{limit:i,skip:o}:{},c=V(e,u);return Ne(a,c,n.itemsById)}else return n.findInStore(e).data;else return[]});function Je(n){n=l.unref(n);const t=I._.omit(n.query,"$limit","$skip");return{...I._.omit(n,"query","store"),query:t}}function Ke(n,t){t=l.unref(t);const e=I._.omit(t.query,"$limit","$skip"),r=I._.omit(n.value,"store","query");Object.assign(n.value.query,e),Object.assign(n.value,r)}const H={};function Ve(n,t){H[t.clientAlias]=H[t.clientAlias]||{},H[t.clientAlias][n.modelName]=n}var wt={exports:{}},D=typeof Reflect=="object"?Reflect:null,Vt=D&&typeof D.apply=="function"?D.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},at;D&&typeof D.ownKeys=="function"?at=D.ownKeys:Object.getOwnPropertySymbols?at=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:at=function(t){return Object.getOwnPropertyNames(t)};function Ye(n){console&&console.warn&&console.warn(n)}var Yt=Number.isNaN||function(t){return t!==t};function S(){S.init.call(this)}wt.exports=S,wt.exports.once=Ze,S.EventEmitter=S,S.prototype._events=void 0,S.prototype._eventsCount=0,S.prototype._maxListeners=void 0;var Ht=10;function ut(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return Ht},set:function(n){if(typeof n!="number"||n<0||Yt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ht=n}}),S.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Yt(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function zt(n){return n._maxListeners===void 0?S.defaultMaxListeners:n._maxListeners}S.prototype.getMaxListeners=function(){return zt(this)},S.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var s=t==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(e.length>0&&(i=e[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var u=o[t];if(u===void 0)return!1;if(typeof u=="function")Vt(u,this,e);else for(var c=u.length,f=ee(u,c),r=0;r<c;++r)Vt(f[r],this,e);return!0};function Xt(n,t,e,r){var s,o,i;if(ut(e),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),o=n._events),i=o[t]),i===void 0)i=o[t]=e,++n._eventsCount;else if(typeof i=="function"?i=o[t]=r?[e,i]:[i,e]:r?i.unshift(e):i.push(e),s=zt(n),s>0&&i.length>s&&!i.warned){i.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=i.length,Ye(a)}return n}S.prototype.addListener=function(t,e){return Xt(this,t,e,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(t,e){return Xt(this,t,e,!0)};function He(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zt(n,t,e){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},s=He.bind(r);return s.listener=e,r.wrapFn=s,s}S.prototype.once=function(t,e){return ut(e),this.on(t,Zt(this,t,e)),this},S.prototype.prependOnceListener=function(t,e){return ut(e),this.prependListener(t,Zt(this,t,e)),this},S.prototype.removeListener=function(t,e){var r,s,o,i,a;if(ut(e),s=this._events,s===void 0)return this;if(r=s[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===e||r[i].listener===e){a=r[i].listener,o=i;break}if(o<0)return this;o===0?r.shift():ze(r,o),r.length===1&&(s[t]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(t){var e,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function Dt(n,t,e){var r=n._events;if(r===void 0)return[];var s=r[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Xe(s):ee(s,s.length)}S.prototype.listeners=function(t){return Dt(this,t,!0)},S.prototype.rawListeners=function(t){return Dt(this,t,!1)},S.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):te.call(n,t)},S.prototype.listenerCount=te;function te(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}S.prototype.eventNames=function(){return this._eventsCount>0?at(this._events):[]};function ee(n,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=n[r];return e}function ze(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Xe(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Ze(n,t){return new Promise(function(e,r){function s(i){n.removeListener(t,o),r(i)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}ne(n,t,o,{once:!0}),t!=="error"&&De(n,s,{once:!0})})}function De(n,t,e){typeof n.on=="function"&&ne(n,"error",t,e)}function ne(n,t,e,r){if(typeof n.on=="function")r.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function s(o){r.once&&n.removeEventListener(t,s),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}class x{constructor(t={},e={}){p(this,"__isClone");const{store:r,instanceDefaults:s}=this.Model;return Object.assign(this,s.call(this.Model,t,{models:H,store:r})),Object.defineProperty(this,"__isClone",{enumerable:!1,value:!!e.clone}),this}static instanceDefaults(t){return t}static addEventListener(t,e){return this.emitter.addListener(t,e),this}static emit(t,...e){return this.emitter.emit(t,...e)}static eventNames(){return this.emitter.eventNames()}static getMaxListeners(){return this.emitter.getMaxListeners()}static listenerCount(t){return this.emitter.listenerCount(t)}static listeners(t){return this.emitter.listeners(t)}static off(t,e){return this.emitter.off(t,e),this}static on(t,e){return this.emitter.on(t,e),this}static once(t,e){return this.emitter.once(t,e),this}static prependListener(t,e){return this.emitter.prependListener(t,e),this}static prependOnceListener(t,e){return this.emitter.prependOnceListener(t,e),this}static rawListeners(t){return this.emitter.rawListeners(t)}static removeAllListeners(t){return this.emitter.removeAllListeners(t),this}static removeListener(t,e){return this.emitter.removeListener(t,e),this}static setMaxListeners(t){return this.emitter.setMaxListeners(t),this}static find(t){return this.store.find(t)}static findInStore(t){return this.store.findInStore(t)}static get(t,e){return this.store.get(t,e)}static getFromStore(t,e){return this.store.getFromStore(t,e)}static count(t){return this.store.count(t)}static countInStore(t){return this.store.countInStore(t)}static addToStore(t){return this.store.addToStore(t)}static update(t,e,r){return this.store.update(t,e,r)}static patch(t,e,r){return this.store.patch(t,e,r)}static remove(t,e){return this.store.remove(t,e)}static removeFromStore(t){return this.store.removeFromStore(t)}get Model(){return this.constructor}init(t){const{instanceDefaults:e,setupInstance:r}=this.Model;e&&Object.assign(this,e.call(this.Model,t),t),r&&r.call(this.Model,this)}getId(){return $(this,this.Model.idField)}getTempId(){const{tempIdField:t}=this.Model;return K(this,t)}getAnyId(){const{tempIdField:t,idField:e}=this.Model;return st(this,t,e)}get __isTemp(){const{idField:t}=this.Model;return $(this,t)==null}get isSavePending(){const{store:t,idField:e}=this.Model,r=t.pendingById[$(this,e)];return(r==null?void 0:r.create)||(r==null?void 0:r.update)||(r==null?void 0:r.patch)||!1}get isCreatePending(){var r;const{store:t,idField:e}=this.Model;return((r=t.pendingById[$(this,e)])==null?void 0:r.create)||!1}get isPatchPending(){var r;const{store:t,idField:e}=this.Model;return((r=t.pendingById[$(this,e)])==null?void 0:r.patch)||!1}get isUpdatePending(){var r;const{store:t,idField:e}=this.Model;return((r=t.pendingById[$(this,e)])==null?void 0:r.update)||!1}get isRemovePending(){var r;const{store:t,idField:e}=this.Model;return((r=t.pendingById[$(this,e)])==null?void 0:r.remove)||!1}get isPending(){const{store:t,idField:e}=this.Model,r=t.pendingById[$(this,e)];return(r==null?void 0:r.create)||(r==null?void 0:r.update)||(r==null?void 0:r.patch)||(r==null?void 0:r.remove)||!1}addToStore(){const{store:t}=this.Model;return t.addToStore(this)}clone(t,e={}){const{store:r}=this.Model;return r.clone(this,t,e)}commit(t){const{store:e}=this.Model;if(this.__isClone)return e.commit(this,t);throw new Error("You cannot call commit on a non-copy")}reset(t={}){const{store:e}=this.Model;return e.reset(this,t)}save(t){const{idField:e}=this.Model;return $(this,e)!=null?this.patch(t):this.create(t)}async create(t){const{idField:e,store:r}=this.Model,s=Object.assign({},this);s[e]===null&&delete s[e];const{__isClone:o}=this,i=await r.create(s,t);return Object.assign(this,i),o?i.clone():i}async patch(t={}){const{idField:e,store:r}=this.Model,s=$(this,e);if(s==null){const a=new Error(`Missing ${e} property. You must create the data before you can patch with this data`);return Promise.reject(a)}const{__isClone:o}=this;let i;if(o&&t.diff!=!1){const a=this.Model.getFromStore(s),u=Ge(a,this,t.diff),c=G(a);if(t.commit!==!1&&this.commit(u),t.with){const f=Ot(this,t.with);typeof t.with!="string"&&!Array.isArray(t.with)&&Object.assign(f,t.with),Object.assign(u,f)}if(Object.keys(u).length===0)return this;try{i=await r.patch(s,u,t)}catch{this.commit(c)}}else i=await r.patch(s,this,t);return o?i.clone():i}async update(t){const{idField:e,store:r}=this.Model,s=$(this,e);if(s==null){const a=new Error(`Missing ${e} property. You must create the data before you can patch with this data`);return Promise.reject(a)}const{__isClone:o}=this,i=await r.update(s,this,t);return o?i.clone():i}remove(t){tn(this);const{idField:e,store:r}=this.Model,s=$(this,e);return r.remove(s,t)}removeFromStore(){const{store:t}=this.Model;return t.removeFromStore(this)}}p(x,"store"),p(x,"models",H),p(x,"pinia",null),p(x,"servicePath",""),p(x,"idField",""),p(x,"modelName",""),p(x,"tempIdField",""),p(x,"associations",{}),p(x,"emitter",new wt.exports.EventEmitter);function tn(n){if(!n)throw new Error(`Instance methods must be called with the dot operator. If you are referencing one in an event, use '@click="() => instance.remove()"' so that the correct 'this' context is applied. Using '@click="instance.remove"' will call the remove function with "this" set to 'undefined' because the function is called directly instead of as a method.`)}const z={};function St(n,t){z[n]||(z[n]=t)}var ct=en;function en(n,t,e,r){var s,o,i;return function(){if(i=this,o=Array.prototype.slice.call(arguments),s&&(e||r))return;if(!e)return c(),s=setTimeout(u,t),s;s=setTimeout(c,t),n.apply(i,o);function u(){c(),n.apply(i,o)}function c(){clearTimeout(s),s=null}}}function nn({service:n,Model:t,store:e,options:r}){const s={addOrUpdateById:{},removeItemById:{},enqueueAddOrUpdate(i){const a=$(i,r.idField);this.addOrUpdateById[a]=i,N(this.removeItemById,a)&&delete this.removeItemById[a],this.flushAddOrUpdateQueue()},enqueueRemoval(i){const a=$(i,r.idField);this.removeItemById[a]=i,N(this.addOrUpdateById,a)&&delete this.addOrUpdateById[a],this.flushRemoveItemQueue()},flushAddOrUpdateQueue:ct(async function(){const i=Object.values(this.addOrUpdateById);i.length!==0&&(await e.addOrUpdate(i),this.addOrUpdateById={})},r.debounceEventsTime||20,void 0,r.debounceEventsGuarantee),flushRemoveItemQueue:ct(function(){const i=Object.values(this.removeItemById);i.length!==0&&(e.removeFromStore(i),this.removeItemById={})},r.debounceEventsTime||20,void 0,r.debounceEventsGuarantee)},o=(i,a)=>{const u=r.handleEvents[i],c=u(a,{model:t,models:H}),[f,d=a]=Array.isArray(c)?c:[c];f&&(r.debounceEventsTime?i==="removed"?s.enqueueRemoval(a):s.enqueueAddOrUpdate(a):i==="removed"?e.removeFromStore(d):e.addOrUpdate(d))};return n.on("created",i=>{o("created",i),t.emit&&t.emit("created",i)}),n.on("updated",i=>{o("updated",i),t.emit&&t.emit("updated",i)}),n.on("patched",i=>{o("patched",i),t.emit&&t.emit("patched",i)}),n.on("removed",i=>{o("removed",i),t.emit&&t.emit("removed",i)}),s}function rn(n){const t={clientAlias:n.clientAlias,servicePath:n.servicePath,idField:n.idField,tempIdField:n.tempIdField,itemsById:{},tempsById:{},clonesById:{},pendingById:{Model:{find:!1,count:!1,get:!1}},eventLocksById:{created:{},patched:{},updated:{},removed:{}},pagination:{},whitelist:n.whitelist,paramsForServer:n.paramsForServer,skipRequestIfExists:n.skipRequestIfExists},e=n.state();return()=>Object.assign(t,e)}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var bt=function(n,t){return bt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])},bt(n,t)};function F(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");bt(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Pt=function(n){var t="[object "+n+"]";return function(e){return sn(e)===t}},sn=function(n){return Object.prototype.toString.call(n)},tt=function(n){return n instanceof Date?n.getTime():et(n)?n.map(tt):n&&typeof n.toJSON=="function"?n.toJSON():n},et=Pt("Array"),on=Pt("Object"),an=Pt("Function"),un=function(n){return n&&(n.constructor===Object||n.constructor===Array||n.constructor.toString()==="function Object() { [native code] }"||n.constructor.toString()==="function Array() { [native code] }")&&!n.toJSON},$t=function(n,t){if(n==null&&n==t||n===t)return!0;if(Object.prototype.toString.call(n)!==Object.prototype.toString.call(t))return!1;if(et(n)){if(n.length!==t.length)return!1;for(var e=0,r=n.length;e<r;e++)if(!$t(n[e],t[e]))return!1;return!0}else if(on(n)){if(Object.keys(n).length!==Object.keys(t).length)return!1;for(var s in n)if(!$t(n[s],t[s]))return!1;return!0}return!1},Et=function(n,t,e,r,s,o){var i=t[r];if(et(n)&&isNaN(Number(i))){for(var a=0,u=n.length;a<u;a++)if(!Et(n[a],t,e,r,a,n))return!1}return r===t.length||n==null?e(n,s,o,r===0):Et(n[i],t,e,r+1,i,n)},R=function(){function n(t,e,r,s){this.params=t,this.owneryQuery=e,this.options=r,this.name=s,this.init()}return n.prototype.init=function(){},n.prototype.reset=function(){this.done=!1,this.keep=!1},n}(),_t=function(n){F(t,n);function t(e,r,s,o){var i=n.call(this,e,r,s)||this;return i.children=o,i}return t.prototype.reset=function(){this.keep=!1,this.done=!1;for(var e=0,r=this.children.length;e<r;e++)this.children[e].reset()},t.prototype.childrenNext=function(e,r,s,o){for(var i=!0,a=!0,u=0,c=this.children.length;u<c;u++){var f=this.children[u];if(f.done||f.next(e,r,s,o),f.keep||(a=!1),f.done){if(!f.keep)break}else i=!1}this.done=i,this.keep=a},t}(R),re=function(n){F(t,n);function t(e,r,s,o,i){var a=n.call(this,e,r,s,o)||this;return a.name=i,a}return t}(_t),cn=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.next=function(e,r,s,o){this.childrenNext(e,r,s,o)},t}(_t),jt=function(n){F(t,n);function t(e,r,s,o,i){var a=n.call(this,r,s,o,i)||this;return a.keyPath=e,a.propop=!0,a._nextNestedValue=function(u,c,f,d){return a.childrenNext(u,c,f,d),!a.done},a}return t.prototype.next=function(e,r,s){Et(e,this.keyPath,this._nextNestedValue,0,r,s)},t}(_t),kt=function(n,t){if(n instanceof Function)return n;if(n instanceof RegExp)return function(r){var s=typeof r=="string"&&n.test(r);return n.lastIndex=0,s};var e=tt(n);return function(r){return t(e,tt(r))}},Q=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){this._test=kt(this.params,this.options.compare)},t.prototype.next=function(e,r,s){(!Array.isArray(s)||s.hasOwnProperty(r))&&this._test(e,r,s)&&(this.done=!0,this.keep=!0)},t}(R),lt=function(n,t,e){return new Q(n,t,e)},ln=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.next=function(){this.done=!0,this.keep=!1},t}(R),fn=function(n){return function(t,e,r,s){return t==null?new ln(t,e,r,s):n(t,e,r,s)}},ft=function(n){return fn(function(t,e,r,s){var o=typeof tt(t),i=n(t);return new Q(function(a){return typeof tt(a)===o&&i(a)},e,r,s)})},dn=function(n,t,e,r){var s=r.operations[n];return s||se(n),s(t,e,r,n)},se=function(n){throw new Error("Unsupported operation: "+n)},ie=function(n,t){for(var e in n)if(t.operations.hasOwnProperty(e)||e.charAt(0)==="$")return!0;return!1},hn=function(n,t,e,r,s){if(ie(t,s)){var o=oe(t,e,s),i=o[0],a=o[1];if(a.length)throw new Error("Property queries must contain only operations, or exact objects.");return new jt(n,t,r,s,i)}return new jt(n,t,r,s,[new Q(t,r,s)])},nt=function(n,t,e){t===void 0&&(t=null);var r=e===void 0?{}:e,s=r.compare,o=r.operations,i={compare:s||$t,operations:Object.assign({},o||{})},a=oe(n,null,i),u=a[0],c=a[1],f=[];return u.length&&f.push(new jt([],n,t,i,u)),f.push.apply(f,c),f.length===1?f[0]:new cn(n,t,i,f)},oe=function(n,t,e){var r=[],s=[];if(!un(n))return r.push(new Q(n,n,e)),[r,s];for(var o in n)if(e.operations.hasOwnProperty(o)){var i=dn(o,n[o],n,e);if(i&&!i.propop&&t&&!e.operations[t])throw new Error("Malformed query. "+o+" cannot be matched against property.");i!=null&&r.push(i)}else o.charAt(0)==="$"?se(o):s.push(hn(o.split("."),n[o],o,n,e));return[r,s]},pn=function(n){return function(t,e,r){return n.reset(),n.next(t,e,r),n.keep}},vn=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){this._test=kt(this.params,this.options.compare)},t.prototype.reset=function(){n.prototype.reset.call(this),this.keep=!0},t.prototype.next=function(e){this._test(e)&&(this.done=!0,this.keep=!1)},t}(R),yn=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){if(!this.params||typeof this.params!="object")throw new Error("Malformed query. $elemMatch must by an object.");this._queryOperation=nt(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){n.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(e){if(et(e)){for(var r=0,s=e.length;r<s;r++){this._queryOperation.reset();var o=e[r];this._queryOperation.next(o,r,e,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},t}(R),gn=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){this._queryOperation=nt(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){n.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(e,r,s,o){this._queryOperation.next(e,r,s,o),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},t}(R),ae=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){},t.prototype.next=function(e){et(e)&&e.length===this.params&&(this.done=!0,this.keep=!0)},t}(R),ue=function(n){if(n.length===0)throw new Error("$and/$or/$nor must be a nonempty array")},ce=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!1,e}return t.prototype.init=function(){var e=this;ue(this.params),this._ops=this.params.map(function(r){return nt(r,null,e.options)})},t.prototype.reset=function(){this.done=!1,this.keep=!1;for(var e=0,r=this._ops.length;e<r;e++)this._ops[e].reset()},t.prototype.next=function(e,r,s){for(var o=!1,i=!1,a=0,u=this._ops.length;a<u;a++){var c=this._ops[a];if(c.next(e,r,s),c.keep){o=!0,i=c.keep;break}}this.keep=i,this.done=o},t}(R),mn=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!1,e}return t.prototype.next=function(e,r,s){n.prototype.next.call(this,e,r,s),this.keep=!this.keep},t}(ce),le=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.init=function(){var e=this;this._testers=this.params.map(function(r){if(ie(r,e.options))throw new Error("cannot nest $ under "+e.name.toLowerCase());return kt(r,e.options.compare)})},t.prototype.next=function(e,r,s){for(var o=!1,i=!1,a=0,u=this._testers.length;a<u;a++){var c=this._testers[a];if(c(e)){o=!0,i=!0;break}}this.keep=i,this.done=o},t}(R),On=function(n){F(t,n);function t(e,r,s,o){var i=n.call(this,e,r,s,o)||this;return i.propop=!0,i._in=new le(e,r,s,o),i}return t.prototype.next=function(e,r,s,o){this._in.next(e,r,s),et(s)&&!o?this._in.keep?(this.keep=!1,this.done=!0):r==s.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},t.prototype.reset=function(){n.prototype.reset.call(this),this._in.reset()},t}(R),In=function(n){F(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.propop=!0,e}return t.prototype.next=function(e,r,s){s.hasOwnProperty(r)===this.params&&(this.done=!0,this.keep=!0)},t}(R),wn=function(n){F(t,n);function t(e,r,s,o){var i=n.call(this,e,r,s,e.map(function(a){return nt(a,r,s)}),o)||this;return i.propop=!1,ue(e),i}return t.prototype.next=function(e,r,s,o){this.childrenNext(e,r,s,o)},t}(re),Sn=function(n){F(t,n);function t(e,r,s,o){var i=n.call(this,e,r,s,e.map(function(a){return nt(a,r,s)}),o)||this;return i.propop=!0,i}return t.prototype.next=function(e,r,s,o){this.childrenNext(e,r,s,o)},t}(re),bn=function(n,t,e){return new Q(n,t,e)},Pn=function(n,t,e,r){return new vn(n,t,e,r)},$n=function(n,t,e,r){return new ce(n,t,e,r)},En=function(n,t,e,r){return new mn(n,t,e,r)},_n=function(n,t,e,r){return new yn(n,t,e,r)},jn=function(n,t,e,r){return new On(n,t,e,r)},kn=function(n,t,e,r){return new le(n,t,e,r)},Fn=ft(function(n){return function(t){return t<n}}),qn=ft(function(n){return function(t){return t<=n}}),Ln=ft(function(n){return function(t){return t>n}}),Bn=ft(function(n){return function(t){return t>=n}}),An=function(n,t,e){var r=n[0],s=n[1];return new Q(function(o){return tt(o)%r===s},t,e)},Mn=function(n,t,e,r){return new In(n,t,e,r)},xn=function(n,t,e){return new Q(new RegExp(n,t.$options),t,e)},Cn=function(n,t,e,r){return new gn(n,t,e,r)},fe={number:function(n){return typeof n=="number"},string:function(n){return typeof n=="string"},bool:function(n){return typeof n=="boolean"},array:function(n){return Array.isArray(n)},null:function(n){return n===null},timestamp:function(n){return n instanceof Date}},Rn=function(n,t,e){return new Q(function(r){if(typeof n=="string"){if(!fe[n])throw new Error("Type alias does not exist");return fe[n](r)}return r!=null?r instanceof n||r.constructor===n:!1},t,e)},Tn=function(n,t,e,r){return new wn(n,t,e,r)},Nn=function(n,t,e,r){return new Sn(n,t,e,r)},Un=function(n,t,e){return new ae(n,t,e,"$size")},Wn=function(){return null},Gn=function(n,t,e){var r;if(an(n))r=n;else if(!process.env.CSP_ENABLED)r=new Function("obj","return "+n);else throw new Error('In CSP mode, sift does not support strings in "$where" condition');return new Q(function(s){return r.bind(s)(s)},t,e)},Qn=Object.freeze({__proto__:null,$Size:ae,$eq:bn,$ne:Pn,$or:$n,$nor:En,$elemMatch:_n,$nin:jn,$in:kn,$lt:Fn,$lte:qn,$gt:Ln,$gte:Bn,$mod:An,$exists:Mn,$regex:xn,$not:Cn,$type:Rn,$and:Tn,$all:Nn,$size:Un,$options:Wn,$where:Gn}),Jn=function(n,t,e){var r=e===void 0?{}:e,s=r.compare,o=r.operations;return nt(n,t,{compare:s,operations:Object.assign({},Qn,o||{})})},Kn=function(n,t){t===void 0&&(t={});var e=Jn(n,null,t);return pn(e)};const Vn=Kn;function Ft(n,t,e="g"){const r=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];return t=t.replace(new RegExp(`(\\${r.join("|\\")})`,e),"\\$1"),t=t.replace(/%/g,".*").replace(/_/g,"."),RegExp(`^${t}$`,e).test(n)}function de(n,t){return Ft(n,t,"ig")}const Yn=(n,t,e)=>lt(r=>Ft(r,n),t,e),Hn=(n,t,e)=>lt(r=>!Ft(r,n),t,e),he=(n,t,e)=>lt(r=>de(r,n),t,e),zn={$like:Yn,$notLike:Hn,$ilike:he,$iLike:he,$notILike:(n,t,e)=>lt(r=>!de(r,n),t,e)},Xn=["$sort","$limit","$skip","$select"],Zn=["$elemMatch"];function Dn(n){return Object.assign({service(){const e=n.clients[this.clientAlias];if(!e)throw new Error(`There is no registered FeathersClient named '${this.clientAlias}'. You need to provide one in the 'defineStore' options.`);return e.service(this.servicePath)},Model(){return n.Model},isSsr(){return!!l.unref(n.ssr)},itemIds(){return this.items.map(e=>e[this.idField])},items(){return Object.values(this.itemsById)},tempIds(){return this.temps.map(e=>e[this.tempIdField])},temps(){return Object.values(this.tempsById)},cloneIds(){return this.clones.map(e=>e[this.idField])},clones(){return Object.values(this.clonesById)},findInStore(){return e=>{var d,h;e={...l.unref(e)};const{paramsForServer:r,whitelist:s,itemsById:o}=this,i=I._.omit(e.query||{},...r),{query:a,filters:u}=it.filterQuery(i,{filters:{$and:!0,$or:!0},operators:Zn.concat(s||[]).concat(["$like","$iLike","$ilike","$notLike","$notILike"]).concat(((d=this.service.options)==null?void 0:d.allow)||((h=this.service.options)==null?void 0:h.whitelist)||[])});u.$or&&(a.$or=u.$or),u.$and&&(a.$and=u.$and);let c=I._.values(o);e.temps&&c.push(...I._.values(this.tempsById)),c=c.filter(Vn(a,{operations:zn}));const f=c.length;return u.$sort&&c.sort(it.sorter(u.$sort)),u.$skip&&(c=c.slice(u.$skip)),typeof u.$limit<"u"&&(c=c.slice(0,u.$limit)),c=c.map(v=>(v&&!v.constructor.modelName&&(v=this.addOrUpdate(v)),v)),{total:f,limit:u.$limit||0,skip:u.$skip||0,data:c}}},countInStore(){return e=>{if(e={...l.unref(e)},!e.query)throw"params must contain a query-object";return e.query=I._.omit(e.query,...Xn),this.findInStore(e).total}},getFromStore(){return(e,r={})=>{e=l.unref(e),r=G(l.unref(r)||{});let s=null;const o=this.itemsById[e]&&it.select(r,this.idField)(this.itemsById[e]),i=this.tempsById[e]&&it.select(r,this.tempIdField)(this.tempsById[e]);return o?s=o:i&&(s=i),s&&!s.constructor.modelName&&(s=this.addOrUpdate(s)),s}},isCreatePending(){return dt("create",this)},isPatchPending(){return dt("patch",this)},isUpdatePending(){return dt("update",this)},isRemovePending(){return dt("remove",this)}},n.getters)}function dt(n,t){return Object.keys(t.pendingById).reduce((r,s)=>t.pendingById[s][n]||r,!1)}const pe=(n,t,e)=>{const r=l.computed(()=>e.value?Math.ceil(e.value/n.value):1),s=l.computed({set(h){h<1?h=1:h>r.value&&(h=r.value);const v=n.value*Math.floor(h-1);t.value=v},get(){return r.value===0?0:Math.floor(t.value/n.value+1)}}),o=l.computed(()=>s.value-1>0),i=l.computed(()=>s.value<r.value);return{pageCount:r,currentPage:s,canPrev:o,canNext:i,toStart:()=>Promise.resolve(s.value=1),toEnd:()=>Promise.resolve(s.value=r.value),toPage:h=>Promise.resolve(s.value=h),next:()=>Promise.resolve(s.value++),prev:()=>Promise.resolve(s.value--)}};function qt(n){return new Lt(n)}class Lt{constructor(t){p(this,"params");p(this,"onServer");p(this,"isSsr");p(this,"qid");p(this,"data");p(this,"allData");p(this,"total");p(this,"limit");p(this,"skip");p(this,"findInStore");p(this,"currentQuery");p(this,"latestQuery");p(this,"previousQuery");p(this,"find");p(this,"request");p(this,"requestCount");p(this,"queryWhen");p(this,"isPending");p(this,"haveBeenRequested");p(this,"haveLoaded");p(this,"error");p(this,"clearError");p(this,"pageCount");p(this,"currentPage");p(this,"canPrev");p(this,"canNext");p(this,"next");p(this,"prev");p(this,"toStart");p(this,"toEnd");p(this,"toPage");let e;l.isReadonly(t)&&(e=t);const r=l.unref(t).store,s=l.isRef(t)?l.isReadonly(t)?l.ref(t.value):t:l.ref(t);delete s.value.store,this.params=s,this.qid=Z(s.value,"qid"),this.qid.value||(this.qid.value="default");const{immediate:o=!0,watch:i=!1}=s.value,a=Z(this.params,"query");this.limit=Z(a,"$limit"),this.skip=Z(a,"$skip");const u=l.computed(()=>({...s.value,$limit:this.limit.value,$skip:this.skip.value})),c=l.computed(()=>{const E={...s.value.query||{}},{$limit:q,$skip:_,...M}=E;return{...s.value,query:M}});this.onServer=!!s.value.onServer,this.isSsr=l.computed(()=>r.isSsr);const f=l.ref(!1),d=l.ref(!1),h=l.ref(!1),v=l.ref(null);this.isPending=l.computed(()=>f.value),this.haveBeenRequested=l.computed(()=>d.value),this.haveLoaded=l.computed(()=>h.value),this.error=l.computed(()=>v.value),this.clearError=()=>v.value=null,this.data=l.computed(()=>{if(f.value&&this.latestQuery.value&&this.onServer){const{pageParams:E,queryParams:q}=this.latestQuery.value,_={query:{...E,...q},onServer:!0};return It(r,_).value}return It(r,u).value}),this.allData=l.computed(()=>{var J,P;if(this.currentQuery==null)return[];const E=Object.keys(I._.omit((J=this.currentQuery.value)==null?void 0:J.queryState,"total","queryParams")),_=Object.values(I._.pick((P=this.currentQuery.value)==null?void 0:P.queryState,...E)).reduce((k,rt)=>(rt.ids.forEach(Mt=>{k.includes(Mt)||k.push(Mt)}),k),[]),M=I._.pick(r.itemsById,..._);return Object.values(M)}),this.findInStore=r.findInStore;let w=()=>!0;this.queryWhen=E=>{w=E},this.currentQuery=l.computed(()=>{const E=r.pagination[this.qid.value];if(!E)return null;const q=V(s.value);delete q.response,delete q.isOutdated;const _=E[q.queryId];if(!_)return null;const{total:M}=_,J=_[q.pageId];if(!J)return null;const{ids:P,queriedAt:k}=J,rt=Object.values(I._.pick(r.itemsById,...P));return{...q,ids:P,items:rt,total:M,queriedAt:k,queryState:_}||null});const y=l.ref([]);this.latestQuery=l.computed(()=>y.value[y.value.length-1]||null),this.previousQuery=l.computed(()=>y.value[y.value.length-2]||null);const g=l.computed(()=>r.countInStore(c.value));this.total=l.computed(()=>{var E;return this.onServer?(E=this.latestQuery.value)==null?void 0:E.response.total:g.value});const O=pe(this.limit,this.skip,this.total),{pageCount:b,currentPage:j,canPrev:L,canNext:A}=O;Object.assign(this,{pageCount:b,currentPage:j,canPrev:L,canNext:A});const B=async()=>{U.value&&await U.value};this.toStart=()=>B().then(()=>O.toStart()).then(()=>W()),this.toEnd=()=>B().then(()=>O.toEnd()).then(()=>W()),this.toPage=E=>B().then(()=>O.toPage(E)).then(()=>W()),this.next=()=>B().then(()=>O.next()).then(()=>W()),this.prev=()=>B().then(()=>O.prev()).then(()=>W()),this.requestCount=l.ref(0),this.request=l.ref(null),this.find=async(E=u)=>{const q=l.unref(E);if(!w())return Promise.resolve({data:[]});this.requestCount.value++,d.value=!0,f.value=!0,h.value=!1,v.value=null;try{const _=await r.find(q);if(N(_,"limit")&&this.limit.value==null||this.skip.value==null){const M=_;this.limit.value===void 0&&(this.limit.value=M.limit),this.skip.value===void 0&&(this.skip.value=M.skip)}if(_.total){const J=V(u,_);y.value.push(J),y.value.length>2&&y.value.shift()}return h.value=!0,_}catch(_){throw v.value=_,_}finally{f.value=!1}};let C=!1;const U=this.request;(this.limit.value||this.skip.value)&&(C=!0);const W=async E=>{if(!!this.onServer){if(this.requestCount.value===1&&!C&&!e){C=!0;return}U.value=this.find(E||s),await U.value}};if(this.onServer)if(e){let E;const q=_=>{if(_==null)return;const M=Je(_);gt(I._.omit(M,"store"),I._.omit(E,"store"))||(E=M,Ke(s,M),W())};l.watch(e,q,{immediate:o})}else i&&!e?l.watch(c,()=>W(),{immediate:o}):(!i&&o||o&&(this.limit.value==null||this.limit.value==null))&&W();return this}}function Bt(n,t){return new ve(n,t)}class ve{constructor(t,e){p(this,"id");p(this,"params");p(this,"isSsr");p(this,"data");p(this,"ids");p(this,"getFromStore");p(this,"get");p(this,"request");p(this,"requestCount");p(this,"queryWhen");p(this,"isPending");p(this,"hasBeenRequested");p(this,"hasLoaded");p(this,"error");p(this,"clearError");const r=l.unref(e).store,s=l.isRef(t)?l.isReadonly(t)?l.ref(t.value):t:l.ref(t),o=l.isRef(e)?l.isReadonly(e)?l.ref(e.value):e:l.ref(e);delete o.value.store,this.id=s,this.params=o;const{immediate:i=!0,watch:a=!0,onServer:u=!1}=o.value;this.isSsr=l.computed(()=>r.isSsr);const c=l.ref(!1),f=l.ref(!1),d=l.ref(!1),h=l.ref(null);this.isPending=l.computed(()=>c.value),this.hasBeenRequested=l.computed(()=>f.value),this.hasLoaded=l.computed(()=>d.value),this.error=l.computed(()=>h.value),this.clearError=()=>h.value=null,this.ids=l.ref([]);const v=l.computed(()=>this.ids.value.length&&this.ids.value[this.ids.value.length-1]);this.data=l.computed(()=>c.value&&v.value!=null?r.getFromStore(v.value,o)||null:r.getFromStore(s.value,o)||null),this.getFromStore=r.getFromStore;let w=()=>!0;this.queryWhen=O=>{w=O},this.requestCount=l.ref(0),this.request=l.ref(null),this.get=async(O,b)=>{const j=l.unref(O||s),L=l.unref(b);if(!!w()){if(j==null)throw new Error("id is required for feathers-pinia get requests");this.requestCount.value++,f.value=!0,c.value=!0,d.value=!1,h.value=null;try{const A=await r.get(j,L);return A&&j&&this.ids.value.push(j),d.value=!0,A}catch(A){throw h.value=A,A}finally{c.value=!1}}};const y=this.request,g=async(O,b)=>{!O||(y.value=this.get(O,b),await y.value)};return u&&a&&l.watch(s,async()=>{await g(s,o)},{immediate:i}),this}}function ye({model:n,params:t=l.computed(()=>null),fetchParams:e=l.computed(()=>{}),qid:r="default",queryWhen:s=l.computed(()=>!0),local:o=!1,immediate:i=!0}){if(!n)throw new Error("No model provided for useFind(). Did you define and register it with FeathersPinia?");const a=y=>{const g=l.unref(y),O=l.unref(e);return g||g===null?g:O||O===null?O:l.unref(t)},u=l.reactive({qid:r,isPending:!1,haveBeenRequested:!1,haveLoaded:o,error:null,debounceTime:null,latestQuery:null,isLocal:o,request:null}),c={items:It(n.store||n,t),paginationData:l.computed(()=>n.store.pagination),servicePath:l.computed(()=>n.servicePath),isSsr:l.computed(()=>n.store.isSsr)};function f(y,g){const O=l.unref(y);if(typeof O=="function"){const b=V(g,{}),j=n.store.pagination[b.qid],L=j==null?void 0:j[b.queryId],A=L==null?void 0:L[b.pageId],B={items:c.items,queryInfo:b,qidData:j,queryData:L,pageData:A,isPending:l.computed(()=>u.isPending),haveBeenRequested:l.computed(()=>u.haveBeenRequested),haveLoaded:l.computed(()=>u.haveLoaded),error:l.computed(()=>u.error)};return O(B)}return O}function d(y){if(u.isLocal)return;y=l.unref(y),u.isPending=!0,u.haveBeenRequested=!0;const g=n.find(y).then(O=>{if(u.error=null,u.haveLoaded=!0,!Array.isArray(O)){const b=V(y,O);b.isOutdated=!1,u.latestQuery=b}return u.isPending=!1,O});return u.request=g,g}const h={findDebounced(y){return d(y)}};function v(y){const g=a(y);if(g&&g.debounce)return g.debounce!==u.debounceTime&&(h.findDebounced=ct(d,g.debounce),u.debounceTime=g.debounce),h.findDebounced(g);if(g)return d(g)}const w=l.computed(()=>{const y=a();return typeof s.value=="function"?f(s.value,y):s.value});return l.watch(()=>[a(),w.value],([y,g])=>{g&&v()},{immediate:i}),{...c,...l.toRefs(u),find:v}}function ge({model:n,id:t,params:e=l.computed(()=>({})),queryWhen:r=l.computed(()=>!0),local:s=!1,immediate:o=!0}){if(!n)throw new Error("No model provided for useGetWatched(). Did you define and register it with FeathersPinia?");function i(){return l.unref(t)}function a(){return l.unref(e)}const u=l.reactive({isPending:!1,hasBeenRequested:!1,hasLoaded:!1,error:null,isLocal:s,request:null}),c={item:l.computed(()=>{const d=i();return d===null?null:n.getFromStore(d,a())||null}),servicePath:l.computed(()=>n.servicePath),isSsr:l.computed(()=>n.store.isSsr)};async function f(d,h){const v=l.unref(d),w=l.unref(h);if(v!=null&&r.value&&!u.isLocal){u.isPending=!0,u.error=null,u.hasBeenRequested=!0;const y=w!=null?n.get(v,w):n.get(v);u.request=y;try{const g=await y;return u.isPending=!1,u.hasLoaded=!0,g}catch(g){return u.isPending=!1,u.error=g,g}}else return Promise.resolve(void 0)}return l.watch(()=>[i(),a(),r.value],([d,h])=>{f(d,h)},{immediate:o}),l.watch(()=>c.item.value,d=>{d&&(u.error=null)}),{...l.toRefs(u),...c,get:f}}function tr(n){return Object.assign({find(e){const r=Y(e),{query:s={}}=r;(r.paginate===!0||N(s,"$limit")||N(s,"$skip"))&&(r.paginate={default:!0}),this.setPendingById("Model","find",!0);const i=V(r,{}),a=this.pagination[i.qid],u=a==null?void 0:a[i.queryId],c=u==null?void 0:u[i.pageId];let f;if(c!=null&&c.ssr){const d={data:c.ids.map(h=>this.getFromStore(h)),limit:c.pageParams.$limit,skip:c.pageParams.$skip,total:u.total,fromSsr:!0};f=Promise.resolve(d),r.preserveSsr||this.unflagSsr(r)}return(f||this.service.find(r)).then(d=>this.handleFindResponse({params:r,response:d})).catch(d=>this.handleFindError({params:r,error:d})).finally(()=>{this.setPendingById("Model","find",!1)})},async handleFindResponse({params:e,response:r}){const{idField:s}=this,{qid:o="default",query:i,preserveSsr:a=!1}=e;Array.isArray(r)&&(r={data:r}),this.addOrUpdate(r.data),r.data&&this.updatePaginationForQuery({qid:o,response:r,query:i,preserveSsr:a});const c=r.data.map(f=>this.itemsById[$(f,s)]);return c[0]!==void 0&&(r.data?r.data=c:r=c),r=await this.afterFind(r),r},async afterFind(e){return e},handleFindError({error:e}){return Promise.reject(e)},count(e){const r=Y(e),{query:s={}}=r;return s.$limit=0,Object.assign(r,{query:s}),this.setPendingById("Model","count",!0),this.service.find(r).finally(()=>{this.setPendingById("Model","count",!1)})},get(e,r){const s=Y(r),o=s.skipRequestIfExists||this.skipRequestIfExists;delete s.skipRequestIfExists;const i=this.getFromStore(e,s);return i&&o?Promise.resolve(i):(this.setPendingById("Model","get",!0),this.service.get(e,s).then(a=>(this.addOrUpdate(a),this.setPendingById("Model","get",!1),this.itemsById[e])).catch(a=>(this.setPendingById("Model","get",!1),Promise.reject(a))))},create(e,r){const s=Y(r),{idField:o,tempIdField:i}=this;return Array.isArray(e)||this.setPendingById($(e,o)||e[i],"create",!0),this.service.create(mt(e,this.Model.tempIdField),s).then(a=>this.addOrUpdate(We(e,a,this.Model.tempIdField))).catch(a=>Promise.reject(a)).finally(()=>{Array.isArray(e)||this.setPendingById($(e,o)||e[i],"create",!1)})},update(e,r,s){const o=Y(s);return this.setPendingById(e,"update",!0),this.service.update(e,mt(r,this.Model.tempIdField),o).then(i=>this.addOrUpdate(i)).catch(i=>Promise.reject(i)).finally(()=>{this.setPendingById(e,"update",!1)})},patch(e,r,s){const o=Y(s);return o&&o.data&&(r=o.data),this.setPendingById(e,"patch",!0),this.service.patch(e,mt(r,this.Model.tempIdField),o).then(i=>this.addOrUpdate(i)).catch(i=>Promise.reject(i)).finally(()=>{this.setPendingById(e,"patch",!1)})},remove(e,r){const s=Y(r);return this.setPendingById(e,"remove",!0),this.service.remove(e,s).then(o=>(this.setPendingById(e,"remove",!1),this.removeFromStore(o),o)).catch(o=>(this.setPendingById(e,"remove",!1),Promise.reject(o)))},removeFromStore(e){const{items:r}=X(e),{idField:s,tempIdField:o}=this,i=r.map(a=>$(a,s)!=null?$(a,s):K(a,o)).filter(a=>a!=null);return l.set(this,"itemsById",I._.omit(this.itemsById,...i)),l.set(this,"clonesById",I._.omit(this.clonesById,...i)),l.set(this,"pendingById",I._.omit(this.pendingById,...i)),l.set(this,"tempsById",I._.omit(this.tempsById,...i)),e},addToStore(e){return this.addOrUpdate(e)},addOrUpdate(e){const{idField:r,tempIdField:s}=this,{items:o,isArray:i}=X(e),a=o.map(u=>$(u,r)!=null&&K(u,s)!=null?this.moveTempToItems(u):nr(u,this,n));return i?a:a[0]},moveTempToItems(e){const{idField:r,tempIdField:s}=this,o=$(e,r),i=K(e,s),a=this.tempsById[i];return a&&(l.set(this.itemsById,o,Object.assign(a,e)),delete this.tempsById[i],delete this.itemsById[o][s]),delete e[s],this.itemsById[o]},clearAll(){l.set(this,"itemsById",{}),l.set(this,"tempsById",{}),l.set(this,"clonesById",{})},clone(e,r={},s={}){const i=K(e,this.Model.tempIdField)!=null?"tempsById":"itemsById",a=st(e,this.Model.tempIdField,this.Model.idField),u=this[i][a],c=this.clonesById[a];if(c)return s.useExisting?c:this.reset(e,r);{const f=G(u);return Jt(f),Kt(u,f,f.Model.associations),Object.assign(f,r),l.set(this.clonesById,a,f),this.clonesById[a]}},commit(e,r={}){const s=st(e,this.Model.tempIdField,this.Model.idField);if(s!=null){const i=K(e,this.Model.tempIdField)!=null?"tempsById":"itemsById",a=this.clonesById[s],u=G(a);return Object.assign(u,r),Kt(a,u,a.Model.associations),l.set(this[i],s,u),this[i][s]}},reset(e,r={}){const o=K(e,this.Model.tempIdField)!=null?"tempsById":"itemsById",i=st(e,this.Model.tempIdField,this.Model.idField),a=this[o][i],u=this.clonesById[i];if(!u)return this.clone(e,r);const c=Object.assign(u,a,r);return Object.keys(c).forEach(f=>{N(a,f)||delete c[f]}),Jt(c),c},updatePaginationForQuery({qid:e,response:r,query:s={},preserveSsr:o=!1}){var B,C;const{data:i,total:a}=r,{idField:u}=this,c=i.map(U=>$(U,u)),f=new Date().getTime(),{queryId:d,queryParams:h,pageId:v,pageParams:w}=V({qid:e,query:s},r);this.pagination[e]||l.set(this.pagination,e,{}),!N(s,"$limit")&&N(r,"limit")&&l.set(this.pagination,"defaultLimit",r.limit),!N(s,"$skip")&&N(r,"skip")&&l.set(this.pagination,"defaultSkip",r.skip);const y={query:s,queryId:d,queryParams:h,pageId:v,pageParams:w,queriedAt:f,total:a},g=(C=(B=this.pagination[e])==null?void 0:B[d])==null?void 0:C[v],O=this.pagination[e]||{};Object.assign(O,{mostRecent:y}),l.set(O,d,O[d]||{});const b={total:a,queryParams:h};l.set(O,d,Object.assign({},O[d],b));const j=o?g==null?void 0:g.ssr:l.unref(n.ssr),L={[v]:{pageParams:w,ids:c,queriedAt:f,ssr:!!j}};Object.assign(O[d],L);const A=Object.assign({},this.pagination[e],O);l.set(this.pagination,e,A)},setPendingById(e,r,s){e!=null&&(l.set(this.pendingById,e,this.pendingById[e]||{[r]:s}),l.set(this.pendingById[e],r,s))},hydrateAll(){this.addToStore(this.items)},toggleEventLock(e,r){er(e,r,!0,this)},unflagSsr(e){var u,c;const r=V(e,{}),{qid:s,queryId:o,pageId:i}=r,a=(c=(u=this.pagination[s])==null?void 0:u[o])==null?void 0:c[i];a.ssr=!1},useFind(e){return(e.value||e).store=this,qt(e)},useGet(e,r={}){return(r.value||r).store=this,Bt(e,r)},useGetOnce(e,r={}){Object.assign(r.value||r,{store:this,immediate:!1,onServer:!0});const s=Bt(e,r);return s.queryWhen(()=>!s.data.value),s.get(),s},useFindWatched(e){return ye({model:this.Model,...e})},useGetWatched(e){return ge({model:this.Model,...e})}},n.actions)}function er(n,t,e,r){const{items:s}=X(n);s.forEach(o=>{r.eventLocksById[t][o]?delete r.eventLocksById[t][o]:l.set(r.eventLocksById[t],o,!0)})}function nr(n,t,e){const{idField:r,tempIdField:s,servicePath:o,isSsr:i}=t,a=$(n,r)!=null?"itemsById":"tempsById";a==="tempsById"&&!n[s]&&Ue(n,s);const u=st(n,s,r),c=t[a][u];if(c?Object.assign(c,n):t[a][u]=new e.Model(n),i||!(n instanceof e.Model)){const d={[o]:e.Model};t[a][u]=new d[o](c?Object.assign(c,n):n)}return t[a][u]}function me(n){const t=rr(n),{servicePath:e,idField:r,tempIdField:s,handleEvents:o,debounceEventsTime:i,debounceEventsGuarantee:a,clientAlias:u,Model:c}=t;let f=!1;Object.keys(t.clients||{}).forEach(g=>{St(g,t.clients[g])});const d=t.id||`service.${t.servicePath}`,h=rn({clientAlias:u,servicePath:e,idField:r,tempIdField:s,whitelist:t.whitelist,paramsForServer:t.paramsForServer,skipRequestIfExists:t.skipRequestIfExists,state:t.state}),v=Dn({clients:z,Model:c,ssr:t.ssr,getters:t.getters}),w=tr({clients:z,getters:v,actions:t.actions,Model:c,ssr:t.ssr});function y(g){const b=xt.defineStore({id:d,state:h,getters:v,actions:w})(g);if(b.isSsr,!f){f=!0,Object.assign(t.Model,{store:b,pinia:g,servicePath:t.servicePath,idField:r,tempIdField:s,clients:z,...Object.keys(t.actions).reduce((B,C)=>{const U=t.actions[C];return B[C]=U.bind(b),B},{})});const j=z[u];if(!j)throw new Error(`There is no registered FeathersClient named '${u}'. You need to provide one in the 'defineStore' options.`);const L=j.service(e),A={idField:r,debounceEventsTime:i,debounceEventsGuarantee:a,handleEvents:o};Ve(t.Model,b),nn({service:L,Model:c,store:b,options:A})}return b}return y}function rr(n){var o,i,a,u,c;const e=Object.assign({clientAlias:"api",servicePath:"",idField:"id",tempIdField:"__tempId",paramsForServer:[],whitelist:[],skipRequestIfExists:!1},{id:`service.${n.servicePath}`,ssr:!1,clients:{},enableEvents:!0,handleEvents:{},debounceEventsTime:20,debounceEventsGuarantee:!1,state:()=>({}),getters:{},actions:{}});let r;n.Model?r=n.Model:r=(o=class extends x{},p(o,"dynamicBaseModel",!0),p(o,"modelName",n.servicePath),o),r.modelName||(r.modelName=r.name);const s=Object.assign(e,{Model:r},n);return(i=s.handleEvents).created||(i.created=()=>s.enableEvents),(a=s.handleEvents).patched||(a.patched=()=>s.enableEvents),(u=s.handleEvents).updated||(u.updated=()=>s.enableEvents),(c=s.handleEvents).removed||(c.removed=()=>s.enableEvents),s}function sr(n){const{clients:t}=n;Object.keys(t).forEach(r=>{St(r,t[r])});function e(...r){const s=r.length===2?r[0]:r[0].id,o=r.length===2?r[1]:r[0];return o.id=s||`service.${o.servicePath}`,me(Object.assign({},n,o))}return{defineStore:e,BaseModel:x}}function ir(...n){const t=n.length===2?n[0]:n[0].id||"auth",e=n.length===2?n[1]:n[0],{feathersClient:r,state:s=()=>({}),getters:o={},actions:i={}}=e,a={isLoading:!0,isAuthenticated:!1,accessToken:null,payload:null,error:null},u={feathersClient(){return r}},c={async authenticate(d){try{const h=await r.authenticate(d);return Object.assign(this,{...h,isAuthenticated:!0}),this.handleResponse(h)||h}catch(h){return this.error=h,this.handleError(h)}},handleResponse(d){return d},handleError(d){return Promise.reject(d)},setLoaded(){this.isLoading=!1}};return xt.defineStore({id:t,state:()=>Object.assign(a,s()),getters:Object.assign(u,o),actions:Object.assign(c,i)})}function ht(n,t,e){if(e){const r=e(n);return r.temps!==!1&&(r.temps=!0),Object.assign({},r,{store:t})}}function or(n){return n}function Oe(n,t,e,r,s){const o={name:e,Model:r,type:"get"},i=t||or;n.Model.associations[e]||(n.Model.associations[e]=o);const a=`${s}${e}`;return{_handleSetInstance:i,propUtilName:a}}function ar(n,t,{Model:e,makeParams:r,handleSetInstance:s,propUtilsPrefix:o="_"}){const i=n[t],{_handleSetInstance:a,propUtilName:u}=Oe(n,s,t,e,o);let c;function f(d){if(!r)return null;const h=ht(d,e.store,r);c=new Lt(h),c.useFind=v=>{const w=v.value||v;return w.store=e.store,qt(v)}}if(Object.defineProperty(n,t,{enumerable:!1,get(){return c||f(this),c.data.value},set(d){d.map(h=>new e(h).addToStore()).map(h=>a.call(this,h))}}),Object.defineProperty(n,u,{enumerable:!1,get(){return c||f(this),c}}),i){const d=n;d[t]=i}}function ur(n,t,{Model:e,getId:r,makeParams:s,handleSetInstance:o,propUtilsPrefix:i="_"}){const a=n[t],{_handleSetInstance:u,propUtilName:c}=Oe(n,o,t,e,i),f={get(d,h){const v=r(n)||d,w=ht(n,e.store,s)||h;return e.get(v,w)},getFromStore(d,h){const v=n.getId()||d,w=ht(n,e.store,s)||h;return e.getFromStore(v,w)}};if(Object.defineProperty(n,t,{enumerable:!1,get(){const d=r(this);let h;return s&&(h=ht(this,e.store,s)),e.getFromStore(d,h)},set(d){const h=new e(d).addToStore();return u.call(this,h)}}),Object.defineProperty(n,c,{configurable:!0,enumerable:!1,value:f}),a){const d=n;d[t]=a}}class cr extends be.FetchClient{async request(t,e){const r=Object.assign({},t,e.connection);r.headers=Object.assign({Accept:"application/json"},this.options.headers,r.headers),t.body&&(r.body=t.body);try{const s=await this.connection.raw(t.url,r),{_data:o,status:i}=s;return i===204?null:o}catch(s){throw console.error("feathers-ofetch request error",s),s}}}function lr(n,t){const e=Z(n,"$limit"),r=Z(n,"$skip"),s=l.computed(()=>t.value.response.total),{pageCount:o,currentPage:i,canPrev:a,canNext:u,toStart:c,toEnd:f,toPage:d,next:h,prev:v}=pe(e,r,s),w=l.computed(()=>{const y=l.unref(t);return y&&y.response?y.response.total:0});return l.watch(()=>o.value,()=>{const y=t.value;y&&y.response&&i.value>o.value&&(i.value=o.value)}),{itemsCount:w,pageCount:o,currentPage:i,canPrev:a,canNext:u,toStart:c,toEnd:f,toPage:d,next:h,prev:v}}function Ie(n,t,e={}){const{useExisting:r=!1,deep:s=!1}=e,o=s?l.computed(i):l.ref(null);function i(){const u=n[t];if(!(u instanceof x))return null;const c=u,f=c.getAnyId();return c.Model.getFromStore(f)||c.addToStore(),c?c==null?void 0:c.clone(void 0,{useExisting:r}):null}let a=null;return s||l.watchEffect(()=>{l.toRefs(l.reactive(n));const u=n[t];if(!u)a=null,o.value=null;else if(u.getAnyId){const c=u.getAnyId();c!==a&&(a=c,o.value=i())}}),o}function fr(n,t={}){const e=l.reactive({});return Object.keys(n).forEach(r=>{e[r]=Ie(n,r,t)}),l.toRefs(e)}function At(n){this.message=n}At.prototype=new Error,At.prototype.name="InvalidCharacterError";var we=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var t=String(n).replace(/=+$/,"");if(t.length%4==1)throw new At("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,r,s=0,o=0,i="";r=t.charAt(o++);~r&&(e=s%4?64*e+r:r,s++%4)?i+=String.fromCharCode(255&e>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};function dr(n){var t=n.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(we(e).replace(/(.)/g,function(r,s){var o=s.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(t)}catch{return we(t)}}function pt(n){this.message=n}function hr(n,t){if(typeof n!="string")throw new pt("Invalid token specified");var e=(t=t||{}).header===!0?0:1;try{return JSON.parse(dr(n.split(".")[e]))}catch(r){throw new pt("Invalid token specified: "+r.message)}}pt.prototype=new Error,pt.prototype.name="InvalidTokenError";const pr=n=>{const{api:t,userStore:e,skipTokenCheck:r}=n,s=n.entityKey||"user",o=T.ref(),i=async()=>{},a=async P=>{throw P},u=n.onSuccess||i,c=n.onError||a,f=n.onInitSuccess||i,d=n.onInitError||i,h=n.onLogoutSuccess||i,v=n.onLogoutError||a,w=T.ref(null),y=T.computed(()=>(e==null?void 0:e.getFromStore(w))||null),g=T.ref(null),O=()=>g.value=null,b=Se(),j=T.computed(()=>!!b.count.value),L=T.ref(!1),A=async P=>(b.add(),O(),o.value=t.authenticate(P).then(B).then(async k=>await u(k)||k).catch(k=>(g.value=k,c(k))),o.value),B=P=>{const k=P[s];if(e&&k){const rt=e.addToStore(k);w.value=rt.getId()}return L.value=!0,P},C=T.ref(!1),U=()=>{b.sub(),C.value=!0},W=async()=>(b.add(),o.value=t.authentication.getAccessToken().then(P=>{if(P&&!r&&E(P))throw t.authentication.removeAccessToken(),new Pe.BadRequest("accessToken expired")}).then(()=>t.reAuthenticate()).then(B).then(async P=>await f(P)||P).catch(d).finally(()=>U()),o.value),E=P=>{try{const k=hr(P);return new Date().getTime()>k.exp*1e3}catch{return!1}},q=Se(),_=T.computed(()=>!!q.count.value),M=async()=>(q.add(),t.logout().then(P=>(w.value=null,L.value=!1,P)).then(h).catch(P=>(P.value=P,v(P))).finally(()=>q.sub())),J=T.ref(null);return{user:y,error:g,isPending:j,isLogoutPending:_,isInitDone:C,isAuthenticated:L,loginRedirect:J,getPromise:()=>o.value,isTokenExpired:E,authenticate:A,reAuthenticate:W,logout:M,clearError:O}},Se=()=>{const n=T.ref(0);return{count:n,add:()=>{n.value=n.value+1},sub:()=>{n.value=n.value===0?0:n.value-1}}};function vr(n,t,e){const r=JSON.stringify(t);e.setItem(n,r)}function yr(n,t){const e=t.getItem(n.$id);if(e){const r=JSON.parse(e)||{};Object.assign(n,r)}}function gr(n,t,e=window.localStorage){yr(n,e);const r=ct(vr,500),s=l.computed(()=>I._.pick(n,...t));l.watch(s,o=>r(n.$id,o,e),{deep:!0})}function mr(n=window.localStorage){Object.keys(n).map(t=>{t.startsWith("service.")&&n.removeItem(t)})}m.BaseModel=x,m.Find=Lt,m.Get=ve,m.OFetch=cr,m.associateFind=ar,m.associateGet=ur,m.clearStorage=mr,m.clients=z,m.defineAuthStore=ir,m.defineStore=me,m.models=H,m.registerClient=St,m.setupFeathersPinia=sr,m.syncWithStorage=gr,m.useAuth=pr,m.useClone=Ie,m.useClones=fr,m.useFind=qt,m.useFindWatched=ye,m.useGet=Bt,m.useGetWatched=ge,m.usePagination=lr,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=feathers-pinia.umd.js.map
