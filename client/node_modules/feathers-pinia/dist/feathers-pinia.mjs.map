{"version":3,"file":"feathers-pinia.mjs","sources":["../node_modules/fast-json-stable-stringify/index.js","../node_modules/isomorphic-mongo-objectid/src/isomorphic-mongo-objectid.js","../node_modules/isomorphic-mongo-objectid/index.js","../node_modules/fast-copy/dist/fast-copy.esm.js","../node_modules/fast-deep-equal/index.js","../src/utils.ts","../src/models.ts","../node_modules/events/events.js","../src/service-store/base-model.ts","../src/clients.ts","../node_modules/just-debounce/index.js","../src/service-store/events.ts","../src/service-store/make-state.ts","../node_modules/sift/es5m/index.js","../src/utils-custom-operators.ts","../src/service-store/make-getters.ts","../src/utils-pagination.ts","../src/use-find.ts","../src/use-get.ts","../src/use-find-watched.ts","../src/use-get-watched.ts","../src/service-store/make-actions.ts","../src/service-store/define-store.ts","../src/setup.ts","../src/define-auth-store.ts","../src/associate-utils.ts","../src/associate-find.ts","../src/associate-get.ts","../src/feathers-ofetch.ts","../src/use-pagination.ts","../src/use-clone.ts","../src/use-clones.ts","../node_modules/jwt-decode/build/jwt-decode.esm.js","../src/use-auth.ts","../src/storage-sync.ts","../src/clear-storage.ts"],"sourcesContent":["'use strict';\n\nmodule.exports = function (data, opts) {\n    if (!opts) opts = {};\n    if (typeof opts === 'function') opts = { cmp: opts };\n    var cycles = (typeof opts.cycles === 'boolean') ? opts.cycles : false;\n\n    var cmp = opts.cmp && (function (f) {\n        return function (node) {\n            return function (a, b) {\n                var aobj = { key: a, value: node[a] };\n                var bobj = { key: b, value: node[b] };\n                return f(aobj, bobj);\n            };\n        };\n    })(opts.cmp);\n\n    var seen = [];\n    return (function stringify (node) {\n        if (node && node.toJSON && typeof node.toJSON === 'function') {\n            node = node.toJSON();\n        }\n\n        if (node === undefined) return;\n        if (typeof node == 'number') return isFinite(node) ? '' + node : 'null';\n        if (typeof node !== 'object') return JSON.stringify(node);\n\n        var i, out;\n        if (Array.isArray(node)) {\n            out = '[';\n            for (i = 0; i < node.length; i++) {\n                if (i) out += ',';\n                out += stringify(node[i]) || 'null';\n            }\n            return out + ']';\n        }\n\n        if (node === null) return 'null';\n\n        if (seen.indexOf(node) !== -1) {\n            if (cycles) return JSON.stringify('__cycle__');\n            throw new TypeError('Converting circular structure to JSON');\n        }\n\n        var seenIndex = seen.push(node) - 1;\n        var keys = Object.keys(node).sort(cmp && cmp(node));\n        out = '';\n        for (i = 0; i < keys.length; i++) {\n            var key = keys[i];\n            var value = stringify(node[key]);\n\n            if (!value) continue;\n            if (out) out += ',';\n            out += JSON.stringify(key) + ':' + value;\n        }\n        seen.splice(seenIndex, 1);\n        return '{' + out + '}';\n    })(data);\n};\n","/*!\n * isomorphic-mongo-objectid - v@version@\n * Pure JavaScript implementation of mongodb ObjectId for the browser and server\n * https://github.com/john-doherty/isomorphic-mongo-objectid\n * @author John Doherty <www.johndoherty.info>\n * @license MIT\n */\n(function () {\n\n    'use strict';\n\n    /*\n     * Refactored version of source by Jonathan HÃ¤berle (jonathan.haeberle@gmail.com)\n     * https://github.com/dreampulse/ObjectId.js\n     */\n\n    var _increment = 0;\n    var _pid = Math.floor(Math.random() * (32767));\n    var _machine = Math.floor(Math.random() * (16777216));\n\n    if (typeof window !== 'undefined') {\n\n        var storage = window.localStorage;\n\n        var mongoMachineId = parseInt(storage.mongoMachineId, 10);\n\n        if (mongoMachineId >= 0 && mongoMachineId <= 16777215) {\n            _machine = Math.floor(storage.mongoMachineId);\n        }\n\n        storage.mongoMachineId = _machine;\n    }\n\n    /**\n     * Creates a new mongo db style ObjectID\n     * @returns {ObjectID} instance of ObjectID\n     */\n    function ObjectID() {\n\n        var args = arguments;\n\n        if (!(this instanceof ObjectID)) {\n            if (args.length > 0) {\n                return new ObjectID(args[0], args[1], args[2], args[3]);\n            }\n            else {\n                return new ObjectID();\n            }\n        }\n\n        if (typeof args[0] === 'object') {\n            this.timestamp = args[0].timestamp;\n            this.machine = args[0].machine;\n            this.pid = args[0].pid;\n            this.increment = args[0].increment;\n        }\n        else if (typeof args[0] === 'string' && args[0].length === 24) {\n            this.timestamp = Number('0x' + args[0].substr(0, 8));\n            this.machine = Number('0x' + args[0].substr(8, 6));\n            this.pid = Number('0x' + args[0].substr(14, 4));\n            this.increment = Number('0x' + args[0].substr(18, 6));\n        }\n        else if (args.length === 4 && args[0] !== null) {\n            this.timestamp = args[0];\n            this.machine = args[1];\n            this.pid = args[2];\n            this.increment = args[3];\n        }\n        else {\n            this.timestamp = Math.floor(new Date().valueOf() / 1000);\n            this.machine = _machine;\n            this.pid = _pid;\n            this.increment = _increment++;\n            if (_increment > 0xffffff) {\n                _increment = 0;\n            }\n        }\n    }\n\n    ObjectID.prototype.getDate = function () {\n        return new Date(this.timestamp * 1000);\n    };\n\n    ObjectID.prototype.toArray = function () {\n        var strOid = this.toString();\n        var array = [];\n        var i;\n        for (i = 0; i < 12; i++) {\n            array[i] = parseInt(strOid.slice(i * 2, i * 2 + 2), 16);\n        }\n        return array;\n    };\n\n    ObjectID.prototype.toString = function () {\n\n        var timestamp = this.timestamp.toString(16);\n        var machine = this.machine.toString(16);\n        var pid = this.pid.toString(16);\n        var increment = this.increment.toString(16);\n\n        return [\n            '00000000'.substr(0, 8 - timestamp.length) + timestamp,\n            '000000'.substr(0, 6 - machine.length) + machine,\n            '0000'.substr(0, 4 - pid.length) + pid,\n            '000000'.substr(0, 6 - increment.length) + increment\n        ].join('');\n    };\n\n    if (typeof module !== 'undefined') {\n        module.exports = ObjectID;\n    }\n    else {\n        window.ObjectID = ObjectID;\n    }\n\n})();\n","module.exports = require('./src/isomorphic-mongo-objectid.js');\n","var toStringFunction = Function.prototype.toString;\nvar create = Object.create, defineProperty = Object.defineProperty, getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor, getOwnPropertyNames = Object.getOwnPropertyNames, getOwnPropertySymbols = Object.getOwnPropertySymbols, getPrototypeOf$1 = Object.getPrototypeOf;\nvar _a = Object.prototype, hasOwnProperty = _a.hasOwnProperty, propertyIsEnumerable = _a.propertyIsEnumerable;\nvar SYMBOL_PROPERTIES = typeof getOwnPropertySymbols === 'function';\nvar WEAK_MAP = typeof WeakMap === 'function';\n/**\n * @function createCache\n *\n * @description\n * get a new cache object to prevent circular references\n *\n * @returns the new cache object\n */\nvar createCache = (function () {\n    if (WEAK_MAP) {\n        return function () { return new WeakMap(); };\n    }\n    var Cache = /** @class */ (function () {\n        function Cache() {\n            this._keys = [];\n            this._values = [];\n        }\n        Cache.prototype.has = function (key) {\n            return !!~this._keys.indexOf(key);\n        };\n        Cache.prototype.get = function (key) {\n            return this._values[this._keys.indexOf(key)];\n        };\n        Cache.prototype.set = function (key, value) {\n            this._keys.push(key);\n            this._values.push(value);\n        };\n        return Cache;\n    }());\n    return function () { return new Cache(); };\n})();\n/**\n * @function getCleanClone\n *\n * @description\n * get an empty version of the object with the same prototype it has\n *\n * @param object the object to build a clean clone from\n * @param realm the realm the object resides in\n * @returns the empty cloned object\n */\nvar getCleanClone = function (object, realm) {\n    var prototype = object.__proto__ || getPrototypeOf$1(object);\n    if (!prototype) {\n        return create(null);\n    }\n    var Constructor = prototype.constructor;\n    if (Constructor === realm.Object) {\n        return prototype === realm.Object.prototype ? {} : create(prototype);\n    }\n    if (~toStringFunction.call(Constructor).indexOf('[native code]')) {\n        try {\n            return new Constructor();\n        }\n        catch (_a) { }\n    }\n    return create(prototype);\n};\n/**\n * @function getObjectCloneLoose\n *\n * @description\n * get a copy of the object based on loose rules, meaning all enumerable keys\n * and symbols are copied, but property descriptors are not considered\n *\n * @param object the object to clone\n * @param realm the realm the object resides in\n * @param handleCopy the function that handles copying the object\n * @returns the copied object\n */\nvar getObjectCloneLoose = function (object, realm, handleCopy, cache) {\n    var clone = getCleanClone(object, realm);\n    // set in the cache immediately to be able to reuse the object recursively\n    cache.set(object, clone);\n    for (var key in object) {\n        if (hasOwnProperty.call(object, key)) {\n            clone[key] = handleCopy(object[key], cache);\n        }\n    }\n    if (SYMBOL_PROPERTIES) {\n        var symbols = getOwnPropertySymbols(object);\n        for (var index = 0, length_1 = symbols.length, symbol = void 0; index < length_1; ++index) {\n            symbol = symbols[index];\n            if (propertyIsEnumerable.call(object, symbol)) {\n                clone[symbol] = handleCopy(object[symbol], cache);\n            }\n        }\n    }\n    return clone;\n};\n/**\n * @function getObjectCloneStrict\n *\n * @description\n * get a copy of the object based on strict rules, meaning all keys and symbols\n * are copied based on the original property descriptors\n *\n * @param object the object to clone\n * @param realm the realm the object resides in\n * @param handleCopy the function that handles copying the object\n * @returns the copied object\n */\nvar getObjectCloneStrict = function (object, realm, handleCopy, cache) {\n    var clone = getCleanClone(object, realm);\n    // set in the cache immediately to be able to reuse the object recursively\n    cache.set(object, clone);\n    var properties = SYMBOL_PROPERTIES\n        ? getOwnPropertyNames(object).concat(getOwnPropertySymbols(object))\n        : getOwnPropertyNames(object);\n    for (var index = 0, length_2 = properties.length, property = void 0, descriptor = void 0; index < length_2; ++index) {\n        property = properties[index];\n        if (property !== 'callee' && property !== 'caller') {\n            descriptor = getOwnPropertyDescriptor(object, property);\n            if (descriptor) {\n                // Only clone the value if actually a value, not a getter / setter.\n                if (!descriptor.get && !descriptor.set) {\n                    descriptor.value = handleCopy(object[property], cache);\n                }\n                try {\n                    defineProperty(clone, property, descriptor);\n                }\n                catch (error) {\n                    // Tee above can fail on node in edge cases, so fall back to the loose assignment.\n                    clone[property] = descriptor.value;\n                }\n            }\n            else {\n                // In extra edge cases where the property descriptor cannot be retrived, fall back to\n                // the loose assignment.\n                clone[property] = handleCopy(object[property], cache);\n            }\n        }\n    }\n    return clone;\n};\n/**\n * @function getRegExpFlags\n *\n * @description\n * get the flags to apply to the copied regexp\n *\n * @param regExp the regexp to get the flags of\n * @returns the flags for the regexp\n */\nvar getRegExpFlags = function (regExp) {\n    var flags = '';\n    if (regExp.global) {\n        flags += 'g';\n    }\n    if (regExp.ignoreCase) {\n        flags += 'i';\n    }\n    if (regExp.multiline) {\n        flags += 'm';\n    }\n    if (regExp.unicode) {\n        flags += 'u';\n    }\n    if (regExp.sticky) {\n        flags += 'y';\n    }\n    return flags;\n};\n\n// utils\nvar isArray = Array.isArray;\nvar getPrototypeOf = Object.getPrototypeOf;\nvar GLOBAL_THIS = (function () {\n    if (typeof globalThis !== 'undefined') {\n        return globalThis;\n    }\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    if (console && console.error) {\n        console.error('Unable to locate global object, returning \"this\".');\n    }\n    return this;\n})();\n/**\n * @function copy\n *\n * @description\n * copy an value deeply as much as possible\n *\n * If `strict` is applied, then all properties (including non-enumerable ones)\n * are copied with their original property descriptors on both objects and arrays.\n *\n * The value is compared to the global constructors in the `realm` provided,\n * and the native constructor is always used to ensure that extensions of native\n * objects (allows in ES2015+) are maintained.\n *\n * @param value the value to copy\n * @param [options] the options for copying with\n * @param [options.isStrict] should the copy be strict\n * @param [options.realm] the realm (this) value the value is copied from\n * @returns the copied value\n */\nfunction copy(value, options) {\n    // manually coalesced instead of default parameters for performance\n    var isStrict = !!(options && options.isStrict);\n    var realm = (options && options.realm) || GLOBAL_THIS;\n    var getObjectClone = isStrict ? getObjectCloneStrict : getObjectCloneLoose;\n    /**\n     * @function handleCopy\n     *\n     * @description\n     * copy the value recursively based on its type\n     *\n     * @param value the value to copy\n     * @returns the copied value\n     */\n    var handleCopy = function (value, cache) {\n        if (!value || typeof value !== 'object') {\n            return value;\n        }\n        if (cache.has(value)) {\n            return cache.get(value);\n        }\n        var prototype = value.__proto__ || getPrototypeOf(value);\n        var Constructor = prototype && prototype.constructor;\n        // plain objects\n        if (!Constructor || Constructor === realm.Object) {\n            return getObjectClone(value, realm, handleCopy, cache);\n        }\n        var clone;\n        // arrays\n        if (isArray(value)) {\n            // if strict, include non-standard properties\n            if (isStrict) {\n                return getObjectCloneStrict(value, realm, handleCopy, cache);\n            }\n            clone = new Constructor();\n            cache.set(value, clone);\n            for (var index = 0, length_1 = value.length; index < length_1; ++index) {\n                clone[index] = handleCopy(value[index], cache);\n            }\n            return clone;\n        }\n        // dates\n        if (value instanceof realm.Date) {\n            return new Constructor(value.getTime());\n        }\n        // regexps\n        if (value instanceof realm.RegExp) {\n            clone = new Constructor(value.source, value.flags || getRegExpFlags(value));\n            clone.lastIndex = value.lastIndex;\n            return clone;\n        }\n        // maps\n        if (realm.Map && value instanceof realm.Map) {\n            clone = new Constructor();\n            cache.set(value, clone);\n            value.forEach(function (value, key) {\n                clone.set(key, handleCopy(value, cache));\n            });\n            return clone;\n        }\n        // sets\n        if (realm.Set && value instanceof realm.Set) {\n            clone = new Constructor();\n            cache.set(value, clone);\n            value.forEach(function (value) {\n                clone.add(handleCopy(value, cache));\n            });\n            return clone;\n        }\n        // blobs\n        if (realm.Blob && value instanceof realm.Blob) {\n            return value.slice(0, value.size, value.type);\n        }\n        // buffers (node-only)\n        if (realm.Buffer && realm.Buffer.isBuffer(value)) {\n            clone = realm.Buffer.allocUnsafe\n                ? realm.Buffer.allocUnsafe(value.length)\n                : new Constructor(value.length);\n            cache.set(value, clone);\n            value.copy(clone);\n            return clone;\n        }\n        // arraybuffers / dataviews\n        if (realm.ArrayBuffer) {\n            // dataviews\n            if (realm.ArrayBuffer.isView(value)) {\n                clone = new Constructor(value.buffer.slice(0));\n                cache.set(value, clone);\n                return clone;\n            }\n            // arraybuffers\n            if (value instanceof realm.ArrayBuffer) {\n                clone = value.slice(0);\n                cache.set(value, clone);\n                return clone;\n            }\n        }\n        // if the value cannot / should not be cloned, don't\n        if (\n        // promise-like\n        typeof value.then === 'function' ||\n            // errors\n            value instanceof Error ||\n            // weakmaps\n            (realm.WeakMap && value instanceof realm.WeakMap) ||\n            // weaksets\n            (realm.WeakSet && value instanceof realm.WeakSet)) {\n            return value;\n        }\n        // assume anything left is a custom constructor\n        return getObjectClone(value, realm, handleCopy, cache);\n    };\n    return handleCopy(value, createCache());\n}\n// Adding reference to allow usage in CommonJS libraries compiled using TSC, which\n// expects there to be a default property on the exported value. See\n// [#37](https://github.com/planttheidea/fast-copy/issues/37) for details.\ncopy.default = copy;\n/**\n * @function strictCopy\n *\n * @description\n * copy the value with `strict` option pre-applied\n *\n * @param value the value to copy\n * @param [options] the options for copying with\n * @param [options.realm] the realm (this) value the value is copied from\n * @returns the copied value\n */\ncopy.strict = function strictCopy(value, options) {\n    return copy(value, {\n        isStrict: true,\n        realm: options ? options.realm : void 0,\n    });\n};\n\nexport { copy as default };\n//# sourceMappingURL=fast-copy.esm.js.map\n","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","import type { Params, Paginated, QueryInfo, DiffDefinition } from './types'\nimport type { MaybeRef } from './utility-types'\nimport type { AnyData, AnyDataOrArray, BaseModelAssociations, FindClassParams } from './service-store/types'\nimport { _ } from '@feathersjs/commons'\nimport stringify from 'fast-json-stable-stringify'\nimport ObjectID from 'isomorphic-mongo-objectid'\nimport fastCopy from 'fast-copy'\nimport { computed, Ref, unref } from 'vue-demi'\nimport isEqual from 'fast-deep-equal'\n\nfunction stringifyIfObject(val: any): string | any {\n  if (typeof val === 'object' && val != null) {\n    return val.toString()\n  }\n  return val\n}\n\n/**\n * Get the id from a record in this order:\n *   1. the `idField`\n *   2. id\n *   3. _id\n * @param item\n * @param idField\n */\nexport function getId(item: any, idField: string) {\n  if (!item) return\n  if (idField && item[idField] != undefined) {\n    return stringifyIfObject(item[idField as string])\n  }\n  if (item.id != undefined) {\n    return stringifyIfObject(item.id)\n  }\n  if (item._id != undefined) {\n    return stringifyIfObject(item._id)\n  }\n}\nexport function getTempId(item: any, tempIdField: string) {\n  if (item?.[tempIdField] != undefined) {\n    return stringifyIfObject(item[tempIdField])\n  }\n}\nexport function getAnyId(item: any, tempIdField: string, idField: string) {\n  return getId(item, idField) != undefined ? getId(item, idField) : getTempId(item, tempIdField)\n}\n\nexport function getQueryInfo(params: Params = {}, response: Partial<Paginated<any>> = {}): QueryInfo {\n  const { query = {}, qid = 'default' } = params\n  const $limit = response.limit != undefined ? response.limit : query?.$limit\n  const $skip = response.skip != undefined ? response.skip : query?.$skip\n\n  const pageParams = $limit !== undefined ? { $limit, $skip } : undefined\n  const pageId = pageParams ? stringify(pageParams) : undefined\n\n  const queryParams = _.omit(query, '$limit', '$skip')\n  const queryId = stringify(queryParams)\n\n  return {\n    qid,\n    query,\n    queryId,\n    queryParams,\n    pageParams,\n    pageId,\n    response,\n    isOutdated: undefined as boolean | undefined,\n  }\n}\n\nexport function getItemsFromQueryInfo(pagination: any, queryInfo: any, keyedById: any): any[] {\n  const { queryId, pageId } = queryInfo\n  const queryLevel = pagination[queryId]\n  const pageLevel = queryLevel && queryLevel[pageId]\n  const ids = pageLevel && pageLevel.ids\n\n  if (ids && ids.length) {\n    return Object.values(_.pick(keyedById, ...ids))\n  } else {\n    return []\n  }\n}\n\n/**\n * Generate a new tempId and mark the record as a temp\n * @param state\n * @param item\n */\nexport function assignTempId(item: any, tempIdField: string) {\n  const newId = new ObjectID().toString()\n  item[tempIdField] = newId\n  return item\n}\n\n/**\n * Cleans data to prepare it for the server.\n * @param data item or array of items\n * @returns items without private attributes like __isClone and __tempId\n */\nexport function cleanData<T = AnyDataOrArray>(data: T, tempIdField: string): T {\n  const { items, isArray } = getArray(data)\n  const cleaned = items.map((item) => _.omit(item, tempIdField))\n\n  return isArray ? cleaned : cleaned[0]\n}\n\n/**\n * Restores tempIds to the records returned from the server. The tempIds need to be\n * temporarily put back in place in order to migrate the objects from the tempsById\n * into the itemsById. A shallow copy of the object\n *\n * Note when data is an array, it doesn't matter if the server\n * returns the items in the same order. It's only important that all of the correct\n * records are moved from tempsById to itemsById\n *\n * @param data item(s) before being passed to the server\n * @param responseData items(s) returned from the server\n */\nexport function restoreTempIds(data: AnyDataOrArray, resData: AnyDataOrArray, tempIdField: string) {\n  const { items: sourceItems, isArray } = getArray(data)\n  const { items: responseItems } = getArray(resData)\n\n  responseItems.forEach((item: any, index: number) => {\n    const tempId = sourceItems[index][tempIdField]\n    if (tempId) {\n      item[tempIdField] = tempId\n    }\n  })\n\n  return isArray ? responseItems : responseItems[0]\n}\n\n/**\n * Uses fast-copy on any data provided get an independent and reference-free copy.\n * This makes it easy to work with client-side databases like feathers-memory. It makes\n * it impossible to accidentally modify stored data due to js object in-memory references.\n * @param data item or array of items\n */\nexport function useCleanData(data: any) {\n  const { items, isArray } = getArray(data)\n  const cleaned = items.map((item: any) => fastCopy(item))\n\n  return isArray ? cleaned : cleaned[0]\n}\n\n/**\n *\n * @param data item or array of items\n * @returns object with { items[], isArray } where isArray is a boolean of if the data was an array.\n */\nexport function getArray<T>(data: T | T[]) {\n  const isArray = Array.isArray(data)\n  return { items: isArray ? data : [data], isArray }\n}\n\nexport const hasOwn = (obj: AnyData, prop: string) => Object.prototype.hasOwnProperty.call(obj, prop)\n\nexport function getSaveParams(params?: MaybeRef<Params>): Params {\n  if (!params) {\n    return {}\n  }\n  return fastCopy(unref(params))\n}\nexport function markAsClone<T>(item: T) {\n  Object.defineProperty(item, '__isClone', {\n    value: true,\n    enumerable: false,\n  })\n  return item\n}\n\n/**\n * Copies the property definitions for the model associations from src to dest.\n *\n * @param src source instance\n * @param dest destination instance\n * @param associations {BaseModelAssociations} from Model.associations\n */\nexport function copyAssociations<M>(src: M, dest: M, associations: BaseModelAssociations) {\n  Object.keys(associations).forEach((key: string) => {\n    const desc = Object.getOwnPropertyDescriptor(src, key)\n    Object.defineProperty(dest, key, desc as PropertyDescriptor)\n  })\n}\n\nexport function pickDiff(obj: any, diffDef: DiffDefinition) {\n  // If no diff definition was given, return the entire object.\n  if (!diffDef) return obj\n\n  // Normalize all types into an array and pick the keys\n  const keys = typeof diffDef === 'string' ? [diffDef] : Array.isArray(diffDef) ? diffDef : Object.keys(diffDef || obj)\n  const topLevelKeys = keys.map((key) => key.toString().split('.')[0])\n  return _.pick(obj, ...topLevelKeys)\n}\n\nexport function diff(original: AnyData, clone: AnyData, diffDef: DiffDefinition) {\n  const originalVal = pickDiff(original, diffDef)\n  const cloneVal = pickDiff(clone, diffDef)\n\n  // If diff was an object, merge the values into the cloneVal\n  if (typeof diffDef !== 'string' && !Array.isArray(diffDef)) {\n    Object.assign(cloneVal, diffDef)\n  }\n\n  const areEqual = isEqual(originalVal, cloneVal)\n\n  if (areEqual) return {}\n\n  // Loop through clone, compare original value to clone value, if different add to diff object.\n  const diff = Object.keys(cloneVal).reduce((diff: AnyData, key) => {\n    if (!isEqual(original[key], cloneVal[key])) {\n      diff[key] = cloneVal[key]\n    }\n    return diff\n  }, {})\n\n  return diff\n}\n\nexport const setOnRef = (obj: any, key: string, val: number) => {\n  (obj.value || obj)[key] = val\n}\nexport const computedAttr = (obj: any, key: string) =>\n  computed({\n    set: (val) => setOnRef(obj, key, val),\n    get: () => unref(obj)[key],\n  })\n\n/**\n * A wrapper for findInStore that can return server-paginated data\n */\nexport const makeUseFindItems = (store: any, params: any) => {\n  return computed(() => {\n    const _params: any = unref(params)\n\n    if (_params) {\n      if (_params.paginate || _params.onServer) {\n        const { defaultSkip, defaultLimit } = store.pagination\n        const skip = _params.query.$skip || defaultSkip\n        const limit = _params.query.$limit || defaultLimit\n        const pagination = store.pagination[_params.qid || 'default'] || {}\n        const response = skip != null && limit != null ? { limit, skip } : {}\n        const queryInfo = getQueryInfo(_params, response)\n        const items = getItemsFromQueryInfo(pagination, queryInfo, store.itemsById)\n        return items\n      } else {\n        return store.findInStore(_params).data\n      }\n    } else {\n      return []\n    }\n  })\n}\n\nexport function makeParamsWithoutPage(params: MaybeRef<FindClassParams>) {\n  params = unref(params)\n  const query = _.omit(params.query, '$limit', '$skip')\n  const newParams = _.omit(params, 'query', 'store')\n  return { ...newParams, query }\n}\n\n// Updates the _params with everything from _newParams except `$limit` and `$skip`\nexport function updateParamsExcludePage(_params: Ref<FindClassParams>, _newParams: MaybeRef<FindClassParams>) {\n  _newParams = unref(_newParams)\n  const query = _.omit(_newParams.query, '$limit', '$skip')\n  const newParams = _.omit(_params.value, 'store', 'query')\n  Object.assign(_params.value.query, query)\n  Object.assign(_params.value, newParams)\n}\n","import { BaseModel } from './service-store'\nimport { ModelStatic } from './service-store/types'\n\nexport const models: Record<string, any> = {}\n\nexport function registerModel(Model: ModelStatic<BaseModel>, store: { clientAlias: string }) {\n  models[store.clientAlias] = models[store.clientAlias] || {}\n  models[store.clientAlias][Model.modelName] = Model\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","import { getId, getTempId, getAnyId, diff, pickDiff } from '../utils'\nimport fastCopy from 'fast-copy'\nimport {\n  AnyData,\n  AnyDataOrArray,\n  ModelInstanceOptions,\n  ModelStatic,\n  ServiceStoreDefault,\n  BaseModelModifierOptions,\n  BaseModelAssociations,\n  CloneOptions,\n} from './types'\nimport { Id, NullableId, Params } from '@feathersjs/feathers'\nimport { models } from '../models'\nimport { EventEmitter } from 'events'\n\nexport class BaseModel implements AnyData {\n  static readonly store: ServiceStoreDefault<BaseModel>\n  static readonly models = models\n  static pinia = null\n  static servicePath = ''\n  static idField = ''\n  static modelName = ''\n  static tempIdField = ''\n  static associations: BaseModelAssociations = {}\n\n  public __isClone!: boolean\n\n  constructor(data: Record<string, any> = {}, options: ModelInstanceOptions = {}) {\n    const { store, instanceDefaults } = this.Model\n    Object.assign(this, instanceDefaults.call(this.Model, data, { models, store }))\n\n    Object.defineProperty(this, '__isClone', {\n      enumerable: false,\n      value: !!options.clone,\n    })\n    return this\n  }\n\n  public static instanceDefaults<M extends BaseModel>(\n    this: ModelStatic<M>,\n    data: AnyData,\n    options?: BaseModelModifierOptions,\n  ): AnyData\n  static instanceDefaults<M extends BaseModel>(this: ModelStatic<M>, data: AnyData): AnyData {\n    return data\n  }\n\n  //#region EventEmitter\n\n  static emitter = new EventEmitter()\n\n  public static addEventListener<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.addListener(eventName, listener)\n    return this\n  }\n\n  public static emit<M extends BaseModel>(this: ModelStatic<M>, eventName: string | symbol, ...args: any[]) {\n    return this.emitter.emit(eventName, ...args)\n  }\n\n  public static eventNames<M extends BaseModel>(this: ModelStatic<M>) {\n    return this.emitter.eventNames()\n  }\n\n  public static getMaxListeners<M extends BaseModel>(this: ModelStatic<M>) {\n    return this.emitter.getMaxListeners()\n  }\n\n  public static listenerCount<M extends BaseModel>(this: ModelStatic<M>, eventName: string | symbol) {\n    return this.emitter.listenerCount(eventName)\n  }\n\n  public static listeners<M extends BaseModel>(this: ModelStatic<M>, eventName: string | symbol) {\n    return this.emitter.listeners(eventName)\n  }\n\n  public static off<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.off(eventName, listener)\n    return this\n  }\n\n  public static on<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.on(eventName, listener)\n    return this\n  }\n\n  public static once<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.once(eventName, listener)\n    return this\n  }\n\n  public static prependListener<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.prependListener(eventName, listener)\n    return this\n  }\n\n  public static prependOnceListener<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.prependOnceListener(eventName, listener)\n    return this\n  }\n\n  public static rawListeners<M extends BaseModel>(this: ModelStatic<M>, eventName: string | symbol) {\n    return this.emitter.rawListeners(eventName)\n  }\n\n  public static removeAllListeners<M extends BaseModel>(this: ModelStatic<M>, eventName?: string | symbol) {\n    this.emitter.removeAllListeners(eventName)\n    return this\n  }\n\n  public static removeListener<M extends BaseModel>(\n    this: ModelStatic<M>,\n    eventName: string | symbol,\n    listener: (...args: any[]) => void,\n  ) {\n    this.emitter.removeListener(eventName, listener)\n    return this\n  }\n\n  public static setMaxListeners<M extends BaseModel>(this: ModelStatic<M>, n: number) {\n    this.emitter.setMaxListeners(n)\n    return this\n  }\n\n  //#endregion\n\n  public static find<M extends BaseModel>(this: ModelStatic<M>, params?: Params) {\n    return this.store.find(params)\n  }\n  public static findInStore<M extends BaseModel>(this: ModelStatic<M>, params: Params) {\n    return this.store.findInStore(params)\n  }\n  public static get<M extends BaseModel>(this: ModelStatic<M>, id: Id, params?: Params) {\n    return this.store.get(id, params)\n  }\n  public static getFromStore<M extends BaseModel>(this: ModelStatic<M>, id: Id | null, params?: Params) {\n    return this.store.getFromStore(id, params)\n  }\n  public static count<M extends BaseModel>(this: ModelStatic<M>, params?: Params) {\n    return this.store.count(params)\n  }\n  public static countInStore<M extends BaseModel>(this: ModelStatic<M>, params: Params) {\n    return this.store.countInStore(params)\n  }\n  public static addToStore<M extends BaseModel>(this: ModelStatic<M>, data: AnyDataOrArray) {\n    return this.store.addToStore(data)\n  }\n  public static update<M extends BaseModel>(this: ModelStatic<M>, id: Id, data: AnyData, params?: Params) {\n    return this.store.update(id, data, params)\n  }\n  public static patch<M extends BaseModel>(this: ModelStatic<M>, id: NullableId, data: AnyData, params?: Params) {\n    return this.store.patch(id, data, params)\n  }\n  public static remove<M extends BaseModel>(this: ModelStatic<M>, id: NullableId, params?: Params) {\n    return this.store.remove(id, params)\n  }\n  public static removeFromStore<M extends BaseModel>(this: ModelStatic<M>, data: AnyDataOrArray) {\n    return this.store.removeFromStore(data)\n  }\n\n  get Model() {\n    return this.constructor as ModelStatic<BaseModel>\n  }\n\n  /**\n   * Call `this.init` in a Class's constructor to run `instanceDefaults` and `setupInstance` properly.\n   * This allows default values to be specified directly in the Class's interface.\n   * @param data\n   */\n  public init(data: Record<string, any>) {\n    const { instanceDefaults, setupInstance } = this.Model as any\n\n    // If you call these here, you can use default values in the Model interface.\n    if (instanceDefaults) Object.assign(this, instanceDefaults.call(this.Model, data), data)\n    if (setupInstance) setupInstance.call(this.Model, this)\n  }\n\n  public getId() {\n    return getId(this, this.Model.idField)\n  }\n  public getTempId() {\n    const { tempIdField } = this.Model\n    return getTempId(this, tempIdField)\n  }\n  public getAnyId() {\n    const { tempIdField, idField } = this.Model\n    return getAnyId(this, tempIdField, idField)\n  }\n\n  get __isTemp() {\n    const { idField } = this.Model\n    return getId(this, idField) == null\n  }\n\n  get isSavePending() {\n    const { store, idField } = this.Model\n    const pending = store.pendingById[getId(this, idField)]\n    return pending?.create || pending?.update || pending?.patch || false\n  }\n  get isCreatePending(): boolean {\n    const { store, idField } = this.Model\n    return store.pendingById[getId(this, idField)]?.create || false\n  }\n  get isPatchPending(): boolean {\n    const { store, idField } = this.Model\n    return store.pendingById[getId(this, idField)]?.patch || false\n  }\n  get isUpdatePending(): boolean {\n    const { store, idField } = this.Model\n    return store.pendingById[getId(this, idField)]?.update || false\n  }\n  get isRemovePending(): boolean {\n    const { store, idField } = this.Model\n    return store.pendingById[getId(this, idField)]?.remove || false\n  }\n\n  get isPending(): boolean {\n    const { store, idField } = this.Model\n    const pending = store.pendingById[getId(this, idField)]\n    return pending?.create || pending?.update || pending?.patch || pending?.remove || false\n  }\n\n  /**\n   * Add the current record to the store\n   */\n  public addToStore() {\n    const { store } = this.Model\n    return store.addToStore(this)\n  }\n\n  /**\n   * clone the current record using the `clone` action\n   */\n  public clone(data?: AnyData, options: CloneOptions = {}): this {\n    const { store } = this.Model\n\n    // @ts-expect-error todo\n    return store.clone(this, data, options)\n  }\n\n  /**\n   * Update a store instance to match a clone.\n   */\n  public commit(data?: any): this {\n    const { store } = this.Model\n    if (this.__isClone) {\n      // @ts-expect-error todo\n      return store.commit(this, data)\n    } else {\n      throw new Error('You cannot call commit on a non-copy')\n    }\n  }\n\n  /**\n   * Update a clone to match a store instance.\n   */\n  public reset(data: AnyData = {}): this {\n    const { store } = this.Model\n\n    return store.reset(this, data) as this\n  }\n\n  /**\n   * A shortcut to either call create or patch/update\n   * @param params\n   */\n  public save(params?: any): Promise<this> {\n    const { idField } = this.Model\n    const id = getId(this, idField)\n    return id != null ? this.patch(params) : this.create(params)\n  }\n\n  /**\n   * Calls service create with the current instance data\n   * @param params\n   */\n  public async create(params?: any): Promise<this> {\n    const { idField, store } = this.Model\n    const data: any = Object.assign({}, this)\n    if (data[idField] === null) {\n      delete data[idField]\n    }\n    const { __isClone } = this\n    const saved = (await store.create(data, params)) as this\n\n    // For non-reactive instances, update the instance with created data.\n    Object.assign(this, saved)\n\n    return __isClone ? saved.clone() : saved\n  }\n\n  /**\n   * Calls service patch with the current instance data\n   * @param params\n   */\n  public async patch<M extends BaseModel>(this: M, params: any = {}): Promise<this> {\n    const { idField, store } = this.Model\n    const id = getId(this, idField)\n\n    if (id == null) {\n      const error = new Error(\n        `Missing ${idField} property. You must create the data before you can patch with this data`,\n      )\n      return Promise.reject(error)\n    }\n    const { __isClone } = this\n    let saved: any\n\n    // Diff clones\n    if (__isClone && params.diff != false) {\n      const original = this.Model.getFromStore(id) as any\n      const data = diff(original, this, params.diff)\n      const rollbackData = fastCopy(original)\n\n      // Do eager updating.\n      if (params.commit !== false) this.commit(data)\n\n      // Always include matching values from `params.with`.\n      if (params.with) {\n        const dataFromWith = pickDiff(this, params.with)\n        // If params.with was an object, merge the values into dataFromWith\n        if (typeof params.with !== 'string' && !Array.isArray(params.with)) {\n          Object.assign(dataFromWith, params.with)\n        }\n        Object.assign(data, dataFromWith)\n      }\n\n      // If diff is empty, return the clone without making a request.\n      if (Object.keys(data).length === 0) return this as any\n\n      try {\n        saved = (await store.patch(id, data, params)) as this\n      } catch (error: any) {\n        // If saving fails, reverse the eager update\n        this.commit(rollbackData)\n      }\n    } else {\n      saved = (await store.patch(id, this, params)) as this\n    }\n    // Make sure a clone is returned if a clone was saved.\n    return __isClone ? saved.clone() : saved\n  }\n\n  /**\n   * Calls service update with the current instance data\n   * @param params\n   */\n  public async update(params?: any): Promise<this> {\n    const { idField, store } = this.Model\n    const id = getId(this, idField)\n\n    if (id == null) {\n      const error = new Error(\n        `Missing ${idField} property. You must create the data before you can patch with this data`,\n      )\n      return Promise.reject(error)\n    }\n    const { __isClone } = this\n    const saved = (await store.update(id, this, params)) as this\n    return __isClone ? saved.clone() : saved\n  }\n\n  /**\n   * Calls service remove with the current instance id\n   * @param params\n   */\n  public remove(params?: Params): Promise<this> {\n    checkThis(this)\n    const { idField, store } = this.Model\n    const id: Id = getId(this, idField)\n    return store.remove(id, params)\n  }\n  /**\n   * Removes the instance from the store\n   */\n  public removeFromStore(): this {\n    const { store } = this.Model\n    return store.removeFromStore(this)\n  }\n}\n\nfunction checkThis(context: any) {\n  if (!context) {\n    throw new Error(\n      `Instance methods must be called with the dot operator. If you are referencing one in an event, use '@click=\"() => instance.remove()\"' so that the correct 'this' context is applied. Using '@click=\"instance.remove\"' will call the remove function with \"this\" set to 'undefined' because the function is called directly instead of as a method.`,\n    )\n  }\n}\n","export const clients: { [name: string]: any } = {}\n\nexport function registerClient(name: string, client: any) {\n  if (!clients[name]) {\n    clients[name] = client\n  }\n}\n","module.exports = debounce;\n\nfunction debounce(fn, delay, atStart, guarantee) {\n  var timeout;\n  var args;\n  var self;\n\n  return function debounced() {\n    self = this;\n    args = Array.prototype.slice.call(arguments);\n\n    if (timeout && (atStart || guarantee)) {\n      return;\n    } else if (!atStart) {\n      clear();\n\n      timeout = setTimeout(run, delay);\n      return timeout;\n    }\n\n    timeout = setTimeout(clear, delay);\n    fn.apply(self, args);\n\n    function run() {\n      clear();\n      fn.apply(self, args);\n    }\n\n    function clear() {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n}\n","import { getId, hasOwn } from '../utils'\nimport _debounce from 'just-debounce'\nimport { models } from '../models'\nimport { HandledEvents } from '../types'\nimport { DefineFeathersStoreOptions, ServiceStore, ModelStatic } from './types'\nimport { BaseModel } from '.'\nimport { StateTree, _GettersTree } from 'pinia'\n\nexport interface ServiceEventsDebouncedQueue {\n  addOrUpdateById: any\n  removeItemById: any\n  enqueueAddOrUpdate(item: any): void\n  enqueueRemoval(item: any): void\n  flushAddOrUpdateQueue(): void\n  flushRemoveItemQueue(): void\n}\n\ninterface EnableServiceEventsOptions<\n  Id extends string = string,\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n> {\n  service: any\n  Model: ModelStatic<M>\n  store: ServiceStore<Id, M, S, G, A>\n  options: EnableServiceEventsOptionsOptions<Id, M, S, G, A>\n}\n\ntype EnableServiceEventsOptionsOptions<\n  Id extends string = string,\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n> = Required<\n  Pick<\n    DefineFeathersStoreOptions<Id, M, S, G, A>,\n    'idField' | 'handleEvents' | 'debounceEventsGuarantee' | 'debounceEventsTime'\n  >\n>\n\nexport function enableServiceEvents<\n  Id extends string = string,\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n>({ service, Model, store, options }: EnableServiceEventsOptions<Id, M, S, G, A>): ServiceEventsDebouncedQueue {\n  const debouncedQueue: ServiceEventsDebouncedQueue = {\n    addOrUpdateById: {},\n    removeItemById: {},\n    enqueueAddOrUpdate(item): void {\n      const id = getId(item, options.idField)\n      this.addOrUpdateById[id] = item\n      if (hasOwn(this.removeItemById, id)) {\n        delete this.removeItemById[id]\n      }\n      this.flushAddOrUpdateQueue()\n    },\n    enqueueRemoval(item): void {\n      const id = getId(item, options.idField)\n      this.removeItemById[id] = item\n      if (hasOwn(this.addOrUpdateById, id)) {\n        delete this.addOrUpdateById[id]\n      }\n      this.flushRemoveItemQueue()\n    },\n    flushAddOrUpdateQueue: _debounce(\n      async function () {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error todo\n        const values = Object.values(this.addOrUpdateById)\n        if (values.length === 0) return\n        await store.addOrUpdate(values)\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error todo\n        this.addOrUpdateById = {}\n      },\n      options.debounceEventsTime || 20,\n      undefined,\n      options.debounceEventsGuarantee,\n    ),\n    flushRemoveItemQueue: _debounce(\n      function () {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error todo\n        const values = Object.values(this.removeItemById)\n        if (values.length === 0) return\n        store.removeFromStore(values)\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-expect-error todo\n        this.removeItemById = {}\n      },\n      options.debounceEventsTime || 20,\n      undefined,\n      options.debounceEventsGuarantee,\n    ),\n  }\n\n  const handleEvent = (eventName: HandledEvents, item: any): void => {\n    const handler = options.handleEvents[eventName]\n    const confirmOrArray = handler(item, { model: Model, models })\n    const [affectsStore, modified = item] = Array.isArray(confirmOrArray) ? confirmOrArray : [confirmOrArray]\n    if (affectsStore) {\n      if (!options.debounceEventsTime) {\n        eventName === 'removed' ? store.removeFromStore(modified) : store.addOrUpdate(modified)\n      } else {\n        eventName === 'removed' ? debouncedQueue.enqueueRemoval(item) : debouncedQueue.enqueueAddOrUpdate(item)\n      }\n    }\n  }\n\n  // Listen to socket events when available.\n  service.on('created', (item: any) => {\n    handleEvent('created', item)\n    Model.emit && Model.emit('created', item)\n  })\n  service.on('updated', (item: any) => {\n    handleEvent('updated', item)\n    Model.emit && Model.emit('updated', item)\n  })\n  service.on('patched', (item: any) => {\n    handleEvent('patched', item)\n    Model.emit && Model.emit('patched', item)\n  })\n  service.on('removed', (item: any) => {\n    handleEvent('removed', item)\n    Model.emit && Model.emit('removed', item)\n  })\n\n  return debouncedQueue\n}\n","import { MakeStateOptions, ServiceStoreDefaultState } from './types'\nimport { StateTree } from 'pinia'\nimport { BaseModel } from './base-model'\n\nexport function makeState<M extends BaseModel = BaseModel, S extends StateTree = {}>(\n  options: MakeStateOptions<M, S>,\n): () => ServiceStoreDefaultState & S {\n  const defaultState: ServiceStoreDefaultState<M> = {\n    clientAlias: options.clientAlias,\n    servicePath: options.servicePath,\n    idField: options.idField,\n    tempIdField: options.tempIdField,\n    itemsById: {},\n    tempsById: {},\n    clonesById: {},\n    pendingById: {\n      Model: {\n        find: false,\n        count: false,\n        get: false,\n      },\n    },\n    eventLocksById: {\n      created: {},\n      patched: {},\n      updated: {},\n      removed: {},\n    },\n    pagination: {},\n    whitelist: options.whitelist,\n    paramsForServer: options.paramsForServer,\n    skipRequestIfExists: options.skipRequestIfExists,\n  }\n  const state = options.state()\n  return () => Object.assign(defaultState, state)\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\n\nvar typeChecker = function (type) {\n    var typeString = \"[object \" + type + \"]\";\n    return function (value) {\n        return getClassName(value) === typeString;\n    };\n};\nvar getClassName = function (value) { return Object.prototype.toString.call(value); };\nvar comparable = function (value) {\n    if (value instanceof Date) {\n        return value.getTime();\n    }\n    else if (isArray(value)) {\n        return value.map(comparable);\n    }\n    else if (value && typeof value.toJSON === \"function\") {\n        return value.toJSON();\n    }\n    return value;\n};\nvar isArray = typeChecker(\"Array\");\nvar isObject = typeChecker(\"Object\");\nvar isFunction = typeChecker(\"Function\");\nvar isVanillaObject = function (value) {\n    return (value &&\n        (value.constructor === Object ||\n            value.constructor === Array ||\n            value.constructor.toString() === \"function Object() { [native code] }\" ||\n            value.constructor.toString() === \"function Array() { [native code] }\") &&\n        !value.toJSON);\n};\nvar equals = function (a, b) {\n    if (a == null && a == b) {\n        return true;\n    }\n    if (a === b) {\n        return true;\n    }\n    if (Object.prototype.toString.call(a) !== Object.prototype.toString.call(b)) {\n        return false;\n    }\n    if (isArray(a)) {\n        if (a.length !== b.length) {\n            return false;\n        }\n        for (var i = 0, length_1 = a.length; i < length_1; i++) {\n            if (!equals(a[i], b[i]))\n                return false;\n        }\n        return true;\n    }\n    else if (isObject(a)) {\n        if (Object.keys(a).length !== Object.keys(b).length) {\n            return false;\n        }\n        for (var key in a) {\n            if (!equals(a[key], b[key]))\n                return false;\n        }\n        return true;\n    }\n    return false;\n};\n\n/**\n * Walks through each value given the context - used for nested operations. E.g:\n * { \"person.address\": { $eq: \"blarg\" }}\n */\nvar walkKeyPathValues = function (item, keyPath, next, depth, key, owner) {\n    var currentKey = keyPath[depth];\n    // if array, then try matching. Might fall through for cases like:\n    // { $eq: [1, 2, 3] }, [ 1, 2, 3 ].\n    if (isArray(item) && isNaN(Number(currentKey))) {\n        for (var i = 0, length_1 = item.length; i < length_1; i++) {\n            // if FALSE is returned, then terminate walker. For operations, this simply\n            // means that the search critera was met.\n            if (!walkKeyPathValues(item[i], keyPath, next, depth, i, item)) {\n                return false;\n            }\n        }\n    }\n    if (depth === keyPath.length || item == null) {\n        return next(item, key, owner, depth === 0);\n    }\n    return walkKeyPathValues(item[currentKey], keyPath, next, depth + 1, currentKey, item);\n};\nvar BaseOperation = /** @class */ (function () {\n    function BaseOperation(params, owneryQuery, options, name) {\n        this.params = params;\n        this.owneryQuery = owneryQuery;\n        this.options = options;\n        this.name = name;\n        this.init();\n    }\n    BaseOperation.prototype.init = function () { };\n    BaseOperation.prototype.reset = function () {\n        this.done = false;\n        this.keep = false;\n    };\n    return BaseOperation;\n}());\nvar GroupOperation = /** @class */ (function (_super) {\n    __extends(GroupOperation, _super);\n    function GroupOperation(params, owneryQuery, options, children) {\n        var _this = _super.call(this, params, owneryQuery, options) || this;\n        _this.children = children;\n        return _this;\n    }\n    /**\n     */\n    GroupOperation.prototype.reset = function () {\n        this.keep = false;\n        this.done = false;\n        for (var i = 0, length_2 = this.children.length; i < length_2; i++) {\n            this.children[i].reset();\n        }\n    };\n    /**\n     */\n    GroupOperation.prototype.childrenNext = function (item, key, owner, root) {\n        var done = true;\n        var keep = true;\n        for (var i = 0, length_3 = this.children.length; i < length_3; i++) {\n            var childOperation = this.children[i];\n            if (!childOperation.done) {\n                childOperation.next(item, key, owner, root);\n            }\n            if (!childOperation.keep) {\n                keep = false;\n            }\n            if (childOperation.done) {\n                if (!childOperation.keep) {\n                    break;\n                }\n            }\n            else {\n                done = false;\n            }\n        }\n        this.done = done;\n        this.keep = keep;\n    };\n    return GroupOperation;\n}(BaseOperation));\nvar NamedGroupOperation = /** @class */ (function (_super) {\n    __extends(NamedGroupOperation, _super);\n    function NamedGroupOperation(params, owneryQuery, options, children, name) {\n        var _this = _super.call(this, params, owneryQuery, options, children) || this;\n        _this.name = name;\n        return _this;\n    }\n    return NamedGroupOperation;\n}(GroupOperation));\nvar QueryOperation = /** @class */ (function (_super) {\n    __extends(QueryOperation, _super);\n    function QueryOperation() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    /**\n     */\n    QueryOperation.prototype.next = function (item, key, parent, root) {\n        this.childrenNext(item, key, parent, root);\n    };\n    return QueryOperation;\n}(GroupOperation));\nvar NestedOperation = /** @class */ (function (_super) {\n    __extends(NestedOperation, _super);\n    function NestedOperation(keyPath, params, owneryQuery, options, children) {\n        var _this = _super.call(this, params, owneryQuery, options, children) || this;\n        _this.keyPath = keyPath;\n        _this.propop = true;\n        /**\n         */\n        _this._nextNestedValue = function (value, key, owner, root) {\n            _this.childrenNext(value, key, owner, root);\n            return !_this.done;\n        };\n        return _this;\n    }\n    /**\n     */\n    NestedOperation.prototype.next = function (item, key, parent) {\n        walkKeyPathValues(item, this.keyPath, this._nextNestedValue, 0, key, parent);\n    };\n    return NestedOperation;\n}(GroupOperation));\nvar createTester = function (a, compare) {\n    if (a instanceof Function) {\n        return a;\n    }\n    if (a instanceof RegExp) {\n        return function (b) {\n            var result = typeof b === \"string\" && a.test(b);\n            a.lastIndex = 0;\n            return result;\n        };\n    }\n    var comparableA = comparable(a);\n    return function (b) { return compare(comparableA, comparable(b)); };\n};\nvar EqualsOperation = /** @class */ (function (_super) {\n    __extends(EqualsOperation, _super);\n    function EqualsOperation() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    EqualsOperation.prototype.init = function () {\n        this._test = createTester(this.params, this.options.compare);\n    };\n    EqualsOperation.prototype.next = function (item, key, parent) {\n        if (!Array.isArray(parent) || parent.hasOwnProperty(key)) {\n            if (this._test(item, key, parent)) {\n                this.done = true;\n                this.keep = true;\n            }\n        }\n    };\n    return EqualsOperation;\n}(BaseOperation));\nvar createEqualsOperation = function (params, owneryQuery, options) { return new EqualsOperation(params, owneryQuery, options); };\nvar NopeOperation = /** @class */ (function (_super) {\n    __extends(NopeOperation, _super);\n    function NopeOperation() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    NopeOperation.prototype.next = function () {\n        this.done = true;\n        this.keep = false;\n    };\n    return NopeOperation;\n}(BaseOperation));\nvar numericalOperationCreator = function (createNumericalOperation) { return function (params, owneryQuery, options, name) {\n    if (params == null) {\n        return new NopeOperation(params, owneryQuery, options, name);\n    }\n    return createNumericalOperation(params, owneryQuery, options, name);\n}; };\nvar numericalOperation = function (createTester) {\n    return numericalOperationCreator(function (params, owneryQuery, options, name) {\n        var typeofParams = typeof comparable(params);\n        var test = createTester(params);\n        return new EqualsOperation(function (b) {\n            return typeof comparable(b) === typeofParams && test(b);\n        }, owneryQuery, options, name);\n    });\n};\nvar createNamedOperation = function (name, params, parentQuery, options) {\n    var operationCreator = options.operations[name];\n    if (!operationCreator) {\n        throwUnsupportedOperation(name);\n    }\n    return operationCreator(params, parentQuery, options, name);\n};\nvar throwUnsupportedOperation = function (name) {\n    throw new Error(\"Unsupported operation: \" + name);\n};\nvar containsOperation = function (query, options) {\n    for (var key in query) {\n        if (options.operations.hasOwnProperty(key) || key.charAt(0) === \"$\")\n            return true;\n    }\n    return false;\n};\nvar createNestedOperation = function (keyPath, nestedQuery, parentKey, owneryQuery, options) {\n    if (containsOperation(nestedQuery, options)) {\n        var _a = createQueryOperations(nestedQuery, parentKey, options), selfOperations = _a[0], nestedOperations = _a[1];\n        if (nestedOperations.length) {\n            throw new Error(\"Property queries must contain only operations, or exact objects.\");\n        }\n        return new NestedOperation(keyPath, nestedQuery, owneryQuery, options, selfOperations);\n    }\n    return new NestedOperation(keyPath, nestedQuery, owneryQuery, options, [\n        new EqualsOperation(nestedQuery, owneryQuery, options)\n    ]);\n};\nvar createQueryOperation = function (query, owneryQuery, _a) {\n    if (owneryQuery === void 0) { owneryQuery = null; }\n    var _b = _a === void 0 ? {} : _a, compare = _b.compare, operations = _b.operations;\n    var options = {\n        compare: compare || equals,\n        operations: Object.assign({}, operations || {})\n    };\n    var _c = createQueryOperations(query, null, options), selfOperations = _c[0], nestedOperations = _c[1];\n    var ops = [];\n    if (selfOperations.length) {\n        ops.push(new NestedOperation([], query, owneryQuery, options, selfOperations));\n    }\n    ops.push.apply(ops, nestedOperations);\n    if (ops.length === 1) {\n        return ops[0];\n    }\n    return new QueryOperation(query, owneryQuery, options, ops);\n};\nvar createQueryOperations = function (query, parentKey, options) {\n    var selfOperations = [];\n    var nestedOperations = [];\n    if (!isVanillaObject(query)) {\n        selfOperations.push(new EqualsOperation(query, query, options));\n        return [selfOperations, nestedOperations];\n    }\n    for (var key in query) {\n        if (options.operations.hasOwnProperty(key)) {\n            var op = createNamedOperation(key, query[key], query, options);\n            if (op) {\n                if (!op.propop && parentKey && !options.operations[parentKey]) {\n                    throw new Error(\"Malformed query. \" + key + \" cannot be matched against property.\");\n                }\n            }\n            // probably just a flag for another operation (like $options)\n            if (op != null) {\n                selfOperations.push(op);\n            }\n        }\n        else if (key.charAt(0) === \"$\") {\n            throwUnsupportedOperation(key);\n        }\n        else {\n            nestedOperations.push(createNestedOperation(key.split(\".\"), query[key], key, query, options));\n        }\n    }\n    return [selfOperations, nestedOperations];\n};\nvar createOperationTester = function (operation) { return function (item, key, owner) {\n    operation.reset();\n    operation.next(item, key, owner);\n    return operation.keep;\n}; };\nvar createQueryTester = function (query, options) {\n    if (options === void 0) { options = {}; }\n    return createOperationTester(createQueryOperation(query, null, options));\n};\n\nvar $Ne = /** @class */ (function (_super) {\n    __extends($Ne, _super);\n    function $Ne() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $Ne.prototype.init = function () {\n        this._test = createTester(this.params, this.options.compare);\n    };\n    $Ne.prototype.reset = function () {\n        _super.prototype.reset.call(this);\n        this.keep = true;\n    };\n    $Ne.prototype.next = function (item) {\n        if (this._test(item)) {\n            this.done = true;\n            this.keep = false;\n        }\n    };\n    return $Ne;\n}(BaseOperation));\n// https://docs.mongodb.com/manual/reference/operator/query/elemMatch/\nvar $ElemMatch = /** @class */ (function (_super) {\n    __extends($ElemMatch, _super);\n    function $ElemMatch() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $ElemMatch.prototype.init = function () {\n        if (!this.params || typeof this.params !== \"object\") {\n            throw new Error(\"Malformed query. $elemMatch must by an object.\");\n        }\n        this._queryOperation = createQueryOperation(this.params, this.owneryQuery, this.options);\n    };\n    $ElemMatch.prototype.reset = function () {\n        _super.prototype.reset.call(this);\n        this._queryOperation.reset();\n    };\n    $ElemMatch.prototype.next = function (item) {\n        if (isArray(item)) {\n            for (var i = 0, length_1 = item.length; i < length_1; i++) {\n                // reset query operation since item being tested needs to pass _all_ query\n                // operations for it to be a success\n                this._queryOperation.reset();\n                var child = item[i];\n                this._queryOperation.next(child, i, item, false);\n                this.keep = this.keep || this._queryOperation.keep;\n            }\n            this.done = true;\n        }\n        else {\n            this.done = false;\n            this.keep = false;\n        }\n    };\n    return $ElemMatch;\n}(BaseOperation));\nvar $Not = /** @class */ (function (_super) {\n    __extends($Not, _super);\n    function $Not() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $Not.prototype.init = function () {\n        this._queryOperation = createQueryOperation(this.params, this.owneryQuery, this.options);\n    };\n    $Not.prototype.reset = function () {\n        _super.prototype.reset.call(this);\n        this._queryOperation.reset();\n    };\n    $Not.prototype.next = function (item, key, owner, root) {\n        this._queryOperation.next(item, key, owner, root);\n        this.done = this._queryOperation.done;\n        this.keep = !this._queryOperation.keep;\n    };\n    return $Not;\n}(BaseOperation));\nvar $Size = /** @class */ (function (_super) {\n    __extends($Size, _super);\n    function $Size() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $Size.prototype.init = function () { };\n    $Size.prototype.next = function (item) {\n        if (isArray(item) && item.length === this.params) {\n            this.done = true;\n            this.keep = true;\n        }\n        // if (parent && parent.length === this.params) {\n        //   this.done = true;\n        //   this.keep = true;\n        // }\n    };\n    return $Size;\n}(BaseOperation));\nvar assertGroupNotEmpty = function (values) {\n    if (values.length === 0) {\n        throw new Error(\"$and/$or/$nor must be a nonempty array\");\n    }\n};\nvar $Or = /** @class */ (function (_super) {\n    __extends($Or, _super);\n    function $Or() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = false;\n        return _this;\n    }\n    $Or.prototype.init = function () {\n        var _this = this;\n        assertGroupNotEmpty(this.params);\n        this._ops = this.params.map(function (op) {\n            return createQueryOperation(op, null, _this.options);\n        });\n    };\n    $Or.prototype.reset = function () {\n        this.done = false;\n        this.keep = false;\n        for (var i = 0, length_2 = this._ops.length; i < length_2; i++) {\n            this._ops[i].reset();\n        }\n    };\n    $Or.prototype.next = function (item, key, owner) {\n        var done = false;\n        var success = false;\n        for (var i = 0, length_3 = this._ops.length; i < length_3; i++) {\n            var op = this._ops[i];\n            op.next(item, key, owner);\n            if (op.keep) {\n                done = true;\n                success = op.keep;\n                break;\n            }\n        }\n        this.keep = success;\n        this.done = done;\n    };\n    return $Or;\n}(BaseOperation));\nvar $Nor = /** @class */ (function (_super) {\n    __extends($Nor, _super);\n    function $Nor() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = false;\n        return _this;\n    }\n    $Nor.prototype.next = function (item, key, owner) {\n        _super.prototype.next.call(this, item, key, owner);\n        this.keep = !this.keep;\n    };\n    return $Nor;\n}($Or));\nvar $In = /** @class */ (function (_super) {\n    __extends($In, _super);\n    function $In() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $In.prototype.init = function () {\n        var _this = this;\n        this._testers = this.params.map(function (value) {\n            if (containsOperation(value, _this.options)) {\n                throw new Error(\"cannot nest $ under \" + _this.name.toLowerCase());\n            }\n            return createTester(value, _this.options.compare);\n        });\n    };\n    $In.prototype.next = function (item, key, owner) {\n        var done = false;\n        var success = false;\n        for (var i = 0, length_4 = this._testers.length; i < length_4; i++) {\n            var test = this._testers[i];\n            if (test(item)) {\n                done = true;\n                success = true;\n                break;\n            }\n        }\n        this.keep = success;\n        this.done = done;\n    };\n    return $In;\n}(BaseOperation));\nvar $Nin = /** @class */ (function (_super) {\n    __extends($Nin, _super);\n    function $Nin(params, ownerQuery, options, name) {\n        var _this = _super.call(this, params, ownerQuery, options, name) || this;\n        _this.propop = true;\n        _this._in = new $In(params, ownerQuery, options, name);\n        return _this;\n    }\n    $Nin.prototype.next = function (item, key, owner, root) {\n        this._in.next(item, key, owner);\n        if (isArray(owner) && !root) {\n            if (this._in.keep) {\n                this.keep = false;\n                this.done = true;\n            }\n            else if (key == owner.length - 1) {\n                this.keep = true;\n                this.done = true;\n            }\n        }\n        else {\n            this.keep = !this._in.keep;\n            this.done = true;\n        }\n    };\n    $Nin.prototype.reset = function () {\n        _super.prototype.reset.call(this);\n        this._in.reset();\n    };\n    return $Nin;\n}(BaseOperation));\nvar $Exists = /** @class */ (function (_super) {\n    __extends($Exists, _super);\n    function $Exists() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $Exists.prototype.next = function (item, key, owner) {\n        if (owner.hasOwnProperty(key) === this.params) {\n            this.done = true;\n            this.keep = true;\n        }\n    };\n    return $Exists;\n}(BaseOperation));\nvar $And = /** @class */ (function (_super) {\n    __extends($And, _super);\n    function $And(params, owneryQuery, options, name) {\n        var _this = _super.call(this, params, owneryQuery, options, params.map(function (query) { return createQueryOperation(query, owneryQuery, options); }), name) || this;\n        _this.propop = false;\n        assertGroupNotEmpty(params);\n        return _this;\n    }\n    $And.prototype.next = function (item, key, owner, root) {\n        this.childrenNext(item, key, owner, root);\n    };\n    return $And;\n}(NamedGroupOperation));\nvar $All = /** @class */ (function (_super) {\n    __extends($All, _super);\n    function $All(params, owneryQuery, options, name) {\n        var _this = _super.call(this, params, owneryQuery, options, params.map(function (query) { return createQueryOperation(query, owneryQuery, options); }), name) || this;\n        _this.propop = true;\n        return _this;\n    }\n    $All.prototype.next = function (item, key, owner, root) {\n        this.childrenNext(item, key, owner, root);\n    };\n    return $All;\n}(NamedGroupOperation));\nvar $eq = function (params, owneryQuery, options) {\n    return new EqualsOperation(params, owneryQuery, options);\n};\nvar $ne = function (params, owneryQuery, options, name) { return new $Ne(params, owneryQuery, options, name); };\nvar $or = function (params, owneryQuery, options, name) { return new $Or(params, owneryQuery, options, name); };\nvar $nor = function (params, owneryQuery, options, name) { return new $Nor(params, owneryQuery, options, name); };\nvar $elemMatch = function (params, owneryQuery, options, name) { return new $ElemMatch(params, owneryQuery, options, name); };\nvar $nin = function (params, owneryQuery, options, name) { return new $Nin(params, owneryQuery, options, name); };\nvar $in = function (params, owneryQuery, options, name) {\n    return new $In(params, owneryQuery, options, name);\n};\nvar $lt = numericalOperation(function (params) { return function (b) { return b < params; }; });\nvar $lte = numericalOperation(function (params) { return function (b) { return b <= params; }; });\nvar $gt = numericalOperation(function (params) { return function (b) { return b > params; }; });\nvar $gte = numericalOperation(function (params) { return function (b) { return b >= params; }; });\nvar $mod = function (_a, owneryQuery, options) {\n    var mod = _a[0], equalsValue = _a[1];\n    return new EqualsOperation(function (b) { return comparable(b) % mod === equalsValue; }, owneryQuery, options);\n};\nvar $exists = function (params, owneryQuery, options, name) { return new $Exists(params, owneryQuery, options, name); };\nvar $regex = function (pattern, owneryQuery, options) {\n    return new EqualsOperation(new RegExp(pattern, owneryQuery.$options), owneryQuery, options);\n};\nvar $not = function (params, owneryQuery, options, name) { return new $Not(params, owneryQuery, options, name); };\nvar typeAliases = {\n    number: function (v) { return typeof v === \"number\"; },\n    string: function (v) { return typeof v === \"string\"; },\n    bool: function (v) { return typeof v === \"boolean\"; },\n    array: function (v) { return Array.isArray(v); },\n    null: function (v) { return v === null; },\n    timestamp: function (v) { return v instanceof Date; }\n};\nvar $type = function (clazz, owneryQuery, options) {\n    return new EqualsOperation(function (b) {\n        if (typeof clazz === \"string\") {\n            if (!typeAliases[clazz]) {\n                throw new Error(\"Type alias does not exist\");\n            }\n            return typeAliases[clazz](b);\n        }\n        return b != null ? b instanceof clazz || b.constructor === clazz : false;\n    }, owneryQuery, options);\n};\nvar $and = function (params, ownerQuery, options, name) { return new $And(params, ownerQuery, options, name); };\nvar $all = function (params, ownerQuery, options, name) { return new $All(params, ownerQuery, options, name); };\nvar $size = function (params, ownerQuery, options) { return new $Size(params, ownerQuery, options, \"$size\"); };\nvar $options = function () { return null; };\nvar $where = function (params, ownerQuery, options) {\n    var test;\n    if (isFunction(params)) {\n        test = params;\n    }\n    else if (!process.env.CSP_ENABLED) {\n        test = new Function(\"obj\", \"return \" + params);\n    }\n    else {\n        throw new Error(\"In CSP mode, sift does not support strings in \\\"$where\\\" condition\");\n    }\n    return new EqualsOperation(function (b) { return test.bind(b)(b); }, ownerQuery, options);\n};\n\nvar defaultOperations = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    $Size: $Size,\n    $eq: $eq,\n    $ne: $ne,\n    $or: $or,\n    $nor: $nor,\n    $elemMatch: $elemMatch,\n    $nin: $nin,\n    $in: $in,\n    $lt: $lt,\n    $lte: $lte,\n    $gt: $gt,\n    $gte: $gte,\n    $mod: $mod,\n    $exists: $exists,\n    $regex: $regex,\n    $not: $not,\n    $type: $type,\n    $and: $and,\n    $all: $all,\n    $size: $size,\n    $options: $options,\n    $where: $where\n});\n\nvar createDefaultQueryOperation = function (query, ownerQuery, _a) {\n    var _b = _a === void 0 ? {} : _a, compare = _b.compare, operations = _b.operations;\n    return createQueryOperation(query, ownerQuery, {\n        compare: compare,\n        operations: Object.assign({}, defaultOperations, operations || {})\n    });\n};\nvar createDefaultQueryTester = function (query, options) {\n    if (options === void 0) { options = {}; }\n    var op = createDefaultQueryOperation(query, null, options);\n    return createOperationTester(op);\n};\n\nexport default createDefaultQueryTester;\nexport { $Size, $all, $and, $elemMatch, $eq, $exists, $gt, $gte, $in, $lt, $lte, $mod, $ne, $nin, $nor, $not, $options, $or, $regex, $size, $type, $where, EqualsOperation, createDefaultQueryOperation, createEqualsOperation, createOperationTester, createQueryOperation, createQueryTester };\n//# sourceMappingURL=index.js.map\n","import { createEqualsOperation } from 'sift'\n\n// Simulate SQL's case-sensitive LIKE.\n// A combination of answers from https://stackoverflow.com/questions/1314045/emulating-sql-like-in-javascript\nexport function like(value: string, search: string, regexOptions = 'g') {\n  const specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\\\']\n  // Remove specials\n  search = search.replace(new RegExp(`(\\\\${specials.join('|\\\\')})`, regexOptions), '\\\\$1')\n  // Replace % and _ with equivalent regex\n  search = search.replace(/%/g, '.*').replace(/_/g, '.')\n  // Check matches\n  return RegExp(`^${search}$`, regexOptions).test(value)\n}\n\n// Simulate PostgreSQL's case-insensitive ILIKE\nexport function iLike(str: string, search: string) {\n  return like(str, search, 'ig')\n}\n\nexport const $like = (params: any, ownerQuery: any, options: any) => {\n  return createEqualsOperation((value: any) => like(value, params), ownerQuery, options)\n}\n\nexport const $notLike = (params: any, ownerQuery: any, options: any) => {\n  return createEqualsOperation((value: any) => !like(value, params), ownerQuery, options)\n}\n\nexport const $ilike = (params: any, ownerQuery: any, options: any) => {\n  return createEqualsOperation((value: any) => iLike(value, params), ownerQuery, options)\n}\n\nconst $notILike = (params: any, ownerQuery: any, options: any) => {\n  return createEqualsOperation((value: any) => !iLike(value, params), ownerQuery, options)\n}\n\nexport const operations = {\n  $like,\n  $notLike,\n  $ilike,\n  $iLike: $ilike,\n  $notILike,\n}\n","import type { MakeServiceGettersOptions, ServiceStoreDefaultGetters, ServiceStoreDefaultState } from './types'\nimport type { Params } from '../types'\nimport type { Id } from '@feathersjs/feathers'\nimport type { StateTree, _GettersTree } from 'pinia'\nimport type { TypedGetters } from '../utility-types'\nimport sift from 'sift'\nimport { operations } from '../utils-custom-operators'\nimport { _ } from '@feathersjs/commons'\nimport { filterQuery, sorter, select } from '@feathersjs/adapter-commons'\nimport { unref } from 'vue-demi'\nimport fastCopy from 'fast-copy'\nimport { BaseModel } from './base-model'\n\nconst FILTERS = ['$sort', '$limit', '$skip', '$select']\nconst additionalOperators = ['$elemMatch']\n\ntype ServiceStoreTypedGetters<M extends BaseModel = BaseModel> = TypedGetters<\n  ServiceStoreDefaultState<M>,\n  ServiceStoreDefaultGetters<M>\n>\n\nexport function makeGetters<M extends BaseModel = BaseModel, S extends StateTree = {}, G extends _GettersTree<S> = {}>(\n  options: MakeServiceGettersOptions<M, S, G>,\n): ServiceStoreDefaultGetters<M> & G {\n  const defaultGetters: ServiceStoreTypedGetters<M> = {\n    // Returns the Feathers service currently assigned to this store.\n    service() {\n      const client = options.clients[this.clientAlias]\n      if (!client) {\n        throw new Error(\n          `There is no registered FeathersClient named '${this.clientAlias}'. You need to provide one in the 'defineStore' options.`,\n        )\n      }\n      return client.service(this.servicePath)\n    },\n    Model() {\n      return options.Model\n    },\n    isSsr() {\n      const ssr = unref(options.ssr)\n      return !!ssr\n    },\n    itemIds() {\n      return this.items.map((item: any) => item[this.idField])\n    },\n    items() {\n      return Object.values(this.itemsById) as M[]\n    },\n    tempIds() {\n      return this.temps.map((temp: any) => temp[this.tempIdField])\n    },\n    temps() {\n      return Object.values(this.tempsById) as M[]\n    },\n    cloneIds() {\n      return this.clones.map((clone: any) => clone[this.idField])\n    },\n    clones() {\n      return Object.values(this.clonesById) as M[]\n    },\n    findInStore() {\n      return (params: Params) => {\n        params = { ...unref(params) } || {}\n\n        const { paramsForServer, whitelist, itemsById } = this\n        const q = _.omit(params.query || {}, ...paramsForServer)\n\n        const { query, filters } = filterQuery(q, {\n          filters: {\n            $and: true,\n            $or: true,\n          },\n          operators: additionalOperators\n            .concat(whitelist || [])\n            .concat(['$like', '$iLike', '$ilike', '$notLike', '$notILike'])\n            .concat(this.service.options?.allow || this.service.options?.whitelist || []),\n        })\n        if (filters.$or) query.$or = filters.$or\n        if (filters.$and) query.$and = filters.$and\n\n        let values = _.values(itemsById)\n\n        if (params.temps) {\n          values.push(..._.values(this.tempsById))\n        }\n\n        values = values.filter(sift(query, { operations }))\n\n        const total = values.length\n\n        if (filters.$sort) {\n          values.sort(sorter(filters.$sort))\n        }\n\n        if (filters.$skip) {\n          values = values.slice(filters.$skip)\n        }\n\n        if (typeof filters.$limit !== 'undefined') {\n          values = values.slice(0, filters.$limit)\n        }\n\n        // TODO: explore if there's any useful benefit to $select on the client. Right now this causes an infinite loop.\n        // if (filters.$select) {\n        //   values = values.map((value) => _.pick(value, ...filters.$select.slice(), this.idField, this.tempIdField))\n        // }\n\n        // Make sure items are instances\n        values = values.map((item) => {\n          if (item && !item.constructor.modelName) {\n            // @ts-expect-error it's ok to do this side effect once.\n            item = this.addOrUpdate(item)\n          }\n          return item\n        })\n\n        return {\n          total,\n          limit: filters.$limit || 0,\n          skip: filters.$skip || 0,\n          data: values,\n        }\n      }\n    },\n    countInStore() {\n      return (params: Params) => {\n        params = { ...unref(params) }\n\n        if (!params.query) {\n          throw 'params must contain a query-object'\n        }\n\n        params.query = _.omit(params.query, ...FILTERS)\n\n        return this.findInStore(params).total\n      }\n    },\n    getFromStore() {\n      return (id: Id | null, params: Params = {}) => {\n        id = unref(id)\n        params = fastCopy(unref(params) || {})\n\n        let item = null\n        const existingItem = this.itemsById[id as Id] && select(params, this.idField)(this.itemsById[id as Id])\n        const tempItem = this.tempsById[id as Id] && select(params, this.tempIdField)(this.tempsById[id as Id])\n\n        if (existingItem) item = existingItem\n        else if (tempItem) item = tempItem\n\n        // Make sure item is an instance\n        if (item && !item.constructor.modelName) {\n          // @ts-expect-error access action in getter is not intended\n          item = this.addOrUpdate(item)\n        }\n        return item\n      }\n    },\n    isCreatePending() {\n      return makePending('create', this)\n    },\n    isPatchPending() {\n      return makePending('patch', this)\n    },\n    isUpdatePending() {\n      return makePending('update', this)\n    },\n    isRemovePending() {\n      return makePending('remove', this)\n    },\n  }\n\n  return Object.assign(defaultGetters, options.getters)\n}\n\nfunction makePending(method: string, store: any): boolean {\n  const isPending = Object.keys(store.pendingById).reduce((isPending, key) => {\n    return store.pendingById[key][method] || isPending\n  }, false)\n  return isPending\n}\n","import { computed, Ref } from 'vue-demi'\n\nexport const usePageData = ($limit: Ref<number>, $skip: Ref<number>, _total: Ref<number>) => {\n  /**\n   * The number of pages available based on the results returned in the latestQuery prop.\n   */\n  const pageCount = computed(() => {\n    if (_total.value) return Math.ceil(_total.value / $limit.value)\n    else return 1\n  })\n\n  // Uses Math.floor so we can't land on a non-integer page like 1.4\n  const currentPage = computed({\n    set(pageNumber: number) {\n      if (pageNumber < 1) pageNumber = 1\n      else if (pageNumber > pageCount.value) pageNumber = pageCount.value\n      const newSkip = $limit.value * Math.floor(pageNumber - 1)\n      $skip.value = newSkip\n    },\n    get() {\n      return pageCount.value === 0 ? 0 : Math.floor($skip.value / $limit.value + 1)\n    },\n  })\n\n  const canPrev = computed(() => {\n    return currentPage.value - 1 > 0\n  })\n  const canNext = computed(() => {\n    return currentPage.value < pageCount.value\n  })\n\n  const toStart = () => Promise.resolve((currentPage.value = 1))\n  const toEnd = () => Promise.resolve((currentPage.value = pageCount.value))\n  const toPage = (pageNumber: number) => Promise.resolve((currentPage.value = pageNumber))\n  const next = () => Promise.resolve(currentPage.value++)\n  const prev = () => Promise.resolve(currentPage.value--)\n\n  return { pageCount, currentPage, canPrev, canNext, toStart, toEnd, toPage, next, prev }\n}\n","import type { Paginated, Params, QueryInfo } from './types'\nimport type {\n  ServiceStoreDefault,\n  FindFn,\n  FindClassParamsStandalone,\n  FindClassParams,\n  CurrentQuery,\n} from './service-store/types'\nimport type { MaybeRef } from './utility-types'\nimport { computed, ComputedRef, isReadonly, isRef, Ref, ref, unref, watch, WritableComputedRef } from 'vue-demi'\nimport { BaseModel } from './service-store/base-model'\nimport { usePageData } from './utils-pagination'\nimport {\n  computedAttr,\n  getQueryInfo,\n  hasOwn,\n  makeParamsWithoutPage,\n  makeUseFindItems,\n  updateParamsExcludePage,\n} from './utils'\nimport { _ } from '@feathersjs/commons'\nimport isEqual from 'fast-deep-equal'\n\ntype Store<M extends BaseModel> = ServiceStoreDefault<M>\n\nexport function useFind<M extends BaseModel>(params: MaybeRef<FindClassParamsStandalone<M>>) {\n  return new Find(params)\n}\n\nexport class Find<M extends BaseModel> {\n  params: Ref<FindClassParams>\n  onServer: boolean\n  isSsr: ComputedRef<boolean>\n  qid: WritableComputedRef<string>\n\n  // Data\n  data: ComputedRef<M[]>\n  allData: ComputedRef<M[]>\n  total: ComputedRef<number>\n  limit: Ref<number>\n  skip: Ref<number>\n  findInStore: (params: Params) => Paginated<M>\n\n  // Queries\n  currentQuery: ComputedRef<CurrentQuery<M> | null>\n  latestQuery: ComputedRef<QueryInfo | null>\n  previousQuery: ComputedRef<QueryInfo | null>\n\n  // Requests & Watching\n  find: FindFn<M>\n  request: Ref<Promise<Paginated<M>>>\n  requestCount: Ref<number>\n  queryWhen: (queryWhenFn: () => boolean) => void\n\n  // Request State\n  isPending: ComputedRef<boolean>\n  haveBeenRequested: ComputedRef<boolean>\n  haveLoaded: ComputedRef<boolean>\n  error: ComputedRef<any>\n  clearError: () => void\n\n  // Pagination Utils\n  pageCount: Ref<number>\n  currentPage: Ref<number>\n  canPrev: ComputedRef<boolean>\n  canNext: ComputedRef<boolean>\n  next: () => Promise<void>\n  prev: () => Promise<void>\n  toStart: () => Promise<void>\n  toEnd: () => Promise<void>\n  toPage: (page: number) => Promise<void>\n\n  constructor(_params: MaybeRef<FindClassParamsStandalone<M>>) {\n    // If the _params are a computed, store them so we can watch them later.\n    let _computedParams: any\n    if (isReadonly(_params)) {\n      _computedParams = _params\n    }\n\n    const store = unref(_params).store as Store<M>\n    // If we started without a query, assign an empty query. Assure computed params becomes writable ref.\n    const params = isRef(_params) ? (isReadonly(_params) ? ref(_params.value) : _params) : ref(_params)\n\n    // Remove the store from the provided params\n    delete (params.value as FindClassParams).store\n\n    /*** PARAMS ***/\n    this.params = params as Ref<FindClassParams>\n    this.qid = computedAttr(params.value, 'qid')\n    // Set qid to default if it was not passed in the params.\n    if (!this.qid.value) this.qid.value = 'default'\n    const { immediate = true, watch: _watch = false } = params.value\n    const query = computedAttr(this.params, 'query')\n    this.limit = computedAttr(query, '$limit')\n    this.skip = computedAttr(query, '$skip')\n    const paramsWithPagination = computed(() => {\n      return {\n        ...params.value,\n        $limit: this.limit.value,\n        $skip: this.skip.value,\n      }\n    })\n    const paramsWithoutPagination = computed(() => {\n      const queryShallowCopy = { ...(params.value.query || {}) }\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      const { $limit, $skip, ...query } = queryShallowCopy\n      return { ...params.value, query }\n    })\n    this.onServer = !!params.value.onServer\n    this.isSsr = computed(() => store.isSsr)\n\n    /*** REQUEST STATE ***/\n    const isPending = ref(false)\n    const haveBeenRequested = ref(false)\n    const haveLoaded = ref(false)\n    const error = ref(null)\n    this.isPending = computed(() => isPending.value)\n    this.haveBeenRequested = computed(() => haveBeenRequested.value)\n    this.haveLoaded = computed(() => haveLoaded.value)\n    this.error = computed(() => error.value)\n    this.clearError = () => (error.value = null)\n\n    /*** STORE ITEMS ***/\n    this.data = computed(() => {\n      if (isPending.value && this.latestQuery.value && this.onServer) {\n        const { pageParams, queryParams } = this.latestQuery.value as any\n        const params = { query: { ...pageParams, ...queryParams }, onServer: true }\n        return makeUseFindItems(store, params).value\n      }\n      return makeUseFindItems(store, paramsWithPagination).value\n    })\n    this.allData = computed(() => {\n      if (this.currentQuery == null) {\n        return []\n      }\n      // Pull server results for each page of data\n      const pageKeys = Object.keys(_.omit(this.currentQuery.value?.queryState, 'total', 'queryParams'))\n      const pages = Object.values(_.pick(this.currentQuery.value?.queryState, ...pageKeys))\n      // remove possible duplicates (page data can be different as you browse between pages and new items are added)\n      const ids = pages.reduce((allIds, page) => {\n        page.ids.forEach((id: number | string) => {\n          if (!allIds.includes(id)) allIds.push(id)\n        })\n        return allIds\n      }, [])\n      const matchingItemsById = _.pick(store.itemsById, ...ids)\n      return Object.values(matchingItemsById)\n    })\n    this.findInStore = store.findInStore\n\n    /*** QUERY WHEN ***/\n    let queryWhen = () => true\n    this.queryWhen = (queryWhenFn: () => boolean) => {\n      queryWhen = queryWhenFn\n    }\n    // returns cached query data from the store BEFORE the request is sent.\n    this.currentQuery = computed(() => {\n      const qidState: any = store.pagination[this.qid.value]\n      if (!qidState) return null\n      const queryInfo = getQueryInfo(params.value)\n      delete queryInfo.response\n      delete queryInfo.isOutdated\n\n      const queryState = qidState[queryInfo.queryId]\n      if (!queryState) return null\n\n      const { total } = queryState\n      const pageState = queryState[queryInfo.pageId as string]\n      if (!pageState) return null\n\n      const { ids, queriedAt } = pageState\n      const items = Object.values(_.pick(store.itemsById, ...ids))\n      const info = { ...queryInfo, ids, items, total, queriedAt, queryState } as CurrentQuery<M>\n      return info || null\n    })\n\n    /*** QUERIES ***/\n    const queries: Ref<QueryInfo[]> = ref([]) // query info after the response returns\n    this.latestQuery = computed(() => {\n      return queries.value[queries.value.length - 1] || null\n    })\n    this.previousQuery = computed(() => {\n      return queries.value[queries.value.length - 2] || null\n    })\n\n    /*** PAGINATION DATA ***/\n    const storeCount = computed(() => store.countInStore(paramsWithoutPagination.value))\n    this.total = computed(() => {\n      if (this.onServer) return (this.latestQuery.value as any)?.response.total\n      else return storeCount.value\n    })\n    const pageData = usePageData(this.limit, this.skip, this.total)\n    const { pageCount, currentPage, canPrev, canNext } = pageData\n    Object.assign(this, { pageCount, currentPage, canPrev, canNext })\n\n    /*** PAGINATION UTILS ***/\n    const waitForExistingRequest = async () => {\n      if (request.value) await request.value\n    }\n    this.toStart = () =>\n      waitForExistingRequest()\n        .then(() => pageData.toStart())\n        .then(() => makeRequest())\n    this.toEnd = () =>\n      waitForExistingRequest()\n        .then(() => pageData.toEnd())\n        .then(() => makeRequest())\n    this.toPage = (page: number) =>\n      waitForExistingRequest()\n        .then(() => pageData.toPage(page))\n        .then(() => makeRequest())\n    this.next = () =>\n      waitForExistingRequest()\n        .then(() => pageData.next())\n        .then(() => makeRequest())\n    this.prev = () =>\n      waitForExistingRequest()\n        .then(() => pageData.prev())\n        .then(() => makeRequest())\n\n    /*** SERVER FETCHING ***/\n    this.requestCount = ref(0)\n    this.request = ref(null) as any\n    this.find = async (params: MaybeRef<Params> = paramsWithPagination) => {\n      const _params = unref(params)\n      // if queryWhen is falsey, return early with dummy data\n      if (!queryWhen()) {\n        return Promise.resolve({ data: [] as M[] } as Paginated<M>)\n      }\n\n      this.requestCount.value++\n      haveBeenRequested.value = true // never resets\n      isPending.value = true\n      haveLoaded.value = false\n      error.value = null\n\n      try {\n        const response = await store.find(_params)\n\n        // Set limit and skip if missing\n        if ((hasOwn(response, 'limit') && this.limit.value == null) || this.skip.value == null) {\n          const res = response as Paginated<M>\n          if (this.limit.value === undefined) this.limit.value = res.limit\n          if (this.skip.value === undefined) this.skip.value = res.skip\n        }\n        // Keep the two most-recent queries\n        if ((response as Paginated<M>).total) {\n          const res = response as Paginated<M>\n          const queryInfo = getQueryInfo(paramsWithPagination, res)\n          queries.value.push(queryInfo)\n          if (queries.value.length > 2) queries.value.shift()\n        }\n        haveLoaded.value = true\n\n        return response\n      } catch (err: any) {\n        error.value = err\n        throw err\n      } finally {\n        isPending.value = false\n      }\n    }\n\n    /*** QUERY WATCHING ***/\n    // Keep track if no $limit or $skip was passed so we don't fetch twice when they are set from the response\n    let initWithLimitOrSkip = false\n    // provide access to the request from inside the watcher\n    const request = this.request\n    if (this.limit.value || this.skip.value) initWithLimitOrSkip = true\n\n    const makeRequest = async (_params?: Params) => {\n      if (!this.onServer) return\n\n      // Don't make a second request if no limit or skip were provided\n      if (this.requestCount.value === 1 && !initWithLimitOrSkip && !_computedParams) {\n        initWithLimitOrSkip = true\n        return\n      }\n      request.value = this.find(_params || params)\n      await request.value\n    }\n\n    if (this.onServer) {\n      // When a read-only computed was provided, watch the params\n      if (_computedParams) {\n        let _cachedWatchedParams: FindClassParams\n        // Run `find` whenever they change.\n        const updateParams = (_params: FindClassParams) => {\n          // If params are null, do nothing\n          if (_params == null) return\n\n          // If params don't match the cached ones, update internal params and send request.\n          const newParams = makeParamsWithoutPage(_params)\n          if (!isEqual(_.omit(newParams, 'store'), _.omit(_cachedWatchedParams, 'store'))) {\n            _cachedWatchedParams = newParams\n            updateParamsExcludePage(params as any, newParams)\n            makeRequest()\n          }\n        }\n        watch(_computedParams, updateParams, { immediate })\n      }\n      // Watch the reactive params\n      else if (_watch && !_computedParams) {\n        watch(paramsWithoutPagination, () => makeRequest(), { immediate })\n      }\n      // If immediate is provided without limit or skip, manually run immediately\n      else if ((!_watch && immediate) || (immediate && (this.limit.value == null || this.limit.value == null))) {\n        makeRequest()\n      }\n    }\n\n    return this\n  }\n}\n","import type { Params } from './types'\nimport type { ServiceStoreDefault, GetFn, GetClassParamsStandalone, GetClassParams } from './service-store/types'\nimport type { MaybeRef } from './utility-types'\nimport type { Id } from '@feathersjs/feathers'\nimport { computed, ComputedRef, isReadonly, isRef, Ref, ref, unref, watch } from 'vue-demi'\nimport { BaseModel } from './service-store/base-model'\n\ntype Store<M extends BaseModel> = ServiceStoreDefault<M>\n\nexport function useGet<M extends BaseModel>(id: Id, params: MaybeRef<GetClassParamsStandalone<M>>) {\n  return new Get(id, params)\n}\n\nexport class Get<M extends BaseModel> {\n  id: Ref<Id | null>\n  params: Ref<GetClassParams>\n  isSsr: ComputedRef<boolean>\n\n  // Data\n  data: ComputedRef<M | null>\n  ids: Ref<Id[]>\n  getFromStore: (id: Id | null, params: Params) => M | undefined\n\n  // Requests & Watching\n  get: GetFn<M>\n  request: Ref<Promise<M | undefined>>\n  requestCount: Ref<number>\n  queryWhen: (queryWhenFn: () => boolean) => void\n\n  // Request State\n  isPending: Ref<boolean>\n  hasBeenRequested: Ref<boolean>\n  hasLoaded: Ref<boolean>\n  error: ComputedRef<any>\n  clearError: () => void\n\n  constructor(_id: MaybeRef<Id | null>, _params: MaybeRef<GetClassParamsStandalone<M>>) {\n    const store = unref(_params).store as Store<M>\n    const id = isRef(_id) ? (isReadonly(_id) ? ref(_id.value) : _id) : ref(_id)\n    const params = isRef(_params) ? (isReadonly(_params) ? ref(_params.value) : _params) : ref(_params)\n\n    // Remove the store from the provided params\n    delete (params.value as GetClassParams).store\n\n    /*** ID & PARAMS ***/\n    this.id = id as Ref<Id | null>\n    this.params = params as Ref<GetClassParams>\n    const { immediate = true, watch: _watch = true, onServer = false } = params.value\n    this.isSsr = computed(() => store.isSsr)\n\n    /*** REQUEST STATE ***/\n    const isPending = ref(false)\n    const hasBeenRequested = ref(false)\n    const hasLoaded = ref(false)\n    const error = ref(null)\n    this.isPending = computed(() => isPending.value)\n    this.hasBeenRequested = computed(() => hasBeenRequested.value)\n    this.hasLoaded = computed(() => hasLoaded.value)\n    this.error = computed(() => error.value)\n    this.clearError = () => (error.value = null)\n\n    /*** STORE ITEMS ***/\n    this.ids = ref([])\n    const mostRecentId = computed(() => {\n      return this.ids.value.length && this.ids.value[this.ids.value.length - 1]\n    })\n    this.data = computed(() => {\n      if (isPending.value && mostRecentId.value != null) {\n        return store.getFromStore(mostRecentId.value, params) || null\n      }\n      return store.getFromStore(id.value, params) || null\n    })\n    this.getFromStore = store.getFromStore\n\n    /*** QUERY WHEN ***/\n    let queryWhen = () => true\n    this.queryWhen = (queryWhenFn: () => boolean) => {\n      queryWhen = queryWhenFn\n    }\n\n    /*** SERVER FETCHING ***/\n    this.requestCount = ref(0)\n    this.request = ref(null) as any\n    this.get = async (__id?: MaybeRef<Id>, params?: MaybeRef<Params>) => {\n      const _id = unref(__id || id)\n      const _params = unref(params)\n\n      if (!queryWhen()) return\n\n      if (_id == null) {\n        throw new Error('id is required for feathers-pinia get requests')\n      }\n\n      this.requestCount.value++\n      hasBeenRequested.value = true // never resets\n      isPending.value = true\n      hasLoaded.value = false\n      error.value = null\n\n      try {\n        const response = await store.get(_id as Id, _params)\n\n        // Keep a list of retrieved ids\n        if (response && _id) {\n          this.ids.value.push(_id)\n        }\n        hasLoaded.value = true\n\n        return response\n      } catch (err: any) {\n        error.value = err\n        throw err\n      } finally {\n        isPending.value = false\n      }\n    }\n\n    const request = this.request\n    const makeRequest = async (id: Id, params: MaybeRef<Params>) => {\n      if (!id) return\n      request.value = this.get(id, params)\n      await request.value\n    }\n\n    // Watch the id\n    if (onServer && _watch) {\n      watch(\n        id,\n        async () => {\n          await makeRequest(id as any, params)\n        },\n        { immediate },\n      )\n    }\n\n    return this\n  }\n}\n","import type { UseFindComputed, UseFindWatchedOptionsStandalone, UseFindState } from './service-store/types'\nimport type { Params, Paginated } from './types'\nimport { computed, reactive, Ref, unref, toRefs, watch } from 'vue-demi'\nimport debounce from 'just-debounce'\nimport { getQueryInfo, makeUseFindItems } from './utils'\nimport { BaseModel } from './service-store'\n\nexport function useFindWatched<M extends BaseModel = BaseModel>({\n  model,\n  params = computed(() => null),\n  fetchParams = computed(() => undefined),\n  qid = 'default',\n  queryWhen = computed(() => true),\n  local = false,\n  immediate = true,\n}: UseFindWatchedOptionsStandalone<M>) {\n  if (!model) {\n    throw new Error(`No model provided for useFind(). Did you define and register it with FeathersPinia?`)\n  }\n\n  const getParamsForFetch = (providedParams?: Params | Ref<Params>): Params | null => {\n    const provided = unref(providedParams)\n    const forFetch = unref(fetchParams)\n\n    const paramsToUse =\n      provided || provided === null ? provided : forFetch || forFetch === null ? forFetch : unref(params)\n\n    return paramsToUse\n  }\n\n  const state = reactive<UseFindState>({\n    qid,\n    isPending: false,\n    haveBeenRequested: false,\n    haveLoaded: local,\n    error: null,\n    debounceTime: null,\n    latestQuery: null,\n    isLocal: local,\n    request: null,\n  })\n\n  const computes: UseFindComputed<M> = {\n    // The find getter\n    items: makeUseFindItems(model.store || model, params),\n    paginationData: computed(() => {\n      return model.store.pagination\n    }),\n    servicePath: computed(() => model.servicePath),\n    isSsr: computed(() => model.store.isSsr),\n  }\n\n  /**\n   * If queryWhen is a function, call queryWhen with a context, otherwise return its value.\n   * @param queryWhen\n   * @param params\n   * @returns boolean\n   */\n  function handleQueryWhen(queryWhen: any, params: Params | Ref<Params>): boolean {\n    const val = unref(queryWhen)\n    // If queryWhen returns a function, call it with a context\n    if (typeof val === 'function') {\n      const info = getQueryInfo(params, {})\n      const qidData = model.store.pagination[info.qid]\n      // @ts-expect-error fix me ts(7053)\n      const queryData = qidData?.[info.queryId]\n      const pageData = queryData?.[info.pageId as string]\n      const context = {\n        items: computes.items,\n        queryInfo: info,\n        qidData,\n        queryData,\n        pageData,\n        isPending: computed(() => state.isPending),\n        haveBeenRequested: computed(() => state.haveBeenRequested),\n        haveLoaded: computed(() => state.haveLoaded),\n        error: computed(() => state.error),\n      }\n      return val(context)\n    }\n    return val\n  }\n\n  /**\n   * Fetch records from the API server.\n   * @param params\n   * @returns query results\n   */\n  function find(params: Params | Ref<Params>): Promise<M[] | Paginated<M>> | void {\n    if (state.isLocal) return\n\n    params = unref(params)\n    state.isPending = true\n    state.haveBeenRequested = true\n\n    const request = model.find(params).then((response: any) => {\n      // To prevent thrashing, only clear error on response, not on initial request.\n      state.error = null\n      state.haveLoaded = true\n      if (!Array.isArray(response)) {\n        const queryInfo = getQueryInfo(params, response)\n        queryInfo.isOutdated = false\n        state.latestQuery = queryInfo\n      }\n      state.isPending = false\n      return response\n    })\n    state.request = request\n    return request\n  }\n  const methods = {\n    findDebounced(params: Params) {\n      return find(params)\n    },\n  }\n  function findProxy(params?: Params | Ref<Params>) {\n    const paramsToUse = getParamsForFetch(params)\n\n    if (paramsToUse && paramsToUse.debounce) {\n      if (paramsToUse.debounce !== state.debounceTime) {\n        methods.findDebounced = debounce(find, paramsToUse.debounce)\n        state.debounceTime = paramsToUse.debounce\n      }\n      return methods.findDebounced(paramsToUse)\n    } else if (paramsToUse) {\n      return find(paramsToUse)\n    } else {\n      // Set error\n    }\n  }\n\n  const wrappedQueryWhen = computed(() => {\n    const params = getParamsForFetch()\n    if (typeof queryWhen.value === 'function') {\n      return handleQueryWhen(queryWhen.value, params as Params)\n    } else {\n      return queryWhen.value\n    }\n  })\n\n  watch(\n    () => [getParamsForFetch(), wrappedQueryWhen.value],\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ([params, queryWhen]: (boolean | Params | null)[]) => {\n      if (queryWhen) {\n        findProxy()\n      }\n    },\n    { immediate },\n  )\n\n  return { ...computes, ...toRefs(state), find: findProxy }\n}\n","import type { UseGetComputed, UseGetOptionsStandalone, UseGetState } from './service-store/types'\nimport type { Id } from '@feathersjs/feathers'\nimport type { Params } from './types'\nimport { reactive, computed, toRefs, unref, watch } from 'vue-demi'\nimport { BaseModel } from './service-store'\n\nexport function useGetWatched<M extends BaseModel = BaseModel>({\n  model,\n  id,\n  params = computed(() => ({})),\n  queryWhen = computed((): boolean => true),\n  local = false,\n  immediate = true,\n}: UseGetOptionsStandalone<M>) {\n  if (!model) {\n    throw new Error(`No model provided for useGetWatched(). Did you define and register it with FeathersPinia?`)\n  }\n\n  function getId() {\n    return unref(id)\n  }\n  function getParams() {\n    return unref(params)\n  }\n\n  const state = reactive<UseGetState>({\n    isPending: false,\n    hasBeenRequested: false,\n    hasLoaded: false,\n    error: null,\n    isLocal: local,\n    request: null,\n  })\n\n  const computes: UseGetComputed<M> = {\n    item: computed(() => {\n      const unrefId = getId()\n      if (unrefId === null) {\n        return null\n      }\n      return (model.getFromStore(unrefId, getParams()) as M) || null\n    }),\n    servicePath: computed(() => model.servicePath),\n    isSsr: computed(() => model.store.isSsr),\n  }\n\n  async function get(id: Id | null, params?: Params): Promise<M | undefined | any> {\n    const idToUse = unref(id)\n    const paramsToUse = unref(params)\n\n    if (idToUse != null && queryWhen.value && !state.isLocal) {\n      state.isPending = true\n      state.error = null\n      state.hasBeenRequested = true\n\n      const request = paramsToUse != null ? model.get(idToUse, paramsToUse) : model.get(idToUse)\n      state.request = request\n\n      try {\n        const response = await request\n        state.isPending = false\n        state.hasLoaded = true\n        return response\n      } catch (error: any) {\n        state.isPending = false\n        state.error = error\n        return error\n      }\n    } else {\n      return Promise.resolve(undefined)\n    }\n  }\n\n  watch(\n    () => [getId(), getParams(), queryWhen.value],\n    ([id, params]) => {\n      get(id as Id | null, params as Params)\n    },\n    { immediate },\n  )\n\n  // Clear error when an item is found\n  watch(\n    () => computes.item.value,\n    (item) => {\n      if (item) {\n        state.error = null\n      }\n    },\n  )\n\n  return {\n    ...toRefs(state),\n    ...computes,\n    get,\n  }\n}\n","import type {\n  ServiceStoreDefaultActions,\n  UpdatePaginationForQueryOptions,\n  RequestType,\n  AnyDataOrArray,\n  ServiceStoreDefaultGetters,\n  ServiceStoreDefaultState,\n  HandleFindResponseOptions,\n  HandleFindErrorOptions,\n  AnyData,\n  MakeServiceActionsOptions,\n  CloneOptions,\n  UseFindWatchedOptions,\n  UseGetOptions,\n  FindClassParams,\n  FindClassParamsStandalone,\n  GetClassParams,\n  GetClassParamsStandalone,\n} from './types'\nimport type { Params } from '../types'\nimport type { Id, NullableId } from '@feathersjs/feathers'\nimport type { MaybeArray, MaybeRef, TypedActions } from '../utility-types'\nimport { _ } from '@feathersjs/commons'\nimport fastCopy from 'fast-copy'\nimport {\n  getId,\n  getTempId,\n  getAnyId,\n  getQueryInfo,\n  assignTempId,\n  cleanData,\n  restoreTempIds,\n  getArray,\n  hasOwn,\n  getSaveParams,\n  markAsClone,\n  copyAssociations,\n} from '../utils'\nimport { unref, set } from 'vue-demi'\nimport { StateTree, _GettersTree } from 'pinia'\nimport { BaseModel } from './base-model'\nimport { useFind } from '../use-find'\nimport { useGet } from '../use-get'\nimport { useFindWatched } from '../use-find-watched'\nimport { useGetWatched } from '../use-get-watched'\n\ntype ServiceStoreTypedActions<M extends BaseModel = BaseModel> = TypedActions<\n  ServiceStoreDefaultState<M>,\n  ServiceStoreDefaultGetters<M>,\n  ServiceStoreDefaultActions<M>\n>\n\nexport function makeActions<\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n>(options: MakeServiceActionsOptions<M, S, G, A>): ServiceStoreDefaultActions<M> & A {\n  const defaultActions: ServiceStoreTypedActions<M> = {\n    find(_params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n      const { query = {} } = params\n      const isPaginated = params.paginate === true || hasOwn(query, '$limit') || hasOwn(query, '$skip')\n\n      // For client-side services, like feathers-memory, paginate.default must be truthy.\n      if (isPaginated) {\n        params.paginate = { default: true }\n      }\n\n      this.setPendingById('Model', 'find', true)\n\n      const info = getQueryInfo(params, {})\n      const qidData = this.pagination[info.qid]\n      // @ts-expect-error todo\n      const queryData = qidData?.[info.queryId]\n      const pageData = queryData?.[info.pageId as string]\n\n      let ssrPromise\n\n      if (pageData?.ssr) {\n        const ssrResponse = {\n          data: pageData.ids.map((id: Id) => this.getFromStore(id)),\n          limit: pageData.pageParams.$limit,\n          skip: pageData.pageParams.$skip,\n          total: queryData.total,\n          fromSsr: true,\n        }\n        ssrPromise = Promise.resolve(ssrResponse)\n        if (!params.preserveSsr) {\n          this.unflagSsr(params)\n        }\n      }\n\n      return (ssrPromise || this.service.find(params))\n        .then((response: any) => this.handleFindResponse({ params, response }))\n        .catch((error: any) => this.handleFindError({ params, error }))\n        .finally(() => {\n          this.setPendingById('Model', 'find', false)\n        })\n    },\n    /**\n     * Handle the response from the find action.\n     *\n     * @param payload consists of the following two params\n     *   @param params - Remember that these params aren't what was sent to the\n     *         Feathers client.  The client modifies the params object.\n     *   @param response\n     */\n    async handleFindResponse({ params, response }: HandleFindResponseOptions) {\n      const { idField } = this\n      const { qid = 'default', query, preserveSsr = false } = params\n      // Normalize response so data is always found at response.data\n      if (Array.isArray(response)) response = { data: response }\n\n      this.addOrUpdate(response.data)\n\n      // The pagination data will be under `pagination.default` or whatever qid is passed.\n      response.data && this.updatePaginationForQuery({ qid, response, query, preserveSsr })\n\n      // Swap out the response records for their Vue-observable store versions\n      const data = response.data\n      const mappedFromState = data.map((i: any) => this.itemsById[getId(i, idField)])\n      if (mappedFromState[0] !== undefined) {\n        response.data ? (response.data = mappedFromState) : (response = mappedFromState)\n      }\n\n      response = await this.afterFind(response)\n\n      return response\n    },\n    async afterFind(response: any) {\n      return response\n    },\n    handleFindError({ error }: HandleFindErrorOptions) {\n      //  commit('setError', { method: 'find', params, error })\n      return Promise.reject(error)\n    },\n\n    count(_params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n      const { query = {} } = params\n\n      query.$limit = 0\n\n      Object.assign(params, { query })\n\n      this.setPendingById('Model', 'count', true)\n\n      return this.service.find(params).finally(() => {\n        this.setPendingById('Model', 'count', false)\n      })\n    },\n\n    // Supports passing params the feathers way: `get(id, params)`\n    // Does NOT support the old array syntax:\n    // `get([null, params])` which was only needed for Vuex\n    get(id: Id, _params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n\n      const skipRequestIfExists = params.skipRequestIfExists || this.skipRequestIfExists\n      delete params.skipRequestIfExists\n\n      // If the records is already in store, return it\n      const existingItem = this.getFromStore(id, params)\n      if (existingItem && skipRequestIfExists) {\n        return Promise.resolve(existingItem)\n      }\n\n      this.setPendingById('Model', 'get', true)\n\n      return this.service\n        .get(id, params)\n        .then((data: any) => {\n          this.addOrUpdate(data)\n          this.setPendingById('Model', 'get', false)\n          return this.itemsById[id]\n        })\n        .catch((error: Error) => {\n          // commit('setError', { method: 'get', error })\n          this.setPendingById('Model', 'get', false)\n          return Promise.reject(error)\n        })\n    },\n\n    create(data: AnyDataOrArray, _params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n\n      const { idField, tempIdField } = this\n\n      if (!Array.isArray(data)) {\n        this.setPendingById(getId(data, idField) || data[tempIdField], 'create', true)\n      }\n\n      return this.service\n        .create(cleanData(data, this.Model.tempIdField), params)\n        .then((response: any) => {\n          return this.addOrUpdate(restoreTempIds(data, response, this.Model.tempIdField))\n        })\n        .catch((error: Error) => {\n          // commit('setError', { method: 'create', error })\n          return Promise.reject(error)\n        })\n        .finally(() => {\n          if (!Array.isArray(data)) {\n            this.setPendingById(getId(data, idField) || data[tempIdField], 'create', false)\n          }\n        })\n    },\n    update(id: Id, data: AnyData, _params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n\n      this.setPendingById(id, 'update', true)\n\n      return this.service\n        .update(id, cleanData(data, this.Model.tempIdField), params)\n        .then((data: any) => {\n          return this.addOrUpdate(data)\n        })\n        .catch((error: Error) => {\n          // commit('setError', { method: 'update', error })\n          return Promise.reject(error)\n        })\n        .finally(() => {\n          this.setPendingById(id, 'update', false)\n        })\n    },\n    patch(id: NullableId, data: any, _params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n\n      if (params && params.data) {\n        data = params.data\n      }\n      this.setPendingById(id, 'patch', true)\n\n      return this.service\n        .patch(id, cleanData(data, this.Model.tempIdField), params)\n        .then((data: any) => {\n          return this.addOrUpdate(data)\n        })\n        .catch((error: Error) => {\n          // commit('setError', { method: 'update', error })\n          return Promise.reject(error)\n        })\n        .finally(() => {\n          this.setPendingById(id, 'patch', false)\n        })\n    },\n\n    /**\n     * Sends API request to remove the record with the given id.\n     * Calls `removeFromStore` after response.\n     * @param id\n     * @param params\n     * @returns\n     */\n    remove(id: NullableId, _params?: MaybeRef<Params>) {\n      const params = getSaveParams(_params)\n\n      this.setPendingById(id, 'remove', true)\n\n      return this.service\n        .remove(id, params)\n        .then((data: any) => {\n          this.setPendingById(id, 'remove', false)\n          this.removeFromStore(data)\n          return data\n        })\n        .catch((error: Error) => {\n          // commit('setError', { method: 'remove', error })\n          this.setPendingById(id, 'remove', false)\n          return Promise.reject(error)\n        })\n    },\n    removeFromStore<T>(data: T): T {\n      const { items } = getArray(data)\n      const { idField, tempIdField } = this\n      const idsToRemove = items\n        .map((item: any) => (getId(item, idField) != null ? getId(item, idField) : getTempId(item, tempIdField)))\n        .filter((id: any) => id != null)\n\n      set(this, 'itemsById', _.omit(this.itemsById, ...idsToRemove))\n\n      set(this, 'clonesById', _.omit(this.clonesById, ...idsToRemove))\n      set(this, 'pendingById', _.omit(this.pendingById, ...idsToRemove))\n      set(this, 'tempsById', _.omit(this.tempsById, ...idsToRemove))\n\n      return data\n    },\n    /**\n     * An alias for addOrUpdate\n     * @param data a single record or array of records.\n     * @returns data added or modified in the store.\n     *  If you pass an array, you get an array back.\n     */\n    addToStore(data: AnyDataOrArray): MaybeArray<any> {\n      return this.addOrUpdate(data)\n    },\n    addOrUpdate(data: AnyDataOrArray): MaybeArray<any> {\n      const { idField, tempIdField } = this\n      const { items, isArray } = getArray(data)\n\n      const _items = items.map((item: AnyData) => {\n        if (getId(item, idField) != null && getTempId(item, tempIdField) != null) {\n          return this.moveTempToItems(item)\n        } else {\n          return addOrMergeToStore(item, this, options)\n        }\n      })\n\n      return isArray ? _items : _items[0]\n    },\n\n    moveTempToItems(data: AnyData) {\n      const { idField, tempIdField } = this\n      const id = getId(data, idField)\n      const tempId = getTempId(data, tempIdField)\n      const existingTemp = this.tempsById[tempId]\n      if (existingTemp) {\n        set(this.itemsById, id, Object.assign(existingTemp, data))\n        delete this.tempsById[tempId]\n        delete (this.itemsById[id] as any)[tempIdField]\n      }\n      delete data[tempIdField]\n      return this.itemsById[id]\n    },\n\n    clearAll() {\n      set(this, 'itemsById', {})\n      set(this, 'tempsById', {})\n      set(this, 'clonesById', {})\n    },\n\n    clone(item: M, data = {}, options: CloneOptions = {}): M {\n      const tempId = getTempId(item, this.Model.tempIdField)\n      const placeToStore = tempId != null ? 'tempsById' : 'itemsById'\n      const id = getAnyId(item, this.Model.tempIdField, this.Model.idField)\n      const originalItem = this[placeToStore][id]\n      const existing = this.clonesById[id]\n\n      // Maintain reactivity for existing clones\n      if (existing) {\n        if (options.useExisting) return existing\n        return this.reset(item, data) as M\n      } else {\n        // Create the clone with any applicable associations\n        const clone = fastCopy(originalItem)\n        markAsClone(clone)\n        copyAssociations(originalItem, clone, clone.Model.associations)\n\n        // Copy over any provided data\n        Object.assign(clone, data)\n\n        // Store and return the clone\n        set(this.clonesById, id, clone)\n        return this.clonesById[id] as M // Must return the item from the store\n      }\n    },\n\n    commit(item: M, data = {}): M | undefined {\n      const id = getAnyId(item, this.Model.tempIdField, this.Model.idField)\n      if (id != null) {\n        const tempId = getTempId(item, this.Model.tempIdField)\n        const placeToStore = tempId != null ? 'tempsById' : 'itemsById'\n        const clone = this.clonesById[id]\n        const newOriginal = fastCopy(clone)\n        Object.assign(newOriginal, data)\n        copyAssociations(clone, newOriginal, clone.Model.associations)\n\n        set(this[placeToStore], id, newOriginal)\n\n        return this[placeToStore][id] as M\n      }\n    },\n\n    reset(item: M, data = {}): M {\n      const tempId = getTempId(item, this.Model.tempIdField)\n      const placeToStore = tempId != null ? 'tempsById' : 'itemsById'\n      const id = getAnyId(item, this.Model.tempIdField, this.Model.idField)\n      const originalItem = this[placeToStore][id]\n      const existingClone = this.clonesById[id]\n      if (!existingClone) return this.clone(item, data)\n\n      const cloneReset: M = Object.assign(existingClone, originalItem, data)\n\n      // Remove properties that may have been added to the clone but are not in the original\n      Object.keys(cloneReset).forEach((key) => {\n        if (!hasOwn(originalItem, key)) {\n          delete (cloneReset as any)[key]\n        }\n      })\n      markAsClone(cloneReset)\n      return cloneReset\n    },\n\n    /**\n     * Stores pagination data on state.pagination based on the query identifier\n     * (qid) The qid must be manually assigned to `params.qid`\n     */\n    updatePaginationForQuery({ qid, response, query = {}, preserveSsr = false }: UpdatePaginationForQueryOptions) {\n      const { data, total } = response\n      const { idField } = this\n      const ids = data.map((i: any) => getId(i, idField))\n      const queriedAt = new Date().getTime()\n      const { queryId, queryParams, pageId, pageParams } = getQueryInfo({ qid, query }, response)\n\n      if (!this.pagination[qid]) {\n        set(this.pagination, qid, {})\n      }\n\n      if (!hasOwn(query, '$limit') && hasOwn(response, 'limit')) {\n        set(this.pagination, 'defaultLimit', response.limit)\n      }\n      if (!hasOwn(query, '$skip') && hasOwn(response, 'skip')) {\n        set(this.pagination, 'defaultSkip', response.skip)\n      }\n\n      const mostRecent = {\n        query,\n        queryId,\n        queryParams,\n        pageId,\n        pageParams,\n        queriedAt,\n        total,\n      }\n\n      // @ts-expect-error todo\n      const existingPageData = this.pagination[qid]?.[queryId]?.[pageId as string]\n\n      const qidData = this.pagination[qid] || {}\n      Object.assign(qidData, { mostRecent })\n      // @ts-expect-error todo\n      set(qidData, queryId, qidData[queryId] || {})\n      const queryData = {\n        total,\n        queryParams,\n      }\n      // @ts-expect-error todo\n      set(qidData, queryId, Object.assign({}, qidData[queryId], queryData))\n\n      const ssr = preserveSsr ? existingPageData?.ssr : unref(options.ssr)\n\n      const pageData = {\n        [pageId as string]: { pageParams, ids, queriedAt, ssr: !!ssr },\n      }\n      // @ts-expect-error todo\n      Object.assign(qidData[queryId], pageData)\n\n      const newState = Object.assign({}, this.pagination[qid], qidData)\n\n      set(this.pagination, qid, newState)\n    },\n\n    setPendingById(id: NullableId, method: RequestType, val: boolean) {\n      if (id == null) return\n\n      set(this.pendingById, id, this.pendingById[id] || { [method]: val })\n      set(this.pendingById[id], method, val)\n    },\n    hydrateAll() {\n      this.addToStore(this.items)\n    },\n    toggleEventLock(idOrIds: MaybeArray<Id>, event: string) {\n      setEventLockState(idOrIds, event, true, this)\n    },\n    unflagSsr(params: Params) {\n      const queryInfo = getQueryInfo(params, {})\n      const { qid, queryId, pageId } = queryInfo\n      // @ts-expect-error todo\n      const pageData = this.pagination[qid]?.[queryId]?.[pageId as string]\n      pageData.ssr = false\n    },\n\n    // alias to useFind, doesn't require passing the store\n    useFind(params: MaybeRef<FindClassParams>) {\n      (params.value || params).store = this\n      return useFind(params as MaybeRef<FindClassParamsStandalone<M>>)\n    },\n\n    // alias to useGet, doesn't require passing the store\n    useGet(_id: MaybeRef<Id | null>, _params: MaybeRef<GetClassParams> = {}) {\n      (_params.value || _params).store = this\n      return useGet(_id as Id, _params as MaybeRef<GetClassParamsStandalone<M>>)\n    },\n\n    // Retrieves a record only once.\n    useGetOnce(_id: MaybeRef<Id | null>, _params: MaybeRef<GetClassParams> = {}) {\n      Object.assign(_params.value || _params, { store: this, immediate: false, onServer: true })\n      const results = useGet(_id as Id, _params as MaybeRef<GetClassParamsStandalone<M>>)\n      results.queryWhen(() => !results.data.value)\n      results.get()\n      return results\n    },\n\n    // alias to useFindWatched, doesn't require passing the model\n    useFindWatched<M extends BaseModel>(options: UseFindWatchedOptions) {\n      return useFindWatched<M>({ model: this.Model as any, ...options })\n    },\n    // alias to useGetWatched, doesn't require passing the model\n    useGetWatched<M extends BaseModel>(options: UseGetOptions) {\n      return useGetWatched<M>({ model: this.Model as any, ...options })\n    },\n  }\n\n  return Object.assign(defaultActions, options.actions)\n}\n\nfunction setEventLockState(data: MaybeArray<Id>, event: string, val: boolean, store: any) {\n  const { items: ids } = getArray(data)\n  ids.forEach((id) => {\n    const currentLock = store.eventLocksById[event][id]\n    if (currentLock) {\n      delete store.eventLocksById[event][id]\n    } else {\n      set(store.eventLocksById[event], id, true)\n    }\n  })\n}\n\nfunction addOrMergeToStore(item: AnyData, store: any, opts: any) {\n  const { idField, tempIdField, servicePath, isSsr } = store\n\n  const key = getId(item, idField) != null ? 'itemsById' : 'tempsById'\n  if (key === 'tempsById' && !item[tempIdField]) assignTempId(item, tempIdField)\n\n  const id = getAnyId(item, tempIdField, idField)\n  const existing = store[key][id]\n  if (existing) Object.assign(existing, item)\n  else store[key][id] = new opts.Model(item)\n\n  if (isSsr || !(item instanceof opts.Model)) {\n    const classes = { [servicePath]: opts.Model }\n    store[key][id] = new classes[servicePath](existing ? Object.assign(existing, item) : item)\n  }\n\n  const stored = store[key][id]\n  return stored\n}\n","import { BaseModel } from './base-model'\nimport { defineStore as definePiniaStore, Pinia, StateTree, _GettersTree } from 'pinia'\nimport { registerModel } from '../models'\nimport { registerClient, clients } from '../clients'\nimport { enableServiceEvents } from './events'\nimport {\n  DefineFeathersStoreOptions,\n  ServiceStore,\n  ServiceStoreSharedStateDefineOptions,\n  ServiceStoreDefinition,\n  ServiceStoreDefaultState,\n} from './types'\n\nimport { makeState } from './make-state'\nimport { makeGetters } from './make-getters'\nimport { makeActions } from './make-actions'\n\nexport function defineStore<\n  Id extends string,\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n>(_options: DefineFeathersStoreOptions<Id, M, S, G, A>): (pinia?: Pinia) => ServiceStore<Id, M, S, G, A> {\n  const options = makeOptions<Id, M, S, G, A>(_options)\n\n  const {\n    servicePath,\n    idField,\n    tempIdField,\n    handleEvents,\n    debounceEventsTime,\n    debounceEventsGuarantee,\n    clientAlias,\n    Model,\n  } = options\n  let isInitialized = false\n\n  Object.keys(options.clients || {}).forEach((name) => {\n    registerClient(name, options.clients[name])\n  })\n\n  const id: Id = options.id || (`service.${options.servicePath}` as Id)\n\n  const state = makeState<M, S>({\n    clientAlias,\n    servicePath,\n    idField,\n    tempIdField,\n    whitelist: options.whitelist,\n    paramsForServer: options.paramsForServer,\n    skipRequestIfExists: options.skipRequestIfExists,\n    state: options.state,\n  })\n\n  const getters = makeGetters<M, S, G>({\n    clients,\n    Model,\n    ssr: options.ssr,\n    getters: options.getters,\n  })\n\n  const actions = makeActions<M, S, G, A>({\n    clients,\n    getters,\n    actions: options.actions,\n    Model,\n    ssr: options.ssr,\n  })\n\n  function useStore(pinia?: Pinia) {\n    const useStoreDefinition = definePiniaStore<Id, ServiceStoreDefaultState & S, G, A>({\n      id,\n      state,\n      getters,\n      actions,\n    }) as unknown as ServiceStoreDefinition<Id, M, S, G, A>\n    const initializedStore = useStoreDefinition(pinia) as ServiceStore<Id, M, ServiceStoreDefaultState & S, G, A>\n\n    initializedStore.isSsr\n\n    if (!isInitialized) {\n      isInitialized = true\n      // Monkey patch the model with the store and other options\n      Object.assign(options.Model, {\n        store: initializedStore,\n        pinia,\n        servicePath: options.servicePath,\n        idField,\n        tempIdField,\n        clients,\n        // Bind `this` in custom actions to the store.\n        ...Object.keys(options.actions as Record<string, any>).reduce((boundActions: any, key: string) => {\n          const fn = (options.actions as Record<string, any>)[key]\n          boundActions[key] = fn.bind(initializedStore)\n          return boundActions\n        }, {}),\n      })\n\n      const client = clients[clientAlias]\n      if (!client) {\n        throw new Error(\n          `There is no registered FeathersClient named '${clientAlias}'. You need to provide one in the 'defineStore' options.`,\n        )\n      }\n      const service = client.service(servicePath)\n\n      const opts = { idField, debounceEventsTime, debounceEventsGuarantee, handleEvents }\n\n      registerModel(options.Model, initializedStore)\n      enableServiceEvents({\n        service,\n        Model,\n        store: initializedStore,\n        options: opts,\n      })\n    }\n    return initializedStore\n  }\n\n  return useStore\n}\n\nfunction makeOptions<\n  Id extends string,\n  M extends BaseModel = BaseModel,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  A = {},\n>(_options: DefineFeathersStoreOptions<Id, M, S, G, A>): Required<DefineFeathersStoreOptions<Id, M, S, G, A>> {\n  const defaultSharedState: ServiceStoreSharedStateDefineOptions = {\n    clientAlias: 'api',\n    servicePath: '',\n    idField: 'id',\n    tempIdField: '__tempId',\n    paramsForServer: [],\n    whitelist: [],\n    skipRequestIfExists: false,\n  }\n\n  const defaults = Object.assign(defaultSharedState, {\n    id: `service.${_options.servicePath}`,\n    ssr: false,\n    clients: {},\n    enableEvents: true,\n    handleEvents: {},\n    debounceEventsTime: 20,\n    debounceEventsGuarantee: false,\n    state: () => ({}),\n    getters: {},\n    actions: {},\n  })\n\n  let Model\n\n  // If no Model class is provided, create a dynamic one.\n  if (!_options.Model) {\n    Model = class DynamicBaseModel extends BaseModel {\n      static dynamicBaseModel = true\n      static modelName = _options.servicePath\n    }\n  } else {\n    Model = _options.Model\n  }\n\n  if (!Model.modelName) {\n    Model.modelName = Model.name\n  }\n\n  const options = Object.assign(defaults, { Model }, _options)\n\n  options.handleEvents.created ||= () => options.enableEvents\n  options.handleEvents.patched ||= () => options.enableEvents\n  options.handleEvents.updated ||= () => options.enableEvents\n  options.handleEvents.removed ||= () => options.enableEvents\n\n  return options\n}\n","import { BaseModel } from './service-store/base-model'\nimport { registerClient } from './clients'\nimport { defineStore } from './service-store/define-store'\nimport { Ref } from 'vue-demi'\n\nimport { HandleEvents } from './types'\nimport { Pinia, StateTree, _GettersTree } from 'pinia'\nimport { ServiceStore, DefineFeathersStoreOptions, ServiceStoreDefaultState } from './service-store/types'\n\ninterface SetupOptions {\n  ssr?: boolean | Ref<boolean>\n  clients: { [alias: string]: any }\n  idField?: string\n  tempIdField?: string\n  handleEvents?: HandleEvents\n  enableEvents?: boolean\n  debounceEventsTime?: number\n  debounceEventsGuarantee?: boolean\n  whitelist?: string[]\n  state?: () => { [k: string]: any }\n  getters?: { [k: string]: (state: any) => any }\n  actions?: { [k: string]: Function }\n}\n\nexport function setupFeathersPinia(globalOptions: SetupOptions) {\n  const { clients } = globalOptions\n  Object.keys(clients).forEach((name) => {\n    registerClient(name, clients[name])\n  })\n\n  function defineStoreWrapper<\n    Id extends string,\n    M extends BaseModel = BaseModel,\n    S extends StateTree = {},\n    G extends _GettersTree<S> = {},\n    A = {},\n  >(\n    id: Id,\n    options: Omit<DefineFeathersStoreOptions<Id, M, S, G, A>, 'id'>,\n  ): (pinia?: Pinia) => ServiceStore<Id, M, S, G, A>\n  function defineStoreWrapper<\n    Id extends string,\n    M extends BaseModel = BaseModel,\n    S extends StateTree = {},\n    G extends _GettersTree<S> = {},\n    A = {},\n  >(options: DefineFeathersStoreOptions<Id, M, S, G, A>): (pinia?: Pinia) => ServiceStore<Id, M, S, G, A>\n  function defineStoreWrapper<\n    Id extends string,\n    M extends BaseModel = BaseModel,\n    S extends StateTree = {},\n    G extends _GettersTree<S> = {},\n    A = {},\n  >(\n    ...args: [DefineFeathersStoreOptions<Id, M, S, G, A>] | [Id, Omit<DefineFeathersStoreOptions<Id, M, S, G, A>, 'id'>]\n  ): (pinia?: Pinia) => ServiceStore<Id, M, S, G, A> {\n    const id = args.length === 2 ? args[0] : args[0].id\n    const options = args.length === 2 ? args[1] : args[0]\n    // @ts-expect-error todo\n    options.id = id || `service.${options.servicePath}`\n\n    return defineStore<Id, M, S, G, A>(Object.assign({}, globalOptions, options))\n  }\n\n  return {\n    defineStore: defineStoreWrapper,\n    BaseModel,\n  }\n}\n","import { defineStore, StateTree, StoreDefinition, _GettersTree } from 'pinia'\nimport { DefineStoreOptionsWithDefaults } from './types'\nimport { TypedActions, TypedGetters } from './utility-types'\n\ntype DefineAuthStoreOptions<Id extends string, S extends StateTree, G, A> = DefineStoreOptionsWithDefaults<\n  Id,\n  S,\n  G,\n  A,\n  AuthStoreDefaultState,\n  AuthStoreDefaultGetters,\n  AuthStoreDefaultActions\n> & {\n  feathersClient: any\n  id?: string\n}\n\ntype AuthStoreDefinition<Id extends string, S, G, A> = StoreDefinition<\n  Id,\n  AuthStoreDefaultState & S,\n  AuthStoreDefaultGetters & G,\n  AuthStoreDefaultActions & A\n>\n\ntype AuthStoreTypedGetters = TypedGetters<AuthStoreDefaultState, AuthStoreDefaultGetters>\ntype AuthStoreTypedActions = TypedActions<AuthStoreDefaultState, AuthStoreDefaultGetters, AuthStoreDefaultActions>\n\ninterface AuthStoreDefaultState {\n  isLoading: boolean\n  isAuthenticated: boolean\n  accessToken: string | null // The auth0 and API accessToken\n  payload: any // accessToken payload\n  error: any\n}\n\ninterface AuthStoreDefaultGetters extends _GettersTree<AuthStoreDefaultState> {\n  feathersClient: () => any\n}\n\ninterface AuthStoreDefaultActions {\n  authenticate: (authData: any) => Promise<any>\n  handleResponse: (response: any) => any\n  handleError: (err: Error) => any\n  setLoaded: (val: boolean) => void\n}\n\nexport function defineAuthStore<\n  Id extends string,\n  S extends StateTree = {},\n  G extends _GettersTree<S> = {},\n  // cannot extends ActionsTree because we loose the typings\n  A /* extends ActionsTree */ = {},\n>(\n  ...args: [DefineAuthStoreOptions<Id, S, G, A>] | [Id, Omit<DefineAuthStoreOptions<Id, S, G, A>, 'id'>]\n): AuthStoreDefinition<Id, S, G, A> {\n  const id = args.length === 2 ? args[0] : args[0].id || 'auth'\n  const options = args.length === 2 ? args[1] : args[0]\n  const { feathersClient, state = () => ({} as S), getters = {} as G, actions = {} as A } = options\n\n  /**\n   * Default State\n   */\n  const defaultState: AuthStoreDefaultState = {\n    isLoading: true,\n    isAuthenticated: false,\n    accessToken: null, // The auth0 and API accessToken\n    payload: null, // accessToken payload\n    error: null,\n  }\n\n  /**\n   * Default Getters\n   */\n  const defaultGetters: AuthStoreTypedGetters = {\n    feathersClient() {\n      return feathersClient\n    },\n  }\n\n  /**\n   * Default Actions\n   */\n  const defaultActions: AuthStoreTypedActions = {\n    async authenticate(authData: any) {\n      try {\n        const response = await feathersClient.authenticate(authData)\n        Object.assign(this, { ...response, isAuthenticated: true })\n        return this.handleResponse(response) || response\n      } catch (error) {\n        this.error = error\n        return this.handleError(error as Error)\n      }\n    },\n    /**\n     * Overwrite this function to handle the response in your app.\n     * @param response The response from authenticate()\n     */\n    handleResponse(response: any) {\n      return response\n    },\n    /**\n     * Overwrite this function to handle the error in your app.\n     * @param error the error from authenticate()\n     */\n    handleError(error: Error) {\n      return Promise.reject(error)\n    },\n    /**\n     * For tracking first-load state. Used by the watcher, below.\n     */\n    setLoaded() {\n      this.isLoading = false\n    },\n  }\n\n  const useAuth = defineStore({\n    id: id as Id,\n    state: () => Object.assign(defaultState, state()) as AuthStoreDefaultState & S,\n    getters: Object.assign(defaultGetters, getters) as AuthStoreDefaultGetters & G,\n    actions: Object.assign(defaultActions, actions) as AuthStoreDefaultActions & A,\n  })\n\n  return useAuth\n}\n","import type {\n  Association,\n  BaseModelAssociations,\n  FindClassParams,\n  FindClassParamsStandalone,\n  ModelStatic,\n  ServiceStoreDefault,\n} from './service-store/types'\nimport { BaseModel } from './service-store'\n\nexport type HandleSetInstance<M> = (this: M, associatedRecord: M) => void\n\nexport function getParams<M extends BaseModel>(\n  instance: any,\n  store: ServiceStoreDefault<M>,\n  makeParams?: (instance: M) => FindClassParams,\n): FindClassParamsStandalone<M> | void {\n  if (makeParams) {\n    const params = makeParams(instance)\n    if (params.temps !== false) params.temps = true\n    const _params = Object.assign({}, params, { store })\n    return _params\n  }\n}\n\nfunction defaultHandleSetInstance<M>(associatedRecord: M) {\n  return associatedRecord\n}\n\nexport function setupAssociation<M extends BaseModel>(\n  instance: M,\n  handleSetInstance: any,\n  prop: string,\n  Model: ModelStatic<BaseModel>,\n  propUtilsPrefix: string,\n) {\n  // Define the association\n  const def: Association = { name: prop, Model, type: 'get' }\n\n  const _handleSetInstance = handleSetInstance || defaultHandleSetInstance\n\n  // Register the association on the instance.Model\n  if (!instance.Model.associations[prop]) {\n    (instance.Model.associations as BaseModelAssociations)[prop] = def\n  }\n\n  // prefix the prop name with the `propUtilsPrefix`, which is `_`, by default.\n  const propUtilName = `${propUtilsPrefix}${prop}`\n\n  return { _handleSetInstance, propUtilName }\n}\n","import type { FindClassParams, FindClassParamsStandalone, AssociateFindUtils, ModelStatic } from './service-store/types'\nimport { BaseModel } from './service-store/base-model'\nimport { getParams, setupAssociation } from './associate-utils'\nimport { Find, useFind } from './use-find'\nimport { MaybeRef } from './utility-types'\n\ninterface AssociateFindOptions<M extends BaseModel> {\n  Model: ModelStatic<BaseModel>\n  makeParams: (instance: M) => FindClassParams\n  handleSetInstance?: (this: M, associatedRecord: M) => void\n  propUtilsPrefix?: string\n}\nexport function associateFind<M extends BaseModel>(\n  instance: M,\n  prop: string,\n  { Model, makeParams, handleSetInstance, propUtilsPrefix = '_' }: AssociateFindOptions<M>,\n) {\n  // cache the initial data in a variable\n  const initialData = (instance as any)[prop]\n  const { _handleSetInstance, propUtilName } = setupAssociation(\n    instance,\n    handleSetInstance,\n    prop,\n    Model,\n    propUtilsPrefix,\n  )\n\n  // define `setupFind` for lazy creation of associated getters.\n  let _utils: AssociateFindUtils<M>\n  function setupFind(instance: M) {\n    if (!makeParams) return null\n    const _params = getParams(instance, Model.store as any, makeParams)\n    _utils = new Find(_params as FindClassParamsStandalone<M>) as any\n    _utils.useFind = (params: MaybeRef<FindClassParams>): Find<M> => {\n      const _params = params.value || params\n      _params.store = Model.store\n      return useFind(params as MaybeRef<FindClassParamsStandalone<M>>)\n    }\n  }\n\n  // create the `propName` where the data is found.\n  Object.defineProperty(instance, prop, {\n    enumerable: false,\n    get() {\n      if (!_utils) setupFind(this)\n      return _utils.data.value\n    },\n    // Writing values to the setter will write them to the other Model's store.\n    set(this: M, items: any[]) {\n      items.map((i) => new Model(i).addToStore()).map((i) => _handleSetInstance.call(this, i as any))\n    },\n  })\n\n  // Create the `_propName` utility object\n  Object.defineProperty(instance, propUtilName, {\n    enumerable: false,\n    get() {\n      if (!_utils) setupFind(this)\n      return _utils\n    },\n  })\n\n  // Write the initial data to the new setter\n  if (initialData) {\n    const _instance: any = instance\n    _instance[prop] = initialData\n  }\n}\n","import type { FindClassParams, ModelStatic } from './service-store/types'\nimport type { HandleSetInstance } from './associate-utils'\nimport type { Params } from './types'\nimport type { Id } from '@feathersjs/feathers'\nimport { BaseModel } from './service-store/base-model'\nimport { getParams, setupAssociation } from './associate-utils'\n\ninterface AssociateGetOptions<M extends BaseModel> {\n  Model: ModelStatic<BaseModel>\n  getId: (instance: M) => Id | null\n  makeParams?: (instance: M) => FindClassParams\n  handleSetInstance?: HandleSetInstance<M>\n  propUtilsPrefix?: string\n}\nexport function associateGet<M extends BaseModel>(\n  instance: M,\n  prop: string,\n  { Model, getId, makeParams, handleSetInstance, propUtilsPrefix = '_' }: AssociateGetOptions<M>,\n) {\n  // Cache the initial data in a variable\n  const initialData = (instance as any)[prop]\n\n  const { _handleSetInstance, propUtilName } = setupAssociation(\n    instance,\n    handleSetInstance,\n    prop,\n    Model,\n    propUtilsPrefix,\n  )\n\n  const utils = {\n    get(id?: Id | null, params?: Params) {\n      const _id = getId(instance) || id\n      const _params = getParams(instance, Model.store as any, makeParams) || params\n      return Model.get(_id as Id, _params)\n    },\n    getFromStore(id?: Id | null, params?: Params) {\n      const _id = instance.getId() || id\n      const _params = getParams(instance, Model.store as any, makeParams) || params\n      return Model.getFromStore(_id, _params)\n    },\n  }\n\n  Object.defineProperty(instance, prop, {\n    // Define the key as non-enumerable so it won't get cloned\n    enumerable: false,\n\n    // Reading values will populate them from data in the store that matches the params.\n    get() {\n      const id = getId(this)\n      let _params\n      if (makeParams) {\n        _params = getParams(this, Model.store as any, makeParams)\n      }\n      return Model.getFromStore(id, _params as any)\n    },\n\n    // Writing a value to the setter will write it to the other Model's store.\n    set(this: M, item: any[]) {\n      const model = new Model(item).addToStore()\n      return _handleSetInstance.call(this, model as any)\n    },\n  })\n\n  // Create the `_propName` utility object\n  Object.defineProperty(instance, propUtilName, {\n    configurable: true,\n    enumerable: false,\n    value: utils,\n  })\n\n  // Write the initial data to the new setter\n  if (initialData) {\n    const _instance: any = instance\n    _instance[prop] = initialData\n  }\n}\n","import { FetchClient } from '@feathersjs/rest-client'\nimport type { Params } from '@feathersjs/feathers'\n\n// A feathers-rest transport adapter for https://github.com/unjs/ofetch\nexport class OFetch extends FetchClient {\n  async request(options: any, params: Params) {\n    const fetchOptions = Object.assign({}, options, (params as any).connection)\n\n    fetchOptions.headers = Object.assign({ Accept: 'application/json' }, this.options.headers, fetchOptions.headers)\n\n    if (options.body) fetchOptions.body = options.body\n\n    try {\n      const response = await this.connection.raw(options.url, fetchOptions)\n      const { _data, status } = response\n\n      if (status === 204) return null\n      return _data\n    } catch (error) {\n      console.error('feathers-ofetch request error', error)\n      throw error\n    }\n  }\n}\n","import type { MaybeRef } from './utility-types'\nimport { computed, watch, Ref, unref } from 'vue-demi'\nimport { usePageData } from './utils-pagination'\nimport { computedAttr } from './utils'\n\ninterface Pagination {\n  $limit: number\n  $skip: number\n}\n\nexport function usePagination(pagination: MaybeRef<Pagination>, latestQuery: Ref) {\n  const $limit = computedAttr(pagination, '$limit')\n  const $skip = computedAttr(pagination, '$skip')\n  const total = computed(() => latestQuery.value.response.total)\n  const { pageCount, currentPage, canPrev, canNext, toStart, toEnd, toPage, next, prev } = usePageData(\n    $limit,\n    $skip,\n    total,\n  )\n\n  /**\n   * The number of items returned in the latestQuery prop.\n   */\n  const itemsCount = computed(() => {\n    const q = unref(latestQuery)\n    if (q && q.response) {\n      return q.response.total\n    } else {\n      return 0\n    }\n  })\n\n  // If the max page becomes lower, go to the last page to still show data\n  watch(\n    () => pageCount.value,\n    () => {\n      const lq = latestQuery.value\n      if (lq && lq.response && currentPage.value > pageCount.value) {\n        currentPage.value = pageCount.value\n      }\n    },\n  )\n\n  return {\n    itemsCount,\n    pageCount,\n    currentPage,\n    canPrev,\n    canNext,\n    toStart,\n    toEnd,\n    toPage,\n    next,\n    prev,\n  }\n}\n","import { computed, reactive, ref, toRefs, watchEffect } from 'vue-demi'\nimport { BaseModel } from './service-store'\nimport { UseCloneOptions } from './service-store/types'\nimport { AnyRef } from './types'\n\nexport function useClone<M extends BaseModel>(\n  props: any,\n  attr: string,\n  options: UseCloneOptions = {},\n): AnyRef<M | null> {\n  const { useExisting = false, deep = false } = options\n\n  const returnVal = deep ? computed(handleClone) : ref(null)\n\n  function handleClone(): M | null {\n    // Return null if not a BaseModel\n    const val = props[attr]\n    if (!(val instanceof BaseModel)) return null\n\n    // Assure that instance is in the store.\n    const instance = val as M\n    const anyId = instance.getAnyId()\n    const inStore = instance.Model.getFromStore(anyId)\n    if (!inStore) instance.addToStore()\n\n    if (instance) return instance?.clone(undefined, { useExisting }) as M\n    else return null\n  }\n\n  let cachedId: any = null\n\n  if (!deep) {\n    watchEffect(() => {\n      toRefs(reactive(props))\n      const val = props[attr]\n      if (!val) {\n        cachedId = null\n        ;(returnVal.value as any) = null\n      } else if (val.getAnyId) {\n        const id = val.getAnyId()\n        if (id !== cachedId) {\n          cachedId = id\n          ;(returnVal.value as any) = handleClone()\n        }\n      }\n    })\n  }\n\n  return returnVal\n}\n","import type { UseCloneOptions } from './service-store/types'\nimport { reactive, toRefs } from 'vue-demi'\nimport { useClone } from './use-clone'\n\n/**\n * Pass in a `props` object and get back an object of clones.\n */\nexport function useClones<P extends Record<string, unknown>>(props: P, options: UseCloneOptions = {}) {\n  const clones: Record<keyof P, any> = reactive({} as Record<keyof P, any>)\n  Object.keys(props).forEach((key: keyof P) => {\n    clones[key] = useClone(props, key as string, options)\n  })\n  return toRefs(clones)\n}\n","function e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";export default o;export{n as InvalidTokenError};\n//# sourceMappingURL=jwt-decode.esm.js.map\n","import { computed, Ref, ref } from 'vue'\nimport { BadRequest } from '@feathersjs/errors'\nimport decode from 'jwt-decode'\nimport type { NullableId } from '@feathersjs/feathers'\n\ntype SuccessHandler = (result: Record<string, any>) => Promise<Record<string, any> | void>\ntype ErrorHandler = (error: Error) => Promise<void>\n\ninterface UseAuthOptions {\n  api: any\n  userStore?: any\n  skipTokenCheck?: boolean\n  entityKey?: string\n  onSuccess?: SuccessHandler\n  onError?: ErrorHandler\n  onInitSuccess?: SuccessHandler\n  onInitError?: ErrorHandler\n  onLogoutSuccess?: SuccessHandler\n  onLogoutError?: ErrorHandler\n}\n\ninterface AuthenticateData {\n  strategy: 'jwt' | 'local'\n  accessToken?: string\n  email?: string\n  password?: string\n}\n\nexport const useAuth = <d extends AuthenticateData = AuthenticateData>(options: UseAuthOptions) => {\n  const { api, userStore, skipTokenCheck } = options\n  const entityKey = options.entityKey || 'user'\n\n  // external flow\n  const promise = ref() as Ref<Promise<Record<string, any>>>\n  const defaultHandler = async () => undefined\n  const defaultErrorHandler = async (error: any) => {\n    throw error\n  }\n  const onSuccess: SuccessHandler = options.onSuccess || defaultHandler\n  const onError: ErrorHandler = options.onError || defaultErrorHandler\n  const onInitSuccess: SuccessHandler = options.onInitSuccess || defaultHandler\n  const onInitError: ErrorHandler = options.onInitError || defaultHandler\n  const onLogoutSuccess: SuccessHandler = options.onLogoutSuccess || defaultHandler\n  const onLogoutError: ErrorHandler = options.onLogoutError || defaultErrorHandler\n\n  // user\n  const userId = ref<NullableId>(null)\n  const user = computed(() => {\n    const u = userStore?.getFromStore(userId)\n    return u || null\n  })\n\n  // error\n  const error = ref<Error | null>(null)\n  const clearError = () => (error.value = null)\n\n  // authenticate\n  const authCounter = useCounter()\n  const isPending = computed(() => !!authCounter.count.value)\n  const isAuthenticated = ref(false)\n  const authenticate = async (data?: d) => {\n    authCounter.add()\n    clearError()\n    promise.value = api\n      .authenticate(data)\n      .then(handleAuthResult)\n      .then(async (result: Record<string, any>) => {\n        const _result = await onSuccess(result)\n        return _result || result\n      })\n      .catch((err: any) => {\n        error.value = err\n        return onError(err)\n      })\n    return promise.value\n  }\n  const handleAuthResult = (result: any) => {\n    const entity = result[entityKey]\n    if (userStore && entity) {\n      const stored = userStore.addToStore(entity)\n      userId.value = stored.getId()\n    }\n    isAuthenticated.value = true\n    return result\n  }\n\n  // reauthentication at app start\n  const isInitDone = ref(false)\n  const done = () => {\n    authCounter.sub()\n    isInitDone.value = true\n  }\n  const reAuthenticate = async () => {\n    authCounter.add()\n    promise.value = api.authentication\n      .getAccessToken()\n      .then((accessToken: string) => {\n        if (accessToken && !skipTokenCheck && isTokenExpired(accessToken)) {\n          api.authentication.removeAccessToken()\n          throw new BadRequest('accessToken expired')\n        }\n      })\n      .then(() => api.reAuthenticate())\n      .then(handleAuthResult)\n      .then(async (result: Record<string, any>) => {\n        const _result = await onInitSuccess(result)\n        return _result || result\n      })\n      .catch(onInitError)\n      .finally(() => done())\n    return promise.value\n  }\n\n  // token check\n  const isTokenExpired = (jwt: string) => {\n    try {\n      const payload = decode(jwt) as any\n      return new Date().getTime() > payload.exp * 1000\n    } catch (error) {\n      return false\n    }\n  }\n\n  // logout\n  const logoutCounter = useCounter()\n  const isLogoutPending = computed(() => !!logoutCounter.count.value)\n  const logout = async () => {\n    logoutCounter.add()\n    return api\n      .logout()\n      .then((response: any) => {\n        userId.value = null\n        isAuthenticated.value = false\n        return response\n      })\n      .then(onLogoutSuccess)\n      .catch((error: any) => {\n        error.value = error\n        return onLogoutError(error)\n      })\n      .finally(() => logoutCounter.sub())\n  }\n\n  // login redirect\n  const loginRedirect = ref<string | Record<string, any> | null>(null)\n\n  return {\n    user,\n    error,\n    isPending,\n    isLogoutPending,\n    isInitDone,\n    isAuthenticated,\n    loginRedirect,\n    getPromise: () => promise.value,\n    isTokenExpired,\n    authenticate,\n    reAuthenticate,\n    logout,\n    clearError,\n  }\n}\n\n// Use a counter to track the number of pending queries. Prevents collisions with overlapping queries.\nconst useCounter = () => {\n  const count = ref(0)\n  const add = () => {\n    count.value = count.value + 1\n  }\n  const sub = () => {\n    count.value = count.value === 0 ? 0 : count.value - 1\n  }\n  return {\n    count,\n    add,\n    sub,\n  }\n}\n","import debounce from 'just-debounce'\nimport { _ } from '@feathersjs/commons'\nimport { computed, watch } from 'vue-demi'\n\n// Writes data to localStorage\nexport function writeToStorage(id: string, data: any, storage: any) {\n  const compressed = JSON.stringify(data)\n  storage.setItem(id, compressed)\n}\n\n// Reads and decompresses data from localStorage\nexport function hydrateStore(store: any, storage: any) {\n  const data = storage.getItem(store.$id)\n  if (data) {\n    const hydrationData = JSON.parse(data as string) || {}\n    Object.assign(store, hydrationData)\n  }\n}\n\n/**\n *\n * @param store pinia store\n * @param keys an array of keys to watch and write to localStorage.\n */\nexport function syncWithStorage(store: any, stateKeys: Array<string>, storage: Storage = window.localStorage) {\n  hydrateStore(store, storage)\n\n  const debouncedWrite = debounce(writeToStorage, 500)\n  const toWatch = computed(() => _.pick(store, ...stateKeys))\n\n  watch(toWatch, (val) => debouncedWrite(store.$id, val, storage), { deep: true })\n}\n","/**\n * Clears all services from localStorage. You might use this when a user\n * logs out to make sure their data doesn't persist for the next user.\n *\n * @param storage an object using the Storage interface\n */\nexport function clearStorage(storage: Storage = window.localStorage) {\n  Object.keys(storage).map((key) => {\n    if (key.startsWith('service.')) {\n      storage.removeItem(key)\n    }\n  })\n}\n"],"names":["fastJsonStableStringify","data","opts","cycles","cmp","f","node","b","aobj","bobj","seen","stringify","i","out","seenIndex","keys","key","value","_increment","_pid","_machine","storage","mongoMachineId","ObjectID","args","strOid","array","timestamp","machine","pid","increment","module","require$$0","toStringFunction","create","defineProperty","getOwnPropertyDescriptor","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf$1","_a","hasOwnProperty","propertyIsEnumerable","SYMBOL_PROPERTIES","WEAK_MAP","createCache","Cache","getCleanClone","object","realm","prototype","Constructor","getObjectCloneLoose","handleCopy","cache","clone","symbols","index","length_1","symbol","getObjectCloneStrict","properties","length_2","property","descriptor","getRegExpFlags","regExp","flags","isArray","getPrototypeOf","GLOBAL_THIS","copy","options","isStrict","getObjectClone","fastDeepEqual","equal","a","length","stringifyIfObject","val","getId","item","idField","getTempId","tempIdField","getAnyId","getQueryInfo","params","response","query","qid","$limit","$skip","pageParams","pageId","queryParams","_","queryId","getItemsFromQueryInfo","pagination","queryInfo","keyedById","queryLevel","pageLevel","ids","assignTempId","newId","cleanData","items","getArray","cleaned","restoreTempIds","resData","sourceItems","responseItems","tempId","hasOwn","obj","prop","getSaveParams","fastCopy","unref","markAsClone","copyAssociations","src","dest","associations","desc","pickDiff","diffDef","topLevelKeys","diff","original","originalVal","cloneVal","isEqual","setOnRef","computedAttr","computed","makeUseFindItems","store","_params","defaultSkip","defaultLimit","skip","limit","makeParamsWithoutPage","updateParamsExcludePage","_newParams","newParams","models","registerModel","Model","R","ReflectApply","target","receiver","ReflectOwnKeys","ProcessEmitWarning","warning","NumberIsNaN","EventEmitter","eventsModule","events","once","defaultMaxListeners","checkListener","listener","arg","n","_getMaxListeners","that","type","doError","er","err","handler","len","listeners","arrayClone","_addListener","prepend","m","existing","w","onceWrapper","_onceWrap","state","wrapped","list","position","originalListener","spliceOne","_listeners","unwrap","evlistener","unwrapListeners","emitter","listenerCount","arr","ret","name","resolve","reject","errorListener","resolver","eventTargetAgnosticAddListener","addErrorHandlerIfEventEmitter","wrapListener","BaseModel","__publicField","instanceDefaults","eventName","id","setupInstance","pending","__isClone","saved","error","rollbackData","dataFromWith","checkThis","context","clients","registerClient","client","justDebounce","debounce","fn","delay","atStart","guarantee","timeout","self","clear","run","enableServiceEvents","service","debouncedQueue","_debounce","values","handleEvent","confirmOrArray","affectsStore","modified","makeState","defaultState","extendStatics","d","p","__extends","__","typeChecker","typeString","getClassName","comparable","isObject","isFunction","isVanillaObject","equals","walkKeyPathValues","keyPath","next","depth","owner","currentKey","BaseOperation","owneryQuery","GroupOperation","_super","children","_this","root","done","keep","length_3","childOperation","NamedGroupOperation","QueryOperation","parent","NestedOperation","createTester","compare","result","comparableA","EqualsOperation","createEqualsOperation","NopeOperation","numericalOperationCreator","createNumericalOperation","numericalOperation","typeofParams","test","createNamedOperation","parentQuery","operationCreator","throwUnsupportedOperation","containsOperation","createNestedOperation","nestedQuery","parentKey","createQueryOperations","selfOperations","nestedOperations","createQueryOperation","_b","operations","_c","ops","op","createOperationTester","operation","$Ne","$ElemMatch","child","$Not","$Size","assertGroupNotEmpty","$Or","success","$Nor","$In","length_4","$Nin","ownerQuery","$Exists","$And","$All","$eq","$ne","$or","$nor","$elemMatch","$nin","$in","$lt","$lte","$gt","$gte","$mod","mod","equalsValue","$exists","$regex","pattern","$not","typeAliases","v","$type","clazz","$and","$all","$size","$options","$where","defaultOperations","createDefaultQueryOperation","createDefaultQueryTester","sift","like","search","regexOptions","specials","iLike","str","$like","$notLike","$ilike","$notILike","FILTERS","additionalOperators","makeGetters","temp","paramsForServer","whitelist","itemsById","q","filters","filterQuery","total","sorter","existingItem","select","tempItem","makePending","method","isPending","usePageData","_total","pageCount","currentPage","pageNumber","newSkip","canPrev","canNext","useFind","Find","_computedParams","isReadonly","isRef","ref","immediate","_watch","paramsWithPagination","paramsWithoutPagination","queryShallowCopy","haveBeenRequested","haveLoaded","pageKeys","allIds","page","matchingItemsById","queryWhen","queryWhenFn","qidState","queryState","pageState","queriedAt","queries","storeCount","pageData","waitForExistingRequest","request","makeRequest","res","initWithLimitOrSkip","_cachedWatchedParams","watch","useGet","Get","_id","onServer","hasBeenRequested","hasLoaded","mostRecentId","__id","useFindWatched","model","fetchParams","local","getParamsForFetch","providedParams","provided","forFetch","reactive","computes","handleQueryWhen","info","qidData","queryData","find","methods","findProxy","paramsToUse","wrappedQueryWhen","toRefs","useGetWatched","getParams","unrefId","get","idToUse","makeActions","ssrPromise","ssrResponse","preserveSsr","mappedFromState","skipRequestIfExists","idsToRemove","set","_items","addOrMergeToStore","existingTemp","placeToStore","originalItem","newOriginal","existingClone","cloneReset","mostRecent","existingPageData","ssr","newState","idOrIds","event","setEventLockState","results","servicePath","isSsr","classes","defineStore","_options","makeOptions","handleEvents","debounceEventsTime","debounceEventsGuarantee","clientAlias","isInitialized","getters","actions","useStore","pinia","initializedStore","definePiniaStore","boundActions","defaults","_d","_e","setupFeathersPinia","globalOptions","defineStoreWrapper","defineAuthStore","feathersClient","defaultGetters","defaultActions","authData","instance","makeParams","defaultHandleSetInstance","associatedRecord","setupAssociation","handleSetInstance","propUtilsPrefix","def","_handleSetInstance","propUtilName","associateFind","initialData","_utils","setupFind","_instance","associateGet","utils","OFetch","FetchClient","fetchOptions","_data","status","usePagination","latestQuery","toStart","toEnd","toPage","prev","itemsCount","lq","useClone","props","attr","useExisting","deep","returnVal","handleClone","anyId","cachedId","watchEffect","useClones","clones","e","r","t","o","c","useAuth","api","userStore","skipTokenCheck","entityKey","promise","defaultHandler","defaultErrorHandler","onSuccess","onError","onInitSuccess","onInitError","onLogoutSuccess","onLogoutError","userId","user","clearError","authCounter","useCounter","isAuthenticated","authenticate","handleAuthResult","entity","stored","isInitDone","reAuthenticate","accessToken","isTokenExpired","BadRequest","jwt","payload","decode","logoutCounter","isLogoutPending","logout","loginRedirect","count","writeToStorage","compressed","hydrateStore","hydrationData","syncWithStorage","stateKeys","debouncedWrite","toWatch","clearStorage"],"mappings":"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"}